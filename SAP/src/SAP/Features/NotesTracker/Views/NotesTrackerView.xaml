<UserControl x:Class="SAP.Features.NotesTracker.Views.NotesTrackerView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:models="clr-namespace:SAP.Features.NotesTracker.Models">

    <UserControl.Resources>
        <BooleanToVisibilityConverter x:Key="BoolToVis"/>
    </UserControl.Resources>

    <Grid Background="{DynamicResource BackgroundBrush}">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Header -->
        <Border Background="{DynamicResource SurfaceBrush}" Padding="20,16">
            <TextBlock Text="Notes Tracker"
                       FontSize="20"
                       FontWeight="SemiBold"
                       Foreground="{DynamicResource AccentBrush}"/>
        </Border>

        <!-- Add Note Bar -->
        <Border Grid.Row="1"
                Background="{DynamicResource SurfaceBrush}"
                BorderBrush="{DynamicResource BorderBrush}"
                BorderThickness="0,1"
                Padding="20,12">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="2*"/>
                    <ColumnDefinition Width="12"/>
                    <ColumnDefinition Width="1.5*"/>
                    <ColumnDefinition Width="12"/>
                    <ColumnDefinition Width="1.5*"/>
                    <ColumnDefinition Width="12"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="12"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <TextBox x:Name="VendorBox"
                         Text="{Binding NewNoteVendorName, UpdateSourceTrigger=PropertyChanged}"
                         Background="{DynamicResource SurfaceHoverBrush}"
                         Foreground="{DynamicResource TextPrimaryBrush}"
                         BorderBrush="{DynamicResource BorderBrush}"
                         BorderThickness="1"
                         Padding="10,8"
                         FontSize="13"
                         Tag="Vendor"
                         GotFocus="TextBox_GotFocus"
                         LostFocus="TextBox_LostFocus"
                         PreviewKeyDown="TextBox_KeyDown"/>

                <TextBox Grid.Column="2"
                         x:Name="TransfersBox"
                         Text="{Binding NewNoteTransferNumbers, UpdateSourceTrigger=PropertyChanged}"
                         Background="{DynamicResource SurfaceHoverBrush}"
                         Foreground="{DynamicResource TextPrimaryBrush}"
                         BorderBrush="{DynamicResource BorderBrush}"
                         BorderThickness="1"
                         Padding="10,8"
                         FontSize="13"
                         Tag="Transfers"
                         GotFocus="TextBox_GotFocus"
                         LostFocus="TextBox_LostFocus"
                         PreviewKeyDown="TextBox_KeyDown"/>

                <TextBox Grid.Column="4"
                         x:Name="WhsBox"
                         Text="{Binding NewNoteWhsShipmentNumbers, UpdateSourceTrigger=PropertyChanged}"
                         Background="{DynamicResource SurfaceHoverBrush}"
                         Foreground="{DynamicResource TextPrimaryBrush}"
                         BorderBrush="{DynamicResource BorderBrush}"
                         BorderThickness="1"
                         Padding="10,8"
                         FontSize="13"
                         Tag="WHs"
                         GotFocus="TextBox_GotFocus"
                         LostFocus="TextBox_LostFocus"
                         PreviewKeyDown="TextBox_KeyDown"/>

                <Border Grid.Column="6"
                        x:Name="ColorPreview"
                        Width="36"
                        Height="36"
                        CornerRadius="6"
                        Background="#8b5cf6"
                        Cursor="Hand"
                        MouseLeftButtonDown="ColorPreview_Click"
                        ToolTip="Pick color"/>

                <Button Grid.Column="8"
                        Content="Add Note"
                        Click="AddNote_Click"
                        Style="{DynamicResource SuccessButtonStyle}"
                        Padding="16,8"
                        FontSize="13"/>
            </Grid>
        </Border>

        <!-- Notes List -->
        <ScrollViewer Grid.Row="2" Padding="20,16">
            <ItemsControl x:Name="NotesListBox" ItemsSource="{Binding Items}">
                <ItemsControl.ItemTemplate>
                    <DataTemplate>
                        <Border Background="{DynamicResource SurfaceBrush}"
                                BorderBrush="{DynamicResource BorderBrush}"
                                BorderThickness="1"
                                CornerRadius="8"
                                Margin="0,0,0,12">
                            <Grid>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="6"/>
                                    <RowDefinition Height="*"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>

                                <!-- Color Bar -->
                                <Border Background="{Binding ColorHex}"
                                        CornerRadius="8,8,0,0"
                                        Cursor="Hand"
                                        MouseLeftButtonDown="ColorBar_Click"/>

                                <!-- Content -->
                                <StackPanel Grid.Row="1" Margin="16,12">
                                    <Grid>
                                        <TextBlock Text="{Binding VendorName}"
                                                   FontSize="15"
                                                   FontWeight="SemiBold"
                                                   Foreground="{DynamicResource TextPrimaryBrush}"/>
                                        
                                        <Border HorizontalAlignment="Right"
                                                CornerRadius="4"
                                                Padding="8,3"
                                                Cursor="Hand"
                                                MouseLeftButtonDown="StatusToggle_Click">
                                            <Border.Style>
                                                <Style TargetType="Border">
                                                    <Setter Property="Background" Value="{DynamicResource DangerBrush}"/>
                                                    <Style.Triggers>
                                                        <DataTrigger Binding="{Binding Status}" Value="{x:Static models:NoteItem+NoteStatus.InProgress}">
                                                            <Setter Property="Background" Value="{DynamicResource SuccessBrush}"/>
                                                        </DataTrigger>
                                                    </Style.Triggers>
                                                </Style>
                                            </Border.Style>
                                            <TextBlock FontSize="11" FontWeight="SemiBold" Foreground="White">
                                                <TextBlock.Style>
                                                    <Style TargetType="TextBlock">
                                                        <Setter Property="Text" Value="Not Ready"/>
                                                        <Style.Triggers>
                                                            <DataTrigger Binding="{Binding Status}" Value="{x:Static models:NoteItem+NoteStatus.InProgress}">
                                                                <Setter Property="Text" Value="In Progress"/>
                                                            </DataTrigger>
                                                        </Style.Triggers>
                                                    </Style>
                                                </TextBlock.Style>
                                            </TextBlock>
                                        </Border>
                                    </Grid>

                                    <TextBlock Text="{Binding TransferNumbers}"
                                               Foreground="{DynamicResource TextSecondaryBrush}"
                                               FontSize="13"
                                               Margin="0,6,0,0"/>

                                    <TextBlock Text="{Binding WhsShipmentNumbers}"
                                               Foreground="{DynamicResource TextSecondaryBrush}"
                                               FontSize="13"
                                               Margin="0,4,0,0"/>

                                    <TextBlock Text="{Binding TimeInProgressDisplay}"
                                               Foreground="{DynamicResource TextTertiaryBrush}"
                                               FontSize="12"
                                               FontFamily="Consolas"
                                               Margin="0,8,0,0"/>
                                </StackPanel>

                                <!-- Actions -->
                                <Border Grid.Row="2"
                                        BorderBrush="{DynamicResource BorderBrush}"
                                        BorderThickness="0,1,0,0"
                                        Padding="12,8">
                                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Right">
                                        <Button Content="Delete"
                                                Command="{Binding DataContext.DeleteAsyncCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                                CommandParameter="{Binding}"
                                                Style="{DynamicResource GhostButtonStyle}"
                                                Padding="10,6"
                                                FontSize="12"
                                                Foreground="{DynamicResource DangerBrush}"/>
                                    </StackPanel>
                                </Border>
                            </Grid>
                        </Border>
                    </DataTemplate>
                </ItemsControl.ItemTemplate>
            </ItemsControl>
        </ScrollViewer>

        <!-- Status Bar -->
        <Border Grid.Row="3"
                Background="{DynamicResource SurfaceBrush}"
                BorderBrush="{DynamicResource BorderBrush}"
                BorderThickness="0,1,0,0"
                Padding="20,10">
            <Grid>
                <TextBlock Text="{Binding StatusMessage}"
                           Foreground="{DynamicResource TextSecondaryBrush}"
                           FontSize="12"/>
                
                <Border HorizontalAlignment="Right"
                        Background="{DynamicResource SurfaceHoverBrush}"
                        Padding="12,6"
                        CornerRadius="6"
                        Visibility="{Binding UndoAvailable, Converter={StaticResource BoolToVis}}">
                    <StackPanel Orientation="Horizontal">
                        <TextBlock Text="{Binding UndoMessage}"
                                   Foreground="{DynamicResource TextPrimaryBrush}"
                                   FontSize="12"
                                   VerticalAlignment="Center"
                                   Margin="0,0,10,0"/>
                        <Button Content="Undo"
                                Command="{Binding UndoStatusChangeAsyncCommand}"
                                Style="{DynamicResource SecondaryButtonStyle}"
                                Padding="10,4"
                                FontSize="11"/>
                    </StackPanel>
                </Border>
            </Grid>
        </Border>
    </Grid>
</UserControl>
