<UserControl x:Class="SAP.Views.ExpireWise.ExpireWiseView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:vm="clr-namespace:SAP.ViewModels"
             xmlns:local="clr-namespace:SAP.Views.ExpireWise"
             mc:Ignorable="d"
             d:DesignHeight="800" d:DesignWidth="1200"
             d:DataContext="{d:DesignInstance Type=vm:ExpireWiseViewModel}">

    <UserControl.Resources>
        <Storyboard x:Key="FadeInStoryboard">
            <DoubleAnimation Storyboard.TargetProperty="Opacity"
                           From="0" To="1" Duration="0:0:0.4">
                <DoubleAnimation.EasingFunction>
                    <QuadraticEase EasingMode="EaseOut"/>
                </DoubleAnimation.EasingFunction>
            </DoubleAnimation>
        </Storyboard>
        
        <!-- Sidebar Nav Button Style -->
        <Style x:Key="SidebarNavButton" TargetType="RadioButton">
            <Setter Property="Foreground" Value="{DynamicResource TextSecondaryBrush}"/>
            <Setter Property="FontSize" Value="13"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="RadioButton">
                        <Border x:Name="Bd" Background="Transparent" CornerRadius="10" Padding="14,12" Margin="0,2">
                            <ContentPresenter VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsChecked" Value="True">
                                <Setter TargetName="Bd" Property="Background" Value="{DynamicResource SurfaceHoverBrush}"/>
                                <Setter Property="Foreground" Value="{DynamicResource TextPrimaryBrush}"/>
                            </Trigger>
                            <MultiTrigger>
                                <MultiTrigger.Conditions>
                                    <Condition Property="IsMouseOver" Value="True"/>
                                    <Condition Property="IsChecked" Value="False"/>
                                </MultiTrigger.Conditions>
                                <Setter TargetName="Bd" Property="Background" Value="#1f1f23"/>
                            </MultiTrigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
        
        <!-- Sidebar Action Button -->
        <Style x:Key="SidebarActionButton" TargetType="Button">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="HorizontalContentAlignment" Value="Left"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border x:Name="Bd" Background="Transparent" CornerRadius="10" Padding="14,12" Margin="0,2">
                            <ContentPresenter/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="Bd" Property="Background" Value="#1f1f23"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
    </UserControl.Resources>

    <UserControl.Triggers>
        <EventTrigger RoutedEvent="Loaded">
            <BeginStoryboard Storyboard="{StaticResource FadeInStoryboard}"/>
        </EventTrigger>
    </UserControl.Triggers>

    <Grid>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="220"/>
            <ColumnDefinition Width="*"/>
        </Grid.ColumnDefinitions>
        
        <!-- Sidebar -->
        <Border Grid.Column="0" Background="{DynamicResource BackgroundBrush}">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>
                
                <!-- App Header -->
                <Border Grid.Row="0" Padding="20,24,20,20" BorderBrush="{DynamicResource SurfaceHoverBrush}" BorderThickness="0,0,0,1">
                    <StackPanel>
                        <Border Width="56" Height="56" CornerRadius="16" HorizontalAlignment="Left" Margin="0,0,0,16">
                            <Border.Background>
                                <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                                    <GradientStop Color="#f59e0b" Offset="0"/>
                                    <GradientStop Color="#d97706" Offset="1"/>
                                </LinearGradientBrush>
                            </Border.Background>
                            <TextBlock Text="â°" FontSize="28" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                        <TextBlock Text="ExpireWise" FontSize="20" FontWeight="Bold" Foreground="{DynamicResource TextPrimaryBrush}"/>
                        <TextBlock Text="Expiration Tracking" FontSize="12" Foreground="{DynamicResource TextTertiaryBrush}" Margin="0,4,0,0"/>
                    </StackPanel>
                </Border>
                
                <!-- Navigation -->
                <StackPanel Grid.Row="1" Margin="12,16,12,0">
                    <TextBlock Text="NAVIGATION" FontSize="10" FontWeight="SemiBold" Foreground="{DynamicResource TextDisabledBrush}" 
                               Margin="14,0,0,10" />
                    
                    <RadioButton x:Name="DataTab" GroupName="NavTabs" IsChecked="True" Style="{StaticResource SidebarNavButton}">
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Text="ðŸ“‹" FontSize="16" Margin="0,0,12,0"/>
                            <TextBlock Text="Data View" VerticalAlignment="Center"/>
                        </StackPanel>
                    </RadioButton>
                    
                    <RadioButton x:Name="AnalyticsTab" GroupName="NavTabs" Style="{StaticResource SidebarNavButton}">
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Text="ðŸ“Š" FontSize="16" Margin="0,0,12,0"/>
                            <TextBlock Text="Analytics" VerticalAlignment="Center"/>
                        </StackPanel>
                    </RadioButton>
                    
                    <Border Height="1" Background="{DynamicResource SurfaceHoverBrush}" Margin="0,16,0,16"/>
                    
                    <TextBlock Text="ACTIONS" FontSize="10" FontWeight="SemiBold" Foreground="{DynamicResource TextDisabledBrush}" 
                               Margin="14,0,0,10"/>
                    
                    <Button Command="{Binding AddItemCommand}" Style="{StaticResource SidebarActionButton}">
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Text="âž•" FontSize="16" Margin="0,0,12,0" Foreground="{DynamicResource TextSecondaryBrush}"/>
                            <TextBlock Text="Add Item" Foreground="{DynamicResource TextSecondaryBrush}" FontSize="13"/>
                        </StackPanel>
                    </Button>
                    
                    <Button Command="{Binding ImportFromExcelCommand}" Style="{StaticResource SidebarActionButton}">
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Text="ðŸ“¥" FontSize="16" Margin="0,0,12,0" Foreground="{DynamicResource TextSecondaryBrush}"/>
                            <TextBlock Text="Import Data" Foreground="{DynamicResource TextSecondaryBrush}" FontSize="13"/>
                        </StackPanel>
                    </Button>
                    
                    <Button Command="{Binding ExportToExcelCommand}" Style="{StaticResource SidebarActionButton}">
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Text="ðŸ“¤" FontSize="16" Margin="0,0,12,0" Foreground="{DynamicResource TextSecondaryBrush}"/>
                            <TextBlock Text="Export Data" Foreground="{DynamicResource TextSecondaryBrush}" FontSize="13"/>
                        </StackPanel>
                    </Button>
                </StackPanel>
                
                <!-- Bottom Section -->
                <StackPanel Grid.Row="2" Margin="12,0,12,16">
                    <Border Height="1" Background="{DynamicResource SurfaceHoverBrush}" Margin="0,0,0,12"/>
                    
                    <Button Command="{Binding OpenSettingsCommand}" Style="{StaticResource SidebarActionButton}">
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Text="âš™ï¸" FontSize="16" Margin="0,0,12,0"/>
                            <TextBlock Text="Settings" Foreground="{DynamicResource TextSecondaryBrush}" FontSize="13"/>
                        </StackPanel>
                    </Button>
                    
                    <!-- Status Info -->
                    <Border Background="{DynamicResource SurfaceBrush}" CornerRadius="10" Padding="14,12" Margin="0,8,0,0"
                            Visibility="{Binding LastSavedDisplay, Converter={StaticResource StringToVisibilityConverter}}">
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Text="âœ“" FontSize="12" Foreground="#10b981" Margin="0,0,8,0"/>
                            <TextBlock Text="{Binding LastSavedDisplay}" FontSize="11" Foreground="{DynamicResource TextTertiaryBrush}"/>
                        </StackPanel>
                    </Border>
                </StackPanel>
            </Grid>
        </Border>
        
        <!-- Main Content Area -->
        <Grid Grid.Column="1" Background="{DynamicResource BackgroundBrush}">
            <!-- Data View -->
            <Grid Visibility="{Binding IsChecked, ElementName=DataTab, Converter={StaticResource BooleanToVisibilityConverter}}">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>
                
                <!-- Header Bar -->
                <Border Grid.Row="0" Background="{DynamicResource SurfaceBrush}" Padding="20,16" BorderBrush="{DynamicResource SurfaceHoverBrush}" BorderThickness="0,0,0,1">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>
                        
                        <StackPanel Grid.Column="0">
                            <TextBlock Text="Expiration Data" FontSize="20" FontWeight="SemiBold" Foreground="{DynamicResource TextPrimaryBrush}"/>
                            <TextBlock Text="Track and manage items by expiration date" FontSize="13" Foreground="{DynamicResource TextTertiaryBrush}" Margin="0,4,0,0"/>
                        </StackPanel>
                        
                        <!-- Quick Actions -->
                        <StackPanel Grid.Column="1" Orientation="Horizontal">
                            <Button Command="{Binding EditItemCommand}" Style="{StaticResource SecondaryButton}" Margin="0,0,8,0">
                                <StackPanel Orientation="Horizontal">
                                    <TextBlock Text="âœï¸" FontSize="14" Margin="0,0,6,0"/>
                                    <TextBlock Text="Edit"/>
                                </StackPanel>
                            </Button>
                            <Button Command="{Binding DeleteItemCommand}" Style="{StaticResource DangerButton}">
                                <StackPanel Orientation="Horizontal">
                                    <TextBlock Text="ðŸ—‘ï¸" FontSize="14" Margin="0,0,6,0"/>
                                    <TextBlock Text="Delete"/>
                                </StackPanel>
                            </Button>
                        </StackPanel>
                    </Grid>
                </Border>
                
                <!-- Month Navigator -->
                <Border Grid.Row="1" Background="{DynamicResource SurfaceBrush}" BorderBrush="{DynamicResource SurfaceHoverBrush}" BorderThickness="0,0,0,1" Padding="20,14">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>

                        <!-- Left Stats -->
                        <StackPanel Grid.Column="0" Orientation="Horizontal" VerticalAlignment="Center">
                            <Border Background="{DynamicResource SurfaceHoverBrush}" CornerRadius="8" Padding="14,8" Margin="0,0,12,0">
                                <StackPanel Orientation="Horizontal">
                                    <TextBlock Text="ðŸ“¦" FontSize="14" VerticalAlignment="Center" Margin="0,0,8,0"/>
                                    <TextBlock Text="{Binding TotalItems}" FontSize="16" FontWeight="Bold" 
                                               Foreground="{DynamicResource TextPrimaryBrush}" VerticalAlignment="Center"/>
                                    <TextBlock Text=" total" FontSize="12" 
                                               Foreground="{DynamicResource TextSecondaryBrush}" VerticalAlignment="Center"/>
                                </StackPanel>
                            </Border>
                        </StackPanel>

                        <!-- Center - Month Navigator -->
                        <StackPanel Grid.Column="1" Orientation="Horizontal" HorizontalAlignment="Center">
                            <Button Command="{Binding PreviousMonthCommand}" 
                                    IsEnabled="{Binding CanGoToPreviousMonth}"
                                    Style="{StaticResource SecondaryButton}"
                                    Width="40" Height="40" Padding="0" Margin="0,0,8,0">
                                <TextBlock Text="â—€" FontSize="16" HorizontalAlignment="Center"/>
                            </Button>
                            
                            <Border CornerRadius="8" Padding="24,8" MinWidth="200">
                                <Border.Background>
                                    <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                                        <GradientStop Color="#f59e0b" Offset="0"/>
                                        <GradientStop Color="#d97706" Offset="1"/>
                                    </LinearGradientBrush>
                                </Border.Background>
                                <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                                    <TextBlock Text="{Binding CurrentMonthDisplay}" 
                                               FontSize="16" FontWeight="Bold" Foreground="White"
                                               VerticalAlignment="Center"/>
                                    <Border Background="{DynamicResource SurfaceBrush}" CornerRadius="10" 
                                            Padding="8,2" Margin="12,0,0,0" VerticalAlignment="Center">
                                        <TextBlock Text="{Binding MonthItemCount}" FontSize="12" 
                                                   FontWeight="Bold" Foreground="{DynamicResource TextPrimaryBrush}"/>
                                    </Border>
                                </StackPanel>
                            </Border>
                            
                            <Button Command="{Binding NextMonthCommand}" 
                                    IsEnabled="{Binding CanGoToNextMonth}"
                                    Style="{StaticResource SecondaryButton}"
                                    Width="40" Height="40" Padding="0" Margin="8,0,0,0">
                                <TextBlock Text="â–¶" FontSize="16" HorizontalAlignment="Center"/>
                            </Button>
                        </StackPanel>

                        <!-- Right Stats -->
                        <StackPanel Grid.Column="2" Orientation="Horizontal" VerticalAlignment="Center" HorizontalAlignment="Right">
                            <Border Background="#422006" CornerRadius="8" Padding="14,8" Margin="0,0,12,0">
                                <StackPanel Orientation="Horizontal">
                                    <TextBlock Text="{Binding MonthItemCount}" FontSize="16" FontWeight="Bold" 
                                               Foreground="#fbbf24" VerticalAlignment="Center"/>
                                    <TextBlock Text=" items" FontSize="12" 
                                               Foreground="#fcd34d" VerticalAlignment="Center" Margin="4,0,0,0"/>
                                    <TextBlock Text=" â€¢" Foreground="#fcd34d" Margin="8,0"/>
                                    <TextBlock Text="{Binding MonthTotalUnits}" FontSize="16" FontWeight="Bold" 
                                               Foreground="#fbbf24" VerticalAlignment="Center"/>
                                    <TextBlock Text=" units" FontSize="12" 
                                               Foreground="#fcd34d" VerticalAlignment="Center" Margin="4,0,0,0"/>
                                </StackPanel>
                            </Border>
                            <Border Background="#450a0a" CornerRadius="8" Padding="12,8" 
                                    Visibility="{Binding CriticalCount, Converter={StaticResource CountToVisibility}}">
                                <StackPanel Orientation="Horizontal">
                                    <TextBlock Text="ðŸš¨" FontSize="12" VerticalAlignment="Center" Margin="0,0,6,0"/>
                                    <TextBlock Text="{Binding CriticalCount}" FontSize="14" FontWeight="Bold" 
                                               Foreground="#f87171" VerticalAlignment="Center"/>
                                    <TextBlock Text=" critical" FontSize="11" 
                                               Foreground="#f87171" VerticalAlignment="Center" Margin="4,0,0,0"/>
                                </StackPanel>
                            </Border>
                        </StackPanel>
                    </Grid>
                </Border>

                <!-- Search Bar -->
                <Border Grid.Row="2" Background="{DynamicResource SurfaceBrush}" Padding="20,12" BorderBrush="{DynamicResource SurfaceHoverBrush}" BorderThickness="0,0,0,1">
                    <TextBox Text="{Binding SearchText, UpdateSourceTrigger=PropertyChanged}">
                        <TextBox.Style>
                            <Style TargetType="TextBox" BasedOn="{StaticResource ModernTextBox}">
                                <Style.Triggers>
                                    <Trigger Property="Text" Value="">
                                        <Setter Property="Background">
                                            <Setter.Value>
                                                <VisualBrush Stretch="None" AlignmentX="Left">
                                                    <VisualBrush.Visual>
                                                        <TextBlock Text="ðŸ” Search items in this month..."
                                                                 Foreground="{DynamicResource TextTertiaryBrush}" Margin="12,0,0,0"/>
                                                    </VisualBrush.Visual>
                                                </VisualBrush>
                                            </Setter.Value>
                                        </Setter>
                                    </Trigger>
                                </Style.Triggers>
                            </Style>
                        </TextBox.Style>
                    </TextBox>
                </Border>
                
                <!-- Data Grid -->
                <Grid Grid.Row="3" Margin="20">
                    <DataGrid ItemsSource="{Binding FilteredItems}"
                              SelectedItem="{Binding SelectedItem}"
                              Style="{StaticResource ModernDataGrid}"
                              ColumnHeaderStyle="{StaticResource ModernDataGridColumnHeader}"
                              CellStyle="{StaticResource ModernDataGridCell}"
                              RowStyle="{StaticResource ModernDataGridRow}">
                        <DataGrid.Columns>
                            <DataGridTextColumn Header="Item Number" Binding="{Binding ItemNumber}" Width="120"/>
                            <DataGridTextColumn Header="Description" Binding="{Binding Description}" Width="*"/>
                            <DataGridTextColumn Header="Expiration Date" Binding="{Binding ExpirationDate, StringFormat='{}{0:MM/dd/yyyy}'}" Width="120"/>
                            <DataGridTextColumn Header="Quantity" Binding="{Binding Quantity}" Width="80"/>
                            <DataGridTemplateColumn Header="Status" Width="100">
                                <DataGridTemplateColumn.CellTemplate>
                                    <DataTemplate>
                                        <Border CornerRadius="4" Padding="8,4" HorizontalAlignment="Center">
                                            <Border.Style>
                                                <Style TargetType="Border">
                                                    <Setter Property="Background" Value="{StaticResource SuccessBrush}"/>
                                                    <Style.Triggers>
                                                        <DataTrigger Binding="{Binding Status}" Value="Warning">
                                                            <Setter Property="Background" Value="{StaticResource WarningBrush}"/>
                                                        </DataTrigger>
                                                        <DataTrigger Binding="{Binding Status}" Value="Critical">
                                                            <Setter Property="Background" Value="{StaticResource DangerBrush}"/>
                                                        </DataTrigger>
                                                        <DataTrigger Binding="{Binding Status}" Value="Expired">
                                                            <Setter Property="Background" Value="{DynamicResource TextTertiaryBrush}"/>
                                                        </DataTrigger>
                                                    </Style.Triggers>
                                                </Style>
                                            </Border.Style>
                                            <TextBlock Text="{Binding Status}" FontWeight="SemiBold" 
                                                       Foreground="White" FontSize="10"/>
                                        </Border>
                                    </DataTemplate>
                                </DataGridTemplateColumn.CellTemplate>
                            </DataGridTemplateColumn>
                        </DataGrid.Columns>
                    </DataGrid>
                </Grid>

                <!-- Status Bar -->
                <Border Grid.Row="4" Background="{DynamicResource SurfaceBrush}" Padding="20,12" BorderBrush="{DynamicResource SurfaceHoverBrush}" BorderThickness="0,1,0,0">
                    <Grid>
                        <TextBlock Text="{Binding StatusMessage}" Foreground="{DynamicResource TextSecondaryBrush}" FontSize="12"/>
                        <StackPanel Orientation="Horizontal" HorizontalAlignment="Right"
                                    Visibility="{Binding IsLoading, Converter={StaticResource BooleanToVisibilityConverter}}">
                            <TextBlock Text="â³" FontSize="12" Margin="0,0,8,0"/>
                            <TextBlock Text="Loading..." Foreground="{DynamicResource TextSecondaryBrush}" FontSize="12"/>
                        </StackPanel>
                    </Grid>
                </Border>
            </Grid>

            <!-- Analytics View -->
            <local:ExpireWiseAnalyticsView DataContext="{Binding Analytics}"
                                           Visibility="{Binding IsChecked, ElementName=AnalyticsTab, Converter={StaticResource BooleanToVisibilityConverter}}"/>
        </Grid>
    </Grid>
</UserControl>





