<UserControl x:Class="SOUP.Features.ExpireWise.Views.QuickAddPanel"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:vm="clr-namespace:SOUP.ViewModels"
             mc:Ignorable="d"
             d:DataContext="{d:DesignInstance Type=vm:ExpireWiseViewModel}"
             d:DesignHeight="600" d:DesignWidth="380">

    <UserControl.Resources>
        <!-- ExpireWise Accent Colors -->
        <Color x:Key="ExpireWiseAccentColor">#f59e0b</Color>
        <Color x:Key="ExpireWiseAccentLightColor">#fbbf24</Color>
        <Color x:Key="ExpireWiseAccentDarkColor">#d97706</Color>
        <SolidColorBrush x:Key="ExpireWiseAccentBrush" Color="{StaticResource ExpireWiseAccentColor}"/>
        <SolidColorBrush x:Key="ExpireWiseAccentLightBrush" Color="{StaticResource ExpireWiseAccentLightColor}"/>
        <SolidColorBrush x:Key="ExpireWiseAccentDarkBrush" Color="{StaticResource ExpireWiseAccentDarkColor}"/>

        <!-- Input Field Style -->
        <Style x:Key="InputField" TargetType="Border">
            <Setter Property="Background" Value="{DynamicResource BackgroundBrush}"/>
            <Setter Property="CornerRadius" Value="10"/>
            <Setter Property="Padding" Value="14,12"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="BorderBrush" Value="Transparent"/>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="BorderBrush" Value="{DynamicResource BorderBrush}"/>
                </Trigger>
            </Style.Triggers>
        </Style>

        <!-- Label Style -->
        <Style x:Key="FieldLabel" TargetType="TextBlock">
            <Setter Property="FontSize" Value="11"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="Foreground" Value="{DynamicResource TextSecondaryBrush}"/>
            <Setter Property="Margin" Value="4,0,0,6"/>
        </Style>
    </UserControl.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/> <!-- Form -->
            <RowDefinition Height="*"/>    <!-- Queue -->
        </Grid.RowDefinitions>

        <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
        <!-- FORM SECTION -->
        <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
        <StackPanel Grid.Row="0" Margin="16,12,16,0">
            
            <!-- SKU/Item Number - Multiline -->
            <StackPanel Orientation="Horizontal" Margin="0,0,0,6">
                <TextBlock Text="SKU / ITEM NUMBER" Style="{StaticResource FieldLabel}" Margin="4,0,0,0"/>
                <TextBlock Text="(one per line, or paste SKU + Qty from Excel)" 
                           FontSize="10" Foreground="{DynamicResource TextTertiaryBrush}" 
                           Margin="8,0,0,0" VerticalAlignment="Center"/>
            </StackPanel>
            
            <Border Style="{StaticResource InputField}" Margin="0,0,0,14">
                <TextBox x:Name="SkuInput"
                         Text="{Binding QuickAddSku, UpdateSourceTrigger=PropertyChanged}"
                         Background="Transparent" BorderThickness="0"
                         Foreground="{DynamicResource TextPrimaryBrush}"
                         FontSize="13" FontFamily="Consolas"
                         AcceptsReturn="True" AcceptsTab="False"
                         TextWrapping="NoWrap"
                         MinHeight="60" MaxHeight="100"
                         VerticalScrollBarVisibility="Auto"
                         HorizontalScrollBarVisibility="Disabled"
                         VerticalContentAlignment="Top"
                         CaretBrush="{DynamicResource TextPrimaryBrush}">
                    <TextBox.Style>
                        <Style TargetType="TextBox">
                            <Style.Triggers>
                                <Trigger Property="Text" Value="">
                                    <Setter Property="Background">
                                        <Setter.Value>
                                            <VisualBrush Stretch="None" AlignmentX="Left" AlignmentY="Top">
                                                <VisualBrush.Visual>
                                                    <TextBlock Text="Enter SKUs (one per line)..." 
                                                               FontSize="13" Foreground="{DynamicResource TextTertiaryBrush}"
                                                               Margin="0,1,0,0"/>
                                                </VisualBrush.Visual>
                                            </VisualBrush>
                                        </Setter.Value>
                                    </Setter>
                                </Trigger>
                                <Trigger Property="Text" Value="{x:Null}">
                                    <Setter Property="Background">
                                        <Setter.Value>
                                            <VisualBrush Stretch="None" AlignmentX="Left" AlignmentY="Top">
                                                <VisualBrush.Visual>
                                                    <TextBlock Text="Enter SKUs (one per line)..." 
                                                               FontSize="13" Foreground="{DynamicResource TextTertiaryBrush}"
                                                               Margin="0,1,0,0"/>
                                                </VisualBrush.Visual>
                                            </VisualBrush>
                                        </Setter.Value>
                                    </Setter>
                                </Trigger>
                            </Style.Triggers>
                        </Style>
                    </TextBox.Style>
                </TextBox>
            </Border>

            <!-- Validation Status Summary - shown when input has content -->
            <Border CornerRadius="10" Padding="12" Margin="0,0,0,14"
                    Visibility="{Binding QuickAddSku, Converter={StaticResource StringToVisibilityConverter}}">
                <Border.Style>
                    <Style TargetType="Border">
                        <Setter Property="Background">
                            <Setter.Value>
                                <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                                    <GradientStop Color="#15f59e0b" Offset="0"/>
                                    <GradientStop Color="#10d97706" Offset="1"/>
                                </LinearGradientBrush>
                            </Setter.Value>
                        </Setter>
                        <Style.Triggers>
                            <DataTrigger Binding="{Binding QuickAddIsValidating}" Value="True">
                                <Setter Property="Background" Value="{DynamicResource SurfaceHoverBrush}"/>
                            </DataTrigger>
                            <DataTrigger Binding="{Binding QuickAddHasErrors}" Value="True">
                                <Setter Property="Background">
                                    <Setter.Value>
                                        <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                                            <GradientStop Color="#20ef4444" Offset="0"/>
                                            <GradientStop Color="#10dc2626" Offset="1"/>
                                        </LinearGradientBrush>
                                    </Setter.Value>
                                </Setter>
                            </DataTrigger>
                        </Style.Triggers>
                    </Style>
                </Border.Style>
                <Border.BorderBrush>
                    <LinearGradientBrush StartPoint="0,0" EndPoint="1,0">
                        <GradientStop Color="#40f59e0b" Offset="0"/>
                        <GradientStop Color="#20d97706" Offset="1"/>
                    </LinearGradientBrush>
                </Border.BorderBrush>
                <Border.BorderThickness>1</Border.BorderThickness>
                <StackPanel>
                    <StackPanel Orientation="Horizontal" Margin="0,0,0,4">
                        <TextBlock FontSize="12" Margin="0,0,6,0">
                            <TextBlock.Style>
                                <Style TargetType="TextBlock">
                                    <Setter Property="Text" Value="âœ“"/>
                                    <Setter Property="Foreground" Value="{DynamicResource SuccessBrush}"/>
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding QuickAddIsValidating}" Value="True">
                                            <Setter Property="Text" Value="â³"/>
                                            <Setter Property="Foreground" Value="{DynamicResource TextSecondaryBrush}"/>
                                        </DataTrigger>
                                        <DataTrigger Binding="{Binding QuickAddHasErrors}" Value="True">
                                            <Setter Property="Text" Value="âš "/>
                                            <Setter Property="Foreground" Value="{DynamicResource WarningBrush}"/>
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </TextBlock.Style>
                        </TextBlock>
                        <TextBlock Text="{Binding QuickAddItemPreview}" FontSize="11" FontWeight="SemiBold"
                                   Foreground="{DynamicResource TextSecondaryBrush}"/>
                    </StackPanel>
                </StackPanel>
            </Border>

            <!-- Store Selection -->
            <TextBlock Text="STORE" Style="{StaticResource FieldLabel}"/>
            <ComboBox ItemsSource="{Binding AvailableStores}"
                      SelectedItem="{Binding QuickAddStore}"
                      DisplayMemberPath="Name"
                      Style="{StaticResource ModernComboBoxStyle}"
                      Margin="0,0,0,14"/>

            <!-- Expiration Date -->
            <TextBlock Text="EXPIRATION" Style="{StaticResource FieldLabel}"/>
            <Grid Margin="0,0,0,14">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="8"/>
                    <ColumnDefinition Width="80"/>
                </Grid.ColumnDefinitions>
                <ComboBox Grid.Column="0"
                          ItemsSource="{Binding QuickAddMonths}"
                          SelectedValue="{Binding QuickAddMonth}"
                          SelectedValuePath="Value"
                          DisplayMemberPath="Name"
                          Style="{StaticResource ModernComboBoxStyle}"/>
                <ComboBox Grid.Column="2"
                          ItemsSource="{Binding QuickAddYears}"
                          SelectedItem="{Binding QuickAddYear}"
                          Style="{StaticResource ModernComboBoxStyle}"/>
            </Grid>

            <!-- Add Button -->
            <Button Command="{Binding AddToQueueCommand}" Margin="0,4,0,0"
                    IsEnabled="{Binding QuickAddIsValid}">
                <Button.Style>
                    <Style TargetType="Button" BasedOn="{StaticResource PrimaryButton}">
                        <Setter Property="Padding" Value="0,12"/>
                        <Setter Property="Background">
                            <Setter.Value>
                                <LinearGradientBrush StartPoint="0,0" EndPoint="1,0">
                                    <GradientStop Color="{StaticResource ExpireWiseAccentColor}" Offset="0"/>
                                    <GradientStop Color="{StaticResource ExpireWiseAccentLightColor}" Offset="1"/>
                                </LinearGradientBrush>
                            </Setter.Value>
                        </Setter>
                        <Setter Property="Foreground" Value="{DynamicResource TextOnAccentBrush}"/>
                        <Style.Triggers>
                            <Trigger Property="IsEnabled" Value="False">
                                <Setter Property="Opacity" Value="0.4"/>
                            </Trigger>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="Background">
                                    <Setter.Value>
                                        <LinearGradientBrush StartPoint="0,0" EndPoint="1,0">
                                            <GradientStop Color="{StaticResource ExpireWiseAccentLightColor}" Offset="0"/>
                                            <GradientStop Color="{StaticResource ExpireWiseAccentColor}" Offset="1"/>
                                        </LinearGradientBrush>
                                    </Setter.Value>
                                </Setter>
                            </Trigger>
                        </Style.Triggers>
                    </Style>
                </Button.Style>
                <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                    <TextBlock Text="ï¼‹" FontSize="16" FontWeight="Bold" Margin="0,0,8,0"/>
                    <TextBlock Text="Add to Queue" FontSize="13" FontWeight="SemiBold"/>
                </StackPanel>
            </Button>
        </StackPanel>

        <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
        <!-- QUEUE SECTION -->
        <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
        <Border Grid.Row="1" Margin="16,20,16,16"
                Visibility="{Binding HasQueuedItems, Converter={StaticResource BoolToVisibilityConverter}}">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <!-- Queue Header -->
                <Border Grid.Row="0" Background="{DynamicResource BackgroundBrush}" 
                        CornerRadius="10" Padding="12,10" Margin="0,0,0,10">
                    <Grid>
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Text="ðŸ“‹" FontSize="14" Margin="0,0,8,0" VerticalAlignment="Center"/>
                            <TextBlock Text="Queue" FontSize="13" FontWeight="SemiBold"
                                       Foreground="{DynamicResource TextPrimaryBrush}" VerticalAlignment="Center"/>
                            <Border Background="{StaticResource ExpireWiseAccentBrush}" CornerRadius="8"
                                    Padding="8,2" Margin="8,0,0,0">
                                <TextBlock Text="{Binding QuickAddQueue.Count}" FontSize="11" FontWeight="Bold"
                                           Foreground="{DynamicResource TextOnAccentBrush}"/>
                            </Border>
                        </StackPanel>
                        <Button Content="Clear" Command="{Binding ClearQueueCommand}"
                                HorizontalAlignment="Right"
                                Style="{StaticResource SecondaryButton}"
                                Padding="10,4" FontSize="11"/>
                    </Grid>
                </Border>

                <!-- Queue Items List -->
                <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto">
                    <ItemsControl ItemsSource="{Binding QuickAddQueue}">
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <Border Background="{DynamicResource BackgroundBrush}"
                                        CornerRadius="8" Padding="10,8" Margin="0,0,0,6"
                                        BorderThickness="1" BorderBrush="Transparent">
                                    <Border.Style>
                                        <Style TargetType="Border">
                                            <Style.Triggers>
                                                <Trigger Property="IsMouseOver" Value="True">
                                                    <Setter Property="BorderBrush" Value="{DynamicResource BorderBrush}"/>
                                                </Trigger>
                                            </Style.Triggers>
                                        </Style>
                                    </Border.Style>
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="Auto"/> <!-- Quantity -->
                                            <ColumnDefinition Width="*"/>    <!-- Details -->
                                            <ColumnDefinition Width="Auto"/> <!-- Remove -->
                                        </Grid.ColumnDefinitions>

                                        <!-- Editable Quantity -->
                                        <Border Grid.Column="0" Background="{DynamicResource SurfaceBrush}" 
                                                CornerRadius="6" Margin="0,0,10,0" MinWidth="52">
                                            <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                                                <Button Content="âˆ’" ToolTip="Decrease"
                                                        Command="{Binding DataContext.DecreaseQueueItemQuantityCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                                        CommandParameter="{Binding}"
                                                        Width="22" Height="28" FontSize="14" FontWeight="Bold"
                                                        Background="Transparent" BorderThickness="0" Cursor="Hand"
                                                        Foreground="{DynamicResource TextSecondaryBrush}"/>
                                                <TextBlock Text="{Binding Quantity}" FontSize="14" FontWeight="Bold"
                                                           Foreground="{StaticResource ExpireWiseAccentLightBrush}"
                                                           VerticalAlignment="Center" MinWidth="20" TextAlignment="Center"/>
                                                <Button Content="ï¼‹" ToolTip="Increase"
                                                        Command="{Binding DataContext.IncreaseQueueItemQuantityCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                                        CommandParameter="{Binding}"
                                                        Width="22" Height="28" FontSize="12" FontWeight="Bold"
                                                        Background="Transparent" BorderThickness="0" Cursor="Hand"
                                                        Foreground="{DynamicResource TextSecondaryBrush}"/>
                                            </StackPanel>
                                        </Border>

                                        <!-- Item Details -->
                                        <StackPanel Grid.Column="1" VerticalAlignment="Center">
                                            <TextBlock FontSize="12" FontWeight="SemiBold"
                                                       Foreground="{DynamicResource TextPrimaryBrush}"
                                                       TextTrimming="CharacterEllipsis">
                                                <Run Text="{Binding Description}"/>
                                            </TextBlock>
                                            <WrapPanel Margin="0,4,0,0">
                                                <Border Background="{DynamicResource SurfaceBrush}" 
                                                        CornerRadius="4" Padding="5,2" Margin="0,0,5,0">
                                                    <TextBlock FontSize="10" Foreground="{DynamicResource TextSecondaryBrush}"
                                                               Text="{Binding Location, Mode=OneWay}"/>
                                                </Border>
                                                <Border Background="{DynamicResource SurfaceBrush}" 
                                                        CornerRadius="4" Padding="5,2">
                                                    <TextBlock FontSize="10" Foreground="{DynamicResource TextSecondaryBrush}"
                                                               Text="{Binding ExpiryDate, StringFormat='End of MMM yyyy', Mode=OneWay}"/>
                                                </Border>
                                            </WrapPanel>
                                        </StackPanel>

                                        <Button Grid.Column="2" Content="âœ•" ToolTip="Remove"
                                                Command="{Binding DataContext.RemoveFromQueueCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                                CommandParameter="{Binding}"
                                                Style="{StaticResource IconButton}"
                                                Width="24" Height="24" FontSize="11"
                                                Foreground="{DynamicResource TextTertiaryBrush}"
                                                VerticalAlignment="Center" Margin="6,0,0,0"/>
                                    </Grid>
                                </Border>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </ScrollViewer>

                <!-- Confirm Button -->
                <Button Grid.Row="2" Command="{Binding ConfirmQueueCommand}" Margin="0,10,0,0">
                    <Button.Style>
                        <Style TargetType="Button" BasedOn="{StaticResource PrimaryButton}">
                            <Setter Property="Background" Value="{DynamicResource SuccessBrush}"/>
                            <Setter Property="Foreground" Value="{DynamicResource TextOnPrimaryBrush}"/>
                            <Setter Property="Padding" Value="0,12"/>
                        </Style>
                    </Button.Style>
                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                        <TextBlock Text="âœ“" FontSize="14" FontWeight="Bold" Margin="0,0,8,0"/>
                        <TextBlock Text="Confirm All" FontSize="13" FontWeight="SemiBold"/>
                    </StackPanel>
                </Button>
            </Grid>
        </Border>

        <!-- Empty Queue State -->
        <StackPanel Grid.Row="1" VerticalAlignment="Center" HorizontalAlignment="Center"
                    Visibility="{Binding HasQueuedItems, Converter={StaticResource BoolToVisibilityConverter}, ConverterParameter=Invert}"
                    Margin="20">
            <TextBlock Text="ðŸ“¦" FontSize="36" HorizontalAlignment="Center" Opacity="0.35"/>
            <TextBlock Text="No items in queue" FontSize="12" 
                       Foreground="{DynamicResource TextTertiaryBrush}" 
                       HorizontalAlignment="Center" Margin="0,10,0,0"/>
            <TextBlock Text="Scan or enter a SKU above" FontSize="11" 
                       Foreground="{DynamicResource TextTertiaryBrush}" 
                       HorizontalAlignment="Center" Margin="0,2,0,0" Opacity="0.7"/>
        </StackPanel>
    </Grid>
</UserControl>
