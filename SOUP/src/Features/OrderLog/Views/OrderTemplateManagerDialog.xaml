<Window x:Class="SOUP.Features.OrderLog.Views.OrderTemplateManagerDialog"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:models="clr-namespace:SOUP.Features.OrderLog.Models"
        xmlns:local="clr-namespace:SOUP.Features.OrderLog.Views"
        Title="Template Manager"
        Height="600"
        Width="700"
        WindowStartupLocation="CenterOwner"
        WindowStyle="None"
        AllowsTransparency="True"
        Background="Transparent"
        ResizeMode="NoResize"
        ShowInTaskbar="False">

    <Border Background="{DynamicResource BackgroundBrush}"
            CornerRadius="12"
            BorderBrush="{DynamicResource BorderBrush}"
            BorderThickness="1">
        <Border.Effect>
            <DropShadowEffect BlurRadius="20" ShadowDepth="0" Opacity="0.3" Color="#000000"/>
        </Border.Effect>

        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>

            <!-- Title Bar -->
            <Border Background="{DynamicResource BackgroundBrush}"
                    CornerRadius="12,12,0,0"
                    Padding="20,14"
                    MouseLeftButtonDown="TitleBar_MouseDown">
                <Grid>
                    <TextBlock Text="Template Manager"
                               FontSize="16"
                               FontWeight="SemiBold"
                               Foreground="{DynamicResource TextPrimaryBrush}"/>

                    <Button Content="âœ•"
                            HorizontalAlignment="Right"
                            Click="Close_Click"
                            Style="{DynamicResource GhostButtonStyle}"
                            FontSize="16"
                            Width="32"
                            Height="32"
                            Padding="0"/>
                </Grid>
            </Border>

            <!-- Content -->
            <Grid Grid.Row="1" Margin="20">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="2*"/>
                    <ColumnDefinition Width="12"/>
                    <ColumnDefinition Width="1.2*"/>
                </Grid.ColumnDefinitions>

                <!-- Left Side: Template List -->
                <Grid Grid.Column="0">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>

                    <!-- Sort Controls -->
                    <Grid Margin="0,0,0,12">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="12"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>

                        <TextBlock Text="Sort by:"
                                   VerticalAlignment="Center"
                                   Foreground="{DynamicResource TextSecondaryBrush}"
                                   FontSize="13"/>

                        <ComboBox x:Name="SortComboBox"
                                  Grid.Column="2"
                                  SelectionChanged="SortComboBox_SelectionChanged"
                                  FontSize="13"
                                  Padding="8,6"
                                  Background="{DynamicResource SurfaceBrush}"
                                  BorderBrush="{DynamicResource BorderBrush}"
                                  BorderThickness="1">
                            <ComboBoxItem Content="Name" IsSelected="True"/>
                            <ComboBoxItem Content="Most Used"/>
                            <ComboBoxItem Content="Date Created"/>
                        </ComboBox>
                    </Grid>

                    <!-- Template List -->
                    <Border Grid.Row="1"
                            Background="{DynamicResource SurfaceHoverBrush}"
                            BorderBrush="{DynamicResource BorderBrush}"
                            BorderThickness="1"
                            CornerRadius="8">
                        <ScrollViewer VerticalScrollBarVisibility="Auto">
                            <ListBox x:Name="TemplateListBox"
                                     SelectionChanged="TemplateListBox_SelectionChanged"
                                     Background="Transparent"
                                     BorderThickness="0"
                                     Padding="8">
                                <ListBox.ItemTemplate>
                                    <DataTemplate>
                                        <Border Padding="12,10"
                                                Background="Transparent"
                                                CornerRadius="6">
                                            <Grid>
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="Auto"/>
                                                    <ColumnDefinition Width="*"/>
                                                    <ColumnDefinition Width="Auto"/>
                                                </Grid.ColumnDefinitions>

                                                <!-- Color Indicator -->
                                                <Border Width="4"
                                                        Height="32"
                                                        Background="{Binding ColorHex}"
                                                        CornerRadius="2"
                                                        Margin="0,0,12,0"/>

                                                <!-- Template Info -->
                                                <StackPanel Grid.Column="1">
                                                    <TextBlock Text="{Binding Name}"
                                                               FontSize="13"
                                                               FontWeight="SemiBold"
                                                               Foreground="{DynamicResource TextPrimaryBrush}"/>
                                                    <TextBlock FontSize="12"
                                                               Foreground="{DynamicResource TextSecondaryBrush}">
                                                        <Run Text="{Binding VendorName, TargetNullValue='(No vendor)'}"/>
                                                    </TextBlock>
                                                </StackPanel>

                                                <!-- Use Count Badge -->
                                                <Border Grid.Column="2"
                                                        Background="{DynamicResource SurfaceBrush}"
                                                        CornerRadius="10"
                                                        Padding="8,4"
                                                        VerticalAlignment="Center">
                                                    <TextBlock FontSize="11"
                                                               Foreground="{DynamicResource TextSecondaryBrush}">
                                                        <Run Text="Used:"/>
                                                        <Run Text="{Binding UseCount}" FontWeight="SemiBold"/>
                                                    </TextBlock>
                                                </Border>
                                            </Grid>
                                        </Border>
                                    </DataTemplate>
                                </ListBox.ItemTemplate>
                            </ListBox>
                        </ScrollViewer>
                    </Border>

                    <!-- Action Buttons -->
                    <UniformGrid Grid.Row="2"
                                 Rows="1"
                                 Columns="4"
                                 Margin="0,12,0,0">
                        <Button Content="New"
                                Click="New_Click"
                                Style="{DynamicResource SecondaryButtonStyle}"
                                Padding="0,10"
                                Margin="0,0,4,0"/>

                        <Button Content="Edit"
                                Click="Edit_Click"
                                Style="{DynamicResource SecondaryButtonStyle}"
                                Padding="0,10"
                                Margin="4,0,4,0"
                                IsEnabled="{Binding SelectedItem, ElementName=TemplateListBox, Converter={StaticResource NullToBooleanConverter}}"/>

                        <Button Content="Duplicate"
                                Click="Duplicate_Click"
                                Style="{DynamicResource SecondaryButtonStyle}"
                                Padding="0,10"
                                Margin="4,0,4,0"
                                IsEnabled="{Binding SelectedItem, ElementName=TemplateListBox, Converter={StaticResource NullToBooleanConverter}}"/>

                        <Button Content="Delete"
                                Click="Delete_Click"
                                Style="{DynamicResource SecondaryButtonStyle}"
                                Padding="0,10"
                                Margin="4,0,0,0"
                                IsEnabled="{Binding SelectedItem, ElementName=TemplateListBox, Converter={StaticResource NullToBooleanConverter}}"/>
                    </UniformGrid>
                </Grid>

                <!-- Right Side: Preview Panel -->
                <Border Grid.Column="2"
                        Background="{DynamicResource SurfaceHoverBrush}"
                        BorderBrush="{DynamicResource BorderBrush}"
                        BorderThickness="1"
                        CornerRadius="8"
                        Padding="16">
                    <ScrollViewer VerticalScrollBarVisibility="Auto">
                        <StackPanel x:Name="PreviewPanel">
                            <!-- Preview Header -->
                            <TextBlock Text="Template Preview"
                                       FontSize="14"
                                       FontWeight="SemiBold"
                                       Foreground="{DynamicResource TextPrimaryBrush}"
                                       Margin="0,0,0,16"/>

                            <!-- Empty State -->
                            <TextBlock x:Name="EmptyStateText"
                                       Text="Select a template to preview"
                                       FontSize="13"
                                       Foreground="{DynamicResource TextSecondaryBrush}"
                                       TextAlignment="Center"
                                       Margin="0,40,0,0"
                                       Visibility="Visible"/>

                            <!-- Preview Content (Hidden by default) -->
                            <StackPanel x:Name="PreviewContent"
                                        Visibility="Collapsed">
                                <!-- Template Name -->
                                <TextBlock Text="Name"
                                           FontSize="11"
                                           Foreground="{DynamicResource TextSecondaryBrush}"
                                           Margin="0,0,0,4"/>
                                <TextBlock x:Name="PreviewName"
                                           FontSize="13"
                                           FontWeight="SemiBold"
                                           Foreground="{DynamicResource TextPrimaryBrush}"
                                           Margin="0,0,0,12"
                                           TextWrapping="Wrap"/>

                                <!-- Vendor Name -->
                                <TextBlock Text="Vendor"
                                           FontSize="11"
                                           Foreground="{DynamicResource TextSecondaryBrush}"
                                           Margin="0,0,0,4"/>
                                <TextBlock x:Name="PreviewVendor"
                                           FontSize="13"
                                           Foreground="{DynamicResource TextPrimaryBrush}"
                                           Margin="0,0,0,12"
                                           TextWrapping="Wrap"/>

                                <!-- Transfer Numbers -->
                                <TextBlock Text="Transfer Numbers"
                                           FontSize="11"
                                           Foreground="{DynamicResource TextSecondaryBrush}"
                                           Margin="0,0,0,4"/>
                                <TextBlock x:Name="PreviewTransferNumbers"
                                           FontSize="13"
                                           Foreground="{DynamicResource TextPrimaryBrush}"
                                           Margin="0,0,0,12"
                                           TextWrapping="Wrap"/>

                                <!-- WHS Shipment Numbers -->
                                <TextBlock Text="WHS Shipment Numbers"
                                           FontSize="11"
                                           Foreground="{DynamicResource TextSecondaryBrush}"
                                           Margin="0,0,0,4"/>
                                <TextBlock x:Name="PreviewWhsNumbers"
                                           FontSize="13"
                                           Foreground="{DynamicResource TextPrimaryBrush}"
                                           Margin="0,0,0,12"
                                           TextWrapping="Wrap"/>

                                <!-- Default Status -->
                                <TextBlock Text="Default Status"
                                           FontSize="11"
                                           Foreground="{DynamicResource TextSecondaryBrush}"
                                           Margin="0,0,0,4"/>
                                <TextBlock x:Name="PreviewStatus"
                                           FontSize="13"
                                           Foreground="{DynamicResource TextPrimaryBrush}"
                                           Margin="0,0,0,12"/>

                                <!-- Color -->
                                <TextBlock Text="Color"
                                           FontSize="11"
                                           Foreground="{DynamicResource TextSecondaryBrush}"
                                           Margin="0,0,0,4"/>
                                <Border x:Name="PreviewColor"
                                        Height="32"
                                        Background="#B56576"
                                        CornerRadius="6"
                                        Margin="0,0,0,12"/>

                                <!-- Use Count -->
                                <TextBlock Text="Times Used"
                                           FontSize="11"
                                           Foreground="{DynamicResource TextSecondaryBrush}"
                                           Margin="0,0,0,4"/>
                                <TextBlock x:Name="PreviewUseCount"
                                           FontSize="13"
                                           FontWeight="SemiBold"
                                           Foreground="{DynamicResource TextPrimaryBrush}"
                                           Margin="0,0,0,12"/>

                                <!-- Created Date -->
                                <TextBlock Text="Created"
                                           FontSize="11"
                                           Foreground="{DynamicResource TextSecondaryBrush}"
                                           Margin="0,0,0,4"/>
                                <TextBlock x:Name="PreviewCreatedAt"
                                           FontSize="13"
                                           Foreground="{DynamicResource TextPrimaryBrush}"/>
                            </StackPanel>
                        </StackPanel>
                    </ScrollViewer>
                </Border>
            </Grid>
        </Grid>
    </Border>

    <Window.Resources>
        <!-- Null to Boolean Converter (for enabling/disabling buttons based on selection) -->
        <BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter"/>
        <local:NullToBooleanConverter x:Key="NullToBooleanConverter"/>
    </Window.Resources>
</Window>
