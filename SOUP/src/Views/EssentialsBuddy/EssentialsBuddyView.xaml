<UserControl x:Class="SOUP.Views.EssentialsBuddy.EssentialsBuddyView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:vm="clr-namespace:SOUP.ViewModels"
             mc:Ignorable="d"
             d:DesignHeight="800" d:DesignWidth="1200"
             d:DataContext="{d:DesignInstance Type=vm:EssentialsBuddyViewModel}"
             Focusable="True">

    <!-- Keyboard Shortcuts -->
    <UserControl.InputBindings>
        <KeyBinding Key="I" Modifiers="Ctrl" Command="{Binding ImportCommand}"/>
        <KeyBinding Key="E" Modifiers="Ctrl" Command="{Binding ExportCommand}"/>
        <KeyBinding Key="F" Modifiers="Ctrl" Command="{Binding FocusSearchCommand}"/>
        <KeyBinding Key="R" Modifiers="Ctrl" Command="{Binding RefreshCommand}"/>
    </UserControl.InputBindings>

    <UserControl.Resources>
        <!-- Emerald green accent for EssentialsBuddy -->
        <Color x:Key="EssentialsAccentColor">#10b981</Color>
        <Color x:Key="EssentialsAccentLightColor">#34d399</Color>
        <SolidColorBrush x:Key="EssentialsAccentBrush" Color="{StaticResource EssentialsAccentColor}"/>
        <SolidColorBrush x:Key="EssentialsAccentLightBrush" Color="{StaticResource EssentialsAccentLightColor}"/>

        <!-- Smooth Animations -->
        <Storyboard x:Key="DataGridFadeIn">
            <DoubleAnimation Storyboard.TargetProperty="Opacity" From="0" To="1" Duration="0:0:0.4">
                <DoubleAnimation.EasingFunction>
                    <CubicEase EasingMode="EaseOut"/>
                </DoubleAnimation.EasingFunction>
            </DoubleAnimation>
            <ThicknessAnimation Storyboard.TargetProperty="Margin" From="0,10,0,0" To="0,0,0,0" Duration="0:0:0.4">
                <ThicknessAnimation.EasingFunction>
                    <CubicEase EasingMode="EaseOut"/>
                </ThicknessAnimation.EasingFunction>
            </ThicknessAnimation>
        </Storyboard>

        <Storyboard x:Key="SidebarSlideIn">
            <ThicknessAnimation Storyboard.TargetProperty="Margin" From="-220,0,0,0" To="0,0,0,0" Duration="0:0:0.35">
                <ThicknessAnimation.EasingFunction>
                    <CubicEase EasingMode="EaseOut"/>
                </ThicknessAnimation.EasingFunction>
            </ThicknessAnimation>
            <DoubleAnimation Storyboard.TargetProperty="Opacity" From="0" To="1" Duration="0:0:0.35"/>
        </Storyboard>

        <!-- Stock level colors now come from theme (DynamicResource) -->
        
        <!-- Sidebar Navigation Style -->
        <Style x:Key="SidebarNavItem" TargetType="RadioButton">
            <Setter Property="Foreground" Value="{DynamicResource TextSecondaryBrush}"/>
            <Setter Property="FontSize" Value="13"/>
            <Setter Property="FontWeight" Value="Medium"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Padding" Value="16,12"/>
            <Setter Property="Margin" Value="8,2"/>
            <Setter Property="FocusVisualStyle" Value="{x:Null}"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="RadioButton">
                        <Border x:Name="Bg" Background="Transparent" CornerRadius="10"
                                Padding="{TemplateBinding Padding}">
                            <ContentPresenter VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="Bg" Property="Background" Value="{DynamicResource SurfaceHoverBrush}"/>
                            </Trigger>
                            <Trigger Property="IsChecked" Value="True">
                                <Setter TargetName="Bg" Property="Background" Value="{DynamicResource SidebarActiveBrush}"/>
                                <Setter Property="Foreground" Value="{StaticResource EssentialsAccentLightBrush}"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
        
        <!-- Sidebar Action Button Style (for non-toggle actions) -->
        <Style x:Key="SidebarActionItem" TargetType="Button">
            <Setter Property="Foreground" Value="{DynamicResource TextSecondaryBrush}"/>
            <Setter Property="FontSize" Value="13"/>
            <Setter Property="FontWeight" Value="Medium"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Padding" Value="16,12"/>
            <Setter Property="Margin" Value="8,2"/>
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="HorizontalContentAlignment" Value="Left"/>
            <Setter Property="FocusVisualStyle" Value="{x:Null}"/>
            <Setter Property="Focusable" Value="False"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border x:Name="Bg" Background="Transparent" CornerRadius="10"
                                Padding="{TemplateBinding Padding}">
                            <ContentPresenter VerticalAlignment="Center" HorizontalAlignment="Left"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="Bg" Property="Background" Value="{DynamicResource SurfaceHoverBrush}"/>
                            </Trigger>
                            <Trigger Property="IsPressed" Value="True">
                                <Setter TargetName="Bg" Property="Background" Value="{DynamicResource SidebarActiveBrush}"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- CollectionViewSource for grouping items by status -->
        <CollectionViewSource x:Key="GroupedItems" Source="{Binding FilteredItems}">
            <CollectionViewSource.GroupDescriptions>
                <PropertyGroupDescription PropertyName="Status"/>
            </CollectionViewSource.GroupDescriptions>
        </CollectionViewSource>
    </UserControl.Resources>
    
    <UserControl.Triggers>
        <EventTrigger RoutedEvent="Loaded">
            <BeginStoryboard Storyboard="{StaticResource FadeInStoryboard}"/>
        </EventTrigger>
    </UserControl.Triggers>

    <Grid Background="{DynamicResource BackgroundBrush}">
        <!-- Full Screen Welcome Screen (shown when no data) -->
        <Grid Visibility="{Binding HasNoData, Converter={StaticResource BooleanToVisibilityConverter}}"
              Background="{DynamicResource WelcomeScreenGradientBrush}">

            <ScrollViewer VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Disabled">
                <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center"
                            MaxWidth="680" Margin="32" MinHeight="400">
                    <!-- Icon with pulsing animation -->
                    <Border Width="120" Height="120" CornerRadius="32"
                            HorizontalAlignment="Center" Margin="0,0,0,32">
                        <Border.Background>
                            <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                                <GradientStop Color="#10b981" Offset="0"/>
                                <GradientStop Color="#34d399" Offset="1"/>
                            </LinearGradientBrush>
                        </Border.Background>
                        <Border.Effect>
                            <DropShadowEffect BlurRadius="50" ShadowDepth="0" Opacity="0.6" Color="#10b981"/>
                        </Border.Effect>
                        <TextBlock Text="ðŸ“‹" FontSize="56" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                    </Border>

                    <!-- Title -->
                    <TextBlock Text="Essentials Buddy" FontSize="42" FontWeight="Bold"
                               Foreground="{DynamicResource SplashTitleBrush}" HorizontalAlignment="Center" Margin="0,0,0,12"
                               TextWrapping="Wrap" TextAlignment="Center">
                        <TextBlock.Effect>
                            <DropShadowEffect BlurRadius="20" ShadowDepth="0" Opacity="0.3"/>
                        </TextBlock.Effect>
                    </TextBlock>

                    <!-- Subtitle -->
                    <TextBlock Text="Intelligent inventory tracking for essential items" FontSize="17"
                               Foreground="{DynamicResource TextSecondaryBrush}" HorizontalAlignment="Center" Margin="0,0,0,40"
                               TextWrapping="Wrap" TextAlignment="Center" FontWeight="Medium"/>

                    <!-- Import Buttons Group -->
                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Center" Margin="0,0,0,40">
                        <Button Command="{Binding ImportFromExcelCommand}"
                                HorizontalAlignment="Center" Cursor="Hand" Margin="0,0,12,0">
                            <Button.Style>
                                <Style TargetType="Button">
                                    <Setter Property="Foreground" Value="White"/>
                                    <Setter Property="Padding" Value="36,16"/>
                                    <Setter Property="FontSize" Value="16"/>
                                    <Setter Property="FontWeight" Value="SemiBold"/>
                                    <Setter Property="BorderThickness" Value="0"/>
                                    <Setter Property="Template">
                                        <Setter.Value>
                                            <ControlTemplate TargetType="Button">
                                                <Border x:Name="Bg" CornerRadius="14" Padding="{TemplateBinding Padding}">
                                                    <Border.Background>
                                                        <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                                                            <GradientStop Color="#10b981" Offset="0"/>
                                                            <GradientStop Color="#34d399" Offset="1"/>
                                                        </LinearGradientBrush>
                                                    </Border.Background>
                                                    <Border.Effect>
                                                        <DropShadowEffect BlurRadius="24" ShadowDepth="0" Opacity="0.4" Color="#10b981"/>
                                                    </Border.Effect>
                                                    <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                                </Border>
                                                <ControlTemplate.Triggers>
                                                    <Trigger Property="IsMouseOver" Value="True">
                                                        <Setter TargetName="Bg" Property="Background">
                                                            <Setter.Value>
                                                                <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                                                                    <GradientStop Color="#34d399" Offset="0"/>
                                                                    <GradientStop Color="#6ee7b7" Offset="1"/>
                                                                </LinearGradientBrush>
                                                            </Setter.Value>
                                                        </Setter>
                                                    </Trigger>
                                                </ControlTemplate.Triggers>
                                            </ControlTemplate>
                                        </Setter.Value>
                                    </Setter>
                                </Style>
                            </Button.Style>
                            <StackPanel Orientation="Horizontal">
                                <TextBlock Text="ðŸ“Š" FontSize="20" Margin="0,0,12,0" VerticalAlignment="Center"/>
                                <TextBlock Text="Import Excel" VerticalAlignment="Center"/>
                            </StackPanel>
                        </Button>

                        <Button Command="{Binding ImportFromCsvCommand}"
                                HorizontalAlignment="Center" Cursor="Hand">
                            <Button.Style>
                                <Style TargetType="Button">
                                    <Setter Property="Foreground" Value="{StaticResource EssentialsAccentBrush}"/>
                                    <Setter Property="Background" Value="Transparent"/>
                                    <Setter Property="Padding" Value="32,16"/>
                                    <Setter Property="FontSize" Value="16"/>
                                    <Setter Property="FontWeight" Value="SemiBold"/>
                                    <Setter Property="BorderBrush" Value="{StaticResource EssentialsAccentBrush}"/>
                                    <Setter Property="BorderThickness" Value="2"/>
                                    <Setter Property="Template">
                                        <Setter.Value>
                                            <ControlTemplate TargetType="Button">
                                                <Border x:Name="Bg" CornerRadius="14" Padding="{TemplateBinding Padding}"
                                                        Background="{TemplateBinding Background}"
                                                        BorderBrush="{TemplateBinding BorderBrush}"
                                                        BorderThickness="{TemplateBinding BorderThickness}">
                                                    <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                                </Border>
                                                <ControlTemplate.Triggers>
                                                    <Trigger Property="IsMouseOver" Value="True">
                                                        <Setter TargetName="Bg" Property="Background" Value="{StaticResource EssentialsAccentBrush}"/>
                                                        <Setter Property="Foreground" Value="White"/>
                                                    </Trigger>
                                                </ControlTemplate.Triggers>
                                            </ControlTemplate>
                                        </Setter.Value>
                                    </Setter>
                                </Style>
                            </Button.Style>
                            <StackPanel Orientation="Horizontal">
                                <TextBlock Text="ðŸ“„" FontSize="20" Margin="0,0,12,0" VerticalAlignment="Center"/>
                                <TextBlock Text="Import CSV" VerticalAlignment="Center"/>
                            </StackPanel>
                        </Button>
                    </StackPanel>

                    <!-- Features Cards -->
                    <Grid MaxWidth="650" HorizontalAlignment="Center" Margin="0,0,0,32">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>

                        <Border Grid.Column="0" Background="{DynamicResource SurfaceBrush}" CornerRadius="12" Padding="20,16" Margin="4">
                            <Border.Effect>
                                <DropShadowEffect BlurRadius="10" ShadowDepth="0" Opacity="0.1" Color="Black"/>
                            </Border.Effect>
                            <StackPanel HorizontalAlignment="Center">
                                <TextBlock Text="â­" FontSize="32" HorizontalAlignment="Center" Margin="0,0,0,8"/>
                                <TextBlock Text="Essential" Foreground="{DynamicResource TextPrimaryBrush}" FontWeight="SemiBold" FontSize="14" HorizontalAlignment="Center" Margin="0,0,0,4"/>
                                <TextBlock Text="Tracking" Foreground="{DynamicResource TextSecondaryBrush}" FontSize="12" HorizontalAlignment="Center"/>
                            </StackPanel>
                        </Border>

                        <Border Grid.Column="1" Background="{DynamicResource SurfaceBrush}" CornerRadius="12" Padding="20,16" Margin="4">
                            <Border.Effect>
                                <DropShadowEffect BlurRadius="10" ShadowDepth="0" Opacity="0.1" Color="Black"/>
                            </Border.Effect>
                            <StackPanel HorizontalAlignment="Center">
                                <TextBlock Text="ðŸŽ¨" FontSize="32" HorizontalAlignment="Center" Margin="0,0,0,8"/>
                                <TextBlock Text="Color-Coded" Foreground="{DynamicResource TextPrimaryBrush}" FontWeight="SemiBold" FontSize="14" HorizontalAlignment="Center" Margin="0,0,0,4"/>
                                <TextBlock Text="Status" Foreground="{DynamicResource TextSecondaryBrush}" FontSize="12" HorizontalAlignment="Center"/>
                            </StackPanel>
                        </Border>

                        <Border Grid.Column="2" Background="{DynamicResource SurfaceBrush}" CornerRadius="12" Padding="20,16" Margin="4">
                            <Border.Effect>
                                <DropShadowEffect BlurRadius="10" ShadowDepth="0" Opacity="0.1" Color="Black"/>
                            </Border.Effect>
                            <StackPanel HorizontalAlignment="Center">
                                <TextBlock Text="âš ï¸" FontSize="32" HorizontalAlignment="Center" Margin="0,0,0,8"/>
                                <TextBlock Text="Misplaced" Foreground="{DynamicResource TextPrimaryBrush}" FontWeight="SemiBold" FontSize="14" HorizontalAlignment="Center" Margin="0,0,0,4"/>
                                <TextBlock Text="Alerts" Foreground="{DynamicResource TextSecondaryBrush}" FontSize="12" HorizontalAlignment="Center"/>
                            </StackPanel>
                        </Border>
                    </Grid>

                    <!-- Info -->
                    <Border Background="{DynamicResource SurfaceHoverBrush}" CornerRadius="10" Padding="20,14" MaxWidth="550" HorizontalAlignment="Center">
                        <StackPanel>
                            <TextBlock TextWrapping="Wrap" TextAlignment="Center" FontSize="13" Foreground="{DynamicResource TextSecondaryBrush}">
                                <Run Text="ðŸ“" FontSize="14"/>
                                <Run Text="Filters 9-90* bin items automatically"/>
                            </TextBlock>
                            <TextBlock TextWrapping="Wrap" TextAlignment="Center" FontSize="13" Foreground="{DynamicResource TextSecondaryBrush}" Margin="0,6,0,0">
                                <Run Text="âœ¨" FontSize="14"/>
                                <Run Text="All 208 essential items included from dictionary"/>
                            </TextBlock>
                        </StackPanel>
                    </Border>
                </StackPanel>
            </ScrollViewer>
        </Grid>

        <!-- Main Content with Sidebar (shown when has data) -->
        <Grid Visibility="{Binding HasData, Converter={StaticResource BooleanToVisibilityConverter}}">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="220"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>
            <Grid.Triggers>
                <EventTrigger RoutedEvent="Loaded">
                    <BeginStoryboard Storyboard="{StaticResource FadeInStoryboard}"/>
                </EventTrigger>
            </Grid.Triggers>

            <!-- Left Sidebar -->
            <Border Grid.Column="0" Background="{DynamicResource SurfaceBrush}" BorderBrush="{DynamicResource BorderBrush}" BorderThickness="0,0,1,0">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>

                    <!-- Header -->
                    <StackPanel Grid.Row="0" Margin="16,24,16,20">
                        <StackPanel Orientation="Horizontal" Margin="0,0,0,4">
                            <Border Width="40" Height="40" CornerRadius="12" Margin="0,0,12,0">
                                <Border.Background>
                                    <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                                        <GradientStop Color="#10b981" Offset="0"/>
                                        <GradientStop Color="#34d399" Offset="1"/>
                                    </LinearGradientBrush>
                                </Border.Background>
                                <Border.Effect>
                                    <DropShadowEffect BlurRadius="8" ShadowDepth="0" Opacity="0.3" Color="#10b981"/>
                                </Border.Effect>
                                <TextBlock Text="ðŸ“‹" FontSize="20" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                            </Border>
                            <StackPanel VerticalAlignment="Center">
                                <TextBlock Text="Essentials" FontSize="17" FontWeight="Bold" Foreground="{DynamicResource TextPrimaryBrush}"/>
                                <TextBlock Text="Buddy" FontSize="13" Foreground="{DynamicResource TextTertiaryBrush}" FontWeight="Medium"/>
                            </StackPanel>
                        </StackPanel>
                    </StackPanel>

                    <!-- Stats Summary -->
                    <Border Grid.Row="1" Background="{DynamicResource BackgroundBrush}" CornerRadius="14" Margin="12,0,12,16" Padding="20,16">
                        <Border.Effect>
                            <DropShadowEffect BlurRadius="8" ShadowDepth="0" Opacity="0.05" Color="Black"/>
                        </Border.Effect>
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>

                            <!-- Total Items -->
                            <StackPanel Grid.Column="0" Grid.Row="0" Margin="0,0,12,20">
                                <TextBlock Text="{Binding FilteredItems.Count}" FontSize="28" FontWeight="Bold" Foreground="{StaticResource EssentialsAccentBrush}"/>
                                <TextBlock Text="TOTAL ITEMS" FontSize="10" Foreground="{DynamicResource TextTertiaryBrush}" Margin="0,4,0,0"/>
                            </StackPanel>

                            <!-- Essential Items -->
                            <StackPanel Grid.Column="1" Grid.Row="0" Margin="12,0,0,20">
                                <TextBlock Text="{Binding EssentialItemsCount, FallbackValue=0}" FontSize="28" FontWeight="Bold" Foreground="{DynamicResource WarningBrush}"/>
                                <TextBlock Text="ESSENTIAL" FontSize="10" Foreground="{DynamicResource TextTertiaryBrush}" Margin="0,4,0,0"/>
                            </StackPanel>

                            <!-- Out of Stock -->
                            <StackPanel Grid.Column="0" Grid.Row="1" Margin="0,0,12,0">
                                <TextBlock Text="{Binding OutOfStockCount, FallbackValue=0}" FontSize="28" FontWeight="Bold" Foreground="{DynamicResource DangerBrush}"/>
                                <TextBlock Text="OUT STOCK" FontSize="10" Foreground="{DynamicResource TextTertiaryBrush}" Margin="0,4,0,0"/>
                            </StackPanel>

                            <!-- Low Stock -->
                            <StackPanel Grid.Column="1" Grid.Row="1" Margin="12,0,0,0">
                                <TextBlock Text="{Binding LowStockCount, FallbackValue=0}" FontSize="28" FontWeight="Bold" Foreground="{DynamicResource WarningBrush}"/>
                                <TextBlock Text="LOW STOCK" FontSize="10" Foreground="{DynamicResource TextTertiaryBrush}" Margin="0,4,0,0"/>
                            </StackPanel>
                        </Grid>
                    </Border>

                    <!-- Navigation -->
                    <StackPanel Grid.Row="2" Margin="0,8,0,0">
                        <TextBlock Text="NAVIGATION" FontSize="10" FontWeight="SemiBold" 
                                   Foreground="{DynamicResource TextDisabledBrush}" Margin="20,0,0,8"/>
                        
                        <RadioButton x:Name="NavData" Style="{StaticResource SidebarNavItem}" 
                                     IsChecked="True" GroupName="EssentialsNav">
                            <StackPanel Orientation="Horizontal">
                                <TextBlock Text="ðŸ“Š" FontSize="16" Margin="0,0,12,0"/>
                                <TextBlock Text="Data View" VerticalAlignment="Center"/>
                            </StackPanel>
                        </RadioButton>
                        
                        <Separator Background="{DynamicResource SurfaceHoverBrush}" Margin="16,12"/>
                        
                        <TextBlock Text="ACTIONS" FontSize="10" FontWeight="SemiBold" 
                                   Foreground="{DynamicResource TextDisabledBrush}" Margin="20,0,0,8"/>
                        
                        <Button Style="{StaticResource SidebarActionItem}"
                                Command="{Binding ImportFromExcelCommand}">
                            <StackPanel Orientation="Horizontal">
                                <TextBlock Text="ðŸ“¥" FontSize="16" Margin="0,0,12,0"/>
                                <TextBlock Text="Import Data" VerticalAlignment="Center"/>
                            </StackPanel>
                        </Button>
                        
                        <Button Style="{StaticResource SidebarActionItem}"
                                Command="{Binding ExportToExcelCommand}">
                            <StackPanel Orientation="Horizontal">
                                <TextBlock Text="ðŸ“¤" FontSize="16" Margin="0,0,12,0"/>
                                <TextBlock Text="Export Excel" VerticalAlignment="Center"/>
                            </StackPanel>
                        </Button>
                        
                        <Button Style="{StaticResource SidebarActionItem}"
                                Command="{Binding ExportToCsvCommand}">
                            <StackPanel Orientation="Horizontal">
                                <TextBlock Text="ðŸ“„" FontSize="16" Margin="0,0,12,0"/>
                                <TextBlock Text="Export CSV" VerticalAlignment="Center"/>
                            </StackPanel>
                        </Button>
                        
                        <Button Style="{StaticResource SidebarActionItem}"
                                Command="{Binding LoadItemsCommand}">
                            <StackPanel Orientation="Horizontal">
                                <TextBlock Text="ðŸ”„" FontSize="16" Margin="0,0,12,0"/>
                                <TextBlock Text="Refresh Data" VerticalAlignment="Center"/>
                            </StackPanel>
                        </Button>
                    </StackPanel>

                    <!-- Bottom Actions -->
                    <StackPanel Grid.Row="3" Margin="8,0,8,12">
                        <Separator Background="{DynamicResource SurfaceHoverBrush}" Margin="8,0,8,12"/>
                        
                        <Button Style="{StaticResource SidebarActionItem}"
                                Command="{Binding OpenSettingsCommand}">
                            <StackPanel Orientation="Horizontal">
                                <TextBlock Text="âš™ï¸" FontSize="16" Margin="0,0,12,0"/>
                                <TextBlock Text="Settings" VerticalAlignment="Center"/>
                            </StackPanel>
                        </Button>
                        
                        <Button Style="{StaticResource SidebarActionItem}"
                                Command="{Binding ClearDataCommand}">
                            <StackPanel Orientation="Horizontal">
                                <TextBlock Text="ðŸ—‘ï¸" FontSize="16" Margin="0,0,12,0"/>
                                <TextBlock Text="Clear Data" VerticalAlignment="Center" Foreground="{DynamicResource DangerBrush}"/>
                            </StackPanel>
                        </Button>
                    </StackPanel>
                </Grid>
            </Border>

            <!-- Main Content Area -->
            <Grid Grid.Column="1" Background="{DynamicResource BackgroundBrush}">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <!-- Header with Search -->
                <Border Grid.Row="0" Background="{DynamicResource SurfaceBrush}" Padding="24,20" BorderBrush="{DynamicResource BorderBrush}" BorderThickness="0,0,0,1">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>

                        <!-- Search Box -->
                        <Border Grid.Column="0" Background="{DynamicResource BackgroundBrush}" CornerRadius="12" Padding="14,0" MaxWidth="540" HorizontalAlignment="Left"
                                BorderBrush="{DynamicResource BorderBrush}" BorderThickness="1">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>
                                <TextBlock Grid.Column="0" Text="ðŸ”" FontSize="16" VerticalAlignment="Center" Margin="0,0,10,0" Opacity="0.6"/>
                                <TextBox x:Name="SearchBox" Grid.Column="1" Text="{Binding SearchText, UpdateSourceTrigger=PropertyChanged}"
                                         Background="Transparent" BorderThickness="0" Foreground="{DynamicResource TextPrimaryBrush}"
                                         VerticalAlignment="Center" Padding="0,10" FontSize="14"
                                         CaretBrush="{DynamicResource TextPrimaryBrush}">
                                    <TextBox.Style>
                                        <Style TargetType="TextBox">
                                            <Style.Triggers>
                                                <Trigger Property="Text" Value="">
                                                    <Setter Property="Background">
                                                        <Setter.Value>
                                                            <VisualBrush Stretch="None" AlignmentX="Left">
                                                                <VisualBrush.Visual>
                                                                    <TextBlock Text="Search items, descriptions, bins..." Foreground="{DynamicResource TextTertiaryBrush}" FontSize="14"/>
                                                                </VisualBrush.Visual>
                                                            </VisualBrush>
                                                        </Setter.Value>
                                                    </Setter>
                                                </Trigger>
                                            </Style.Triggers>
                                        </Style>
                                    </TextBox.Style>
                                </TextBox>
                                <TextBlock Grid.Column="2" Text="Ctrl+F" FontSize="11" Foreground="{DynamicResource TextDisabledBrush}"
                                           VerticalAlignment="Center" Margin="10,0,0,0" Opacity="0.5"/>
                            </Grid>
                        </Border>

                        <!-- Status Filter -->
                        <StackPanel Grid.Column="1" Orientation="Horizontal" Margin="20,0">
                            <TextBlock Text="Status:" Foreground="{DynamicResource TextSecondaryBrush}" VerticalAlignment="Center" Margin="0,0,10,0" FontWeight="Medium"/>
                            <ComboBox SelectedValuePath="Content" SelectedValue="{Binding StatusFilter}"
                                      Style="{StaticResource ModernComboBox}" Width="150" Height="40">
                                <ComboBoxItem>All</ComboBoxItem>
                                <ComboBoxItem>No Stock</ComboBoxItem>
                                <ComboBoxItem>Low Stock</ComboBoxItem>
                                <ComboBoxItem>Sufficient</ComboBoxItem>
                            </ComboBox>
                        </StackPanel>

                        <!-- Essentials Toggle -->
                        <StackPanel Grid.Column="2" Orientation="Horizontal">
                            <CheckBox Content="Essentials Only"
                                      IsChecked="{Binding EssentialsOnly}"
                                      Foreground="{DynamicResource TextPrimaryBrush}" FontWeight="SemiBold"
                                      VerticalAlignment="Center" Margin="0,0,16,0"/>

                            <Border CornerRadius="12" Padding="14,8" Margin="0">
                                <Border.Background>
                                    <LinearGradientBrush StartPoint="0,0" EndPoint="1,0">
                                        <GradientStop Color="#10b981" Offset="0"/>
                                        <GradientStop Color="#34d399" Offset="1"/>
                                    </LinearGradientBrush>
                                </Border.Background>
                                <TextBlock Text="{Binding FilteredItems.Count, StringFormat='{}{0} items'}"
                                           Foreground="White" FontWeight="Bold" FontSize="13"/>
                            </Border>
                        </StackPanel>
                    </Grid>
                </Border>

                <!-- Quick Actions Bar -->
                <Border Grid.Row="1" Background="{DynamicResource BackgroundBrush}" Padding="20,12" BorderBrush="{DynamicResource BorderBrush}" BorderThickness="0,0,0,1">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>

                        <!-- Action Buttons -->
                        <StackPanel Grid.Column="0" Orientation="Horizontal">
                            <Button Command="{Binding EditItemCommand}" Style="{StaticResource SecondaryButton}" Margin="0,0,10,0" Padding="14,8" Height="36">
                                <StackPanel Orientation="Horizontal">
                                    <TextBlock Text="âœï¸" FontSize="14" Margin="0,0,8,0" VerticalAlignment="Center"/>
                                    <TextBlock Text="Edit" FontSize="13" FontWeight="Medium" VerticalAlignment="Center"/>
                                </StackPanel>
                            </Button>

                            <Button Command="{Binding DeleteItemCommand}" Style="{StaticResource DangerButton}" Margin="0,0,10,0" Padding="14,8" Height="36">
                                <StackPanel Orientation="Horizontal">
                                    <TextBlock Text="ðŸ—‘ï¸" FontSize="14" Margin="0,0,8,0" VerticalAlignment="Center"/>
                                    <TextBlock Text="Delete" FontSize="13" FontWeight="Medium" VerticalAlignment="Center"/>
                                </StackPanel>
                            </Button>

                            <Separator Width="1" Height="24" Background="{DynamicResource BorderBrush}" Margin="8,0"/>

                            <Button Command="{Binding SaveSnapshotCommand}" Style="{StaticResource SecondaryButton}" Margin="8,0,10,0" Padding="14,8" Height="36">
                                <StackPanel Orientation="Horizontal">
                                    <TextBlock Text="ðŸ’¾" FontSize="14" Margin="0,0,8,0" VerticalAlignment="Center"/>
                                    <TextBlock Text="Save Snapshot" FontSize="13" FontWeight="Medium" VerticalAlignment="Center"/>
                                </StackPanel>
                            </Button>

                            <Button Command="{Binding CompareWithPreviousRunCommand}" Style="{StaticResource SecondaryButton}" Padding="14,8" Height="36">
                                <StackPanel Orientation="Horizontal">
                                    <TextBlock Text="ðŸ”" FontSize="14" Margin="0,0,8,0" VerticalAlignment="Center"/>
                                    <TextBlock Text="Compare Last Run" FontSize="13" FontWeight="Medium" VerticalAlignment="Center"/>
                                </StackPanel>
                            </Button>
                        </StackPanel>

                        <!-- Legend -->
                        <StackPanel Grid.Column="1" Orientation="Horizontal" HorizontalAlignment="Right" VerticalAlignment="Center">
                            <TextBlock Text="Legend" Foreground="{DynamicResource TextSecondaryBrush}" FontSize="12" FontWeight="SemiBold"
                                       VerticalAlignment="Center" Margin="0,0,16,0"/>

                            <Border Background="{DynamicResource OutOfStockBrush}" CornerRadius="6" Padding="10,5" Margin="0,0,8,0">
                                <TextBlock Text="No Stock" Foreground="{DynamicResource OutOfStockTextBrush}" FontSize="11" FontWeight="Medium"/>
                            </Border>

                            <Border Background="{DynamicResource LowStockBrush}" CornerRadius="6" Padding="10,5" Margin="0,0,8,0">
                                <TextBlock Text="Low Stock" Foreground="{DynamicResource LowStockTextBrush}" FontSize="11" FontWeight="Medium"/>
                            </Border>

                            <Border Background="{DynamicResource SufficientBrush}" CornerRadius="6" Padding="10,5" Margin="0,0,8,0">
                                <TextBlock Text="Sufficient" Foreground="{DynamicResource SufficientTextBrush}" FontSize="11" FontWeight="Medium"/>
                            </Border>

                            <Border Background="{DynamicResource DangerBrush}" CornerRadius="6" Padding="10,5">
                                <StackPanel Orientation="Horizontal">
                                    <TextBlock Text="âš " FontSize="14" Foreground="White" Margin="0,0,6,0" VerticalAlignment="Center"/>
                                    <TextBlock Text="Misplaced" Foreground="White" FontSize="11" FontWeight="Medium" VerticalAlignment="Center"/>
                                </StackPanel>
                            </Border>
                        </StackPanel>
                    </Grid>
                </Border>

                <!-- Data Grid -->
                <Border Grid.Row="2" Background="{DynamicResource SurfaceBrush}" CornerRadius="12" Margin="16" Padding="0"
                        BorderBrush="{DynamicResource BorderBrush}" BorderThickness="1">
                    <Border.Effect>
                        <DropShadowEffect BlurRadius="12" ShadowDepth="0" Opacity="0.08" Color="Black"/>
                    </Border.Effect>

                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                        </Grid.RowDefinitions>

                        <!-- Column Headers -->
                        <Border Grid.Row="0"
                                Background="{DynamicResource SurfaceHoverBrush}"
                                Padding="16,10"
                                CornerRadius="8,8,0,0"
                                BorderBrush="{DynamicResource BorderBrush}"
                                BorderThickness="0,0,0,1">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="120"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="100"/>
                                    <ColumnDefinition Width="70"/>
                                    <ColumnDefinition Width="90"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>

                                <TextBlock Grid.Column="0" Width="32"/>
                                <TextBlock Grid.Column="1" Text="ITEM NUMBER" FontSize="11" FontWeight="SemiBold" Foreground="{DynamicResource TextSecondaryBrush}" Margin="0,0,12,0"/>
                                <TextBlock Grid.Column="2" Text="DESCRIPTION" FontSize="11" FontWeight="SemiBold" Foreground="{DynamicResource TextSecondaryBrush}" Margin="0,0,12,0"/>
                                <TextBlock Grid.Column="3" Text="BIN CODE" FontSize="11" FontWeight="SemiBold" Foreground="{DynamicResource TextSecondaryBrush}" Margin="0,0,12,0"/>
                                <TextBlock Grid.Column="4" Text="QTY" FontSize="11" FontWeight="SemiBold" Foreground="{DynamicResource TextSecondaryBrush}" HorizontalAlignment="Center" Margin="0,0,12,0"/>
                                <TextBlock Grid.Column="5" Text="STATUS" FontSize="11" FontWeight="SemiBold" Foreground="{DynamicResource TextSecondaryBrush}" HorizontalAlignment="Center" Margin="0,0,12,0"/>
                                <TextBlock Grid.Column="6" Text="" FontSize="11"/>
                            </Grid>
                        </Border>

                        <!-- Items List -->
                        <ListView Grid.Row="1"
                                  x:Name="ItemsGrid"
                              ItemsSource="{Binding FilteredItems}"
                              SelectedItem="{Binding SelectedItem}"
                              Background="Transparent"
                              BorderThickness="0"
                              ScrollViewer.HorizontalScrollBarVisibility="Disabled">

                        <ListView.InputBindings>
                            <MouseBinding MouseAction="LeftDoubleClick" Command="{Binding EditItemCommand}"/>
                        </ListView.InputBindings>

                        <ListView.ItemContainerStyle>
                            <Style TargetType="ListViewItem">
                                <Setter Property="HorizontalContentAlignment" Value="Stretch"/>
                                <Setter Property="Template">
                                    <Setter.Value>
                                        <ControlTemplate TargetType="ListViewItem">
                                            <Border Background="{DynamicResource SurfaceBrush}"
                                                    Margin="0,0,0,20"
                                                    Padding="16,12"
                                                    CornerRadius="8"
                                                    BorderThickness="3,0,0,0"
                                                    BorderBrush="Transparent">
                                                <Border.Style>
                                                    <Style TargetType="Border">
                                                        <Style.Triggers>
                                                            <Trigger Property="IsMouseOver" Value="True">
                                                                <Setter Property="Background" Value="{DynamicResource SurfaceHoverBrush}"/>
                                                            </Trigger>
                                                            <DataTrigger Binding="{Binding Status}" Value="OutOfStock">
                                                                <Setter Property="BorderBrush" Value="#DC2626"/>
                                                            </DataTrigger>
                                                            <DataTrigger Binding="{Binding Status}" Value="Low">
                                                                <Setter Property="BorderBrush" Value="#F59E0B"/>
                                                            </DataTrigger>
                                                            <DataTrigger Binding="{Binding Status}" Value="Sufficient">
                                                                <Setter Property="BorderBrush" Value="#10B981"/>
                                                            </DataTrigger>
                                                        </Style.Triggers>
                                                    </Style>
                                                </Border.Style>
                                                <ContentPresenter/>
                                            </Border>
                                        </ControlTemplate>
                                    </Setter.Value>
                                </Setter>
                            </Style>
                        </ListView.ItemContainerStyle>

                        <ListView.ItemTemplate>
                            <DataTemplate>
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto"/>
                                        <ColumnDefinition Width="120"/>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="100"/>
                                        <ColumnDefinition Width="70"/>
                                        <ColumnDefinition Width="90"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>

                                    <!-- Warning Icon -->
                                    <Border Grid.Column="0"
                                            Background="#DC2626"
                                            CornerRadius="4"
                                            Padding="6,4"
                                            Margin="0,0,12,0"
                                            VerticalAlignment="Center"
                                            Visibility="{Binding IsNonEssentialIn990Bin, Converter={StaticResource BooleanToVisibilityConverter}}">
                                        <TextBlock Text="âš " FontSize="14" Foreground="White"/>
                                    </Border>

                                    <!-- Item Number -->
                                    <TextBlock Grid.Column="1"
                                               Text="{Binding ItemNumber}"
                                               FontWeight="SemiBold"
                                               FontFamily="Consolas"
                                               FontSize="13"
                                               Foreground="{DynamicResource TextPrimaryBrush}"
                                               VerticalAlignment="Center"
                                               Margin="0,0,12,0"/>

                                    <!-- Description -->
                                    <TextBlock Grid.Column="2"
                                               Text="{Binding DisplayDescription}"
                                               TextTrimming="CharacterEllipsis"
                                               Foreground="{DynamicResource TextPrimaryBrush}"
                                               VerticalAlignment="Center"
                                               Margin="0,0,12,0"/>

                                    <!-- Bin Code -->
                                    <TextBlock Grid.Column="3"
                                               Text="{Binding BinCode}"
                                               FontFamily="Consolas"
                                               FontSize="12"
                                               Foreground="{DynamicResource TextSecondaryBrush}"
                                               VerticalAlignment="Center"
                                               Margin="0,0,12,0"/>

                                    <!-- Quantity -->
                                    <Border Grid.Column="4"
                                            Background="{DynamicResource BackgroundBrush}"
                                            CornerRadius="6"
                                            Padding="10,5"
                                            VerticalAlignment="Center"
                                            HorizontalAlignment="Center"
                                            Margin="0,0,12,0">
                                        <TextBlock Text="{Binding QuantityOnHand}"
                                                   FontWeight="Bold"
                                                   FontSize="15"
                                                   Foreground="{DynamicResource TextPrimaryBrush}"
                                                   HorizontalAlignment="Center"/>
                                    </Border>

                                    <!-- Status -->
                                    <Border Grid.Column="5"
                                            CornerRadius="6"
                                            Padding="10,5"
                                            VerticalAlignment="Center"
                                            HorizontalAlignment="Center"
                                            Margin="0,0,12,0">
                                        <Border.Style>
                                            <Style TargetType="Border">
                                                <Style.Triggers>
                                                    <DataTrigger Binding="{Binding Status}" Value="OutOfStock">
                                                        <Setter Property="Background" Value="#DC2626"/>
                                                    </DataTrigger>
                                                    <DataTrigger Binding="{Binding Status}" Value="Low">
                                                        <Setter Property="Background" Value="#F59E0B"/>
                                                    </DataTrigger>
                                                    <DataTrigger Binding="{Binding Status}" Value="Sufficient">
                                                        <Setter Property="Background" Value="#10B981"/>
                                                    </DataTrigger>
                                                    <DataTrigger Binding="{Binding Status}" Value="InStock">
                                                        <Setter Property="Background" Value="#3B82F6"/>
                                                    </DataTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </Border.Style>
                                        <TextBlock Text="{Binding Status}"
                                                   Foreground="White"
                                                   FontWeight="SemiBold"
                                                   FontSize="11"/>
                                    </Border>

                                    <!-- Badges -->
                                    <StackPanel Grid.Column="6" Orientation="Horizontal" VerticalAlignment="Center">
                                        <Border CornerRadius="4" Padding="6,4" Margin="0,0,4,0"
                                                Background="#34d399"
                                                Visibility="{Binding IsEssential, Converter={StaticResource BooleanToVisibilityConverter}}">
                                            <TextBlock Text="â­" FontSize="13"/>
                                        </Border>
                                        <Border CornerRadius="4" Padding="6,4"
                                                Background="#10B981"
                                                Visibility="{Binding DictionaryMatched, Converter={StaticResource BooleanToVisibilityConverter}}">
                                            <TextBlock Text="âœ“" FontSize="13" FontWeight="Bold" Foreground="White"/>
                                        </Border>
                                    </StackPanel>
                                </Grid>
                            </DataTemplate>
                        </ListView.ItemTemplate>
                    </ListView>
                    </Grid>
                </Border>

                <!-- Status Bar -->
                <Border Grid.Row="3" Background="{DynamicResource SurfaceBrush}" BorderBrush="{DynamicResource BorderBrush}" BorderThickness="0,1,0,0" Padding="20,12">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>

                        <!-- Status Icon -->
                        <Border Grid.Column="0" Background="{StaticResource EssentialsAccentBrush}" CornerRadius="6" Width="6" Height="6" Margin="0,0,10,0" VerticalAlignment="Center"
                                Visibility="{Binding HasData, Converter={StaticResource BooleanToVisibilityConverter}}"/>

                        <!-- Status Message -->
                        <TextBlock Grid.Column="1" Text="{Binding StatusMessage}"
                                   Foreground="{DynamicResource TextSecondaryBrush}" VerticalAlignment="Center" FontSize="13"/>

                        <!-- Loading Indicator -->
                        <StackPanel Grid.Column="2" Orientation="Horizontal" VerticalAlignment="Center"
                                    Visibility="{Binding IsLoading, Converter={StaticResource BooleanToVisibilityConverter}}">
                            <Border Background="{DynamicResource InfoBrush}" CornerRadius="8" Padding="12,6">
                                <StackPanel Orientation="Horizontal">
                                    <TextBlock Text="â³" FontSize="14" Margin="0,0,8,0" VerticalAlignment="Center"/>
                                    <TextBlock Text="Loading..." Foreground="White" FontWeight="Medium" VerticalAlignment="Center" FontSize="12"/>
                                </StackPanel>
                            </Border>
                        </StackPanel>
                    </Grid>
                </Border>
            </Grid>
        </Grid>
    </Grid>
</UserControl>





