<UserControl x:Class="SOUP.Views.ExpireWise.ExpireWiseView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:vm="clr-namespace:SOUP.ViewModels"
             xmlns:local="clr-namespace:SOUP.Views.ExpireWise"
             mc:Ignorable="d"
             d:DesignHeight="800" d:DesignWidth="1200"
             d:DataContext="{d:DesignInstance Type=vm:ExpireWiseViewModel}"
             Focusable="True">

    <!-- Keyboard Shortcuts -->
    <UserControl.InputBindings>
        <KeyBinding Key="N" Modifiers="Ctrl" Command="{Binding AddItemCommand}"/>
        <KeyBinding Key="I" Modifiers="Ctrl" Command="{Binding ImportFromExcelCommand}"/>
        <KeyBinding Key="E" Modifiers="Ctrl" Command="{Binding ExportToCsvCommand}"/>
        <KeyBinding Key="Delete" Command="{Binding DeleteSelectedCommand}"/>
        <KeyBinding Key="F" Modifiers="Ctrl" Command="{Binding FocusSearchCommand}"/>
    </UserControl.InputBindings>

    <UserControl.Resources>
        <local:StoreDisplayConverter x:Key="StoreDisplayConverter"/>
        <CollectionViewSource x:Key="GroupedItemsView" Source="{Binding FilteredItems}"/>
        
        <!-- ExpireWise Accent Colors (Amber/Orange theme - matches launcher) -->
        <Color x:Key="ExpireWiseAccentColor">#f59e0b</Color>
        <Color x:Key="ExpireWiseAccentLightColor">#fbbf24</Color>
        <Color x:Key="ExpireWiseAccentDarkColor">#d97706</Color>
        <SolidColorBrush x:Key="ExpireWiseAccentBrush" Color="{StaticResource ExpireWiseAccentColor}"/>
        <SolidColorBrush x:Key="ExpireWiseAccentLightBrush" Color="{StaticResource ExpireWiseAccentLightColor}"/>
        <SolidColorBrush x:Key="ExpireWiseAccentDarkBrush" Color="{StaticResource ExpireWiseAccentDarkColor}"/>
        
        <!-- Sidebar Navigation RadioButton Style -->
        <Style x:Key="SidebarNavButton" TargetType="RadioButton">
            <Setter Property="Foreground" Value="{DynamicResource TextSecondaryBrush}"/>
            <Setter Property="FontSize" Value="13"/>
            <Setter Property="FontWeight" Value="Medium"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Padding" Value="16,12"/>
            <Setter Property="Margin" Value="8,2"/>
            <Setter Property="FocusVisualStyle" Value="{x:Null}"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="RadioButton">
                        <Border x:Name="Bg" Background="Transparent" CornerRadius="10"
                                Padding="{TemplateBinding Padding}">
                            <ContentPresenter VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="Bg" Property="Background" Value="{DynamicResource SurfaceHoverBrush}"/>
                            </Trigger>
                            <Trigger Property="IsChecked" Value="True">
                                <Setter TargetName="Bg" Property="Background" Value="{DynamicResource SidebarActiveBrush}"/>
                                <Setter Property="Foreground" Value="{StaticResource ExpireWiseAccentLightBrush}"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
        
        <!-- Sidebar Action Button Style -->
        <Style x:Key="SidebarActionButton" TargetType="Button">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="Foreground" Value="{DynamicResource TextSecondaryBrush}"/>
            <Setter Property="FontSize" Value="13"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Padding" Value="16,12"/>
            <Setter Property="Margin" Value="8,2"/>
            <Setter Property="HorizontalContentAlignment" Value="Left"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="FocusVisualStyle" Value="{x:Null}"/>
            <Setter Property="Focusable" Value="False"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border x:Name="Bg" Background="{TemplateBinding Background}" CornerRadius="10"
                                Padding="{TemplateBinding Padding}">
                            <ContentPresenter VerticalAlignment="Center" HorizontalAlignment="{TemplateBinding HorizontalContentAlignment}"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="Bg" Property="Background" Value="{DynamicResource SurfaceHoverBrush}"/>
                            </Trigger>
                            <Trigger Property="IsPressed" Value="True">
                                <Setter TargetName="Bg" Property="Background" Value="{DynamicResource SidebarActiveBrush}"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
        
        <!-- Modern DataGrid Style -->
        <Style x:Key="ModernDataGrid" TargetType="DataGrid">
            <Setter Property="Background" Value="{DynamicResource SurfaceBrush}"/>
            <Setter Property="Foreground" Value="{DynamicResource TextPrimaryBrush}"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="RowHeaderWidth" Value="0"/>
            <Setter Property="AutoGenerateColumns" Value="False"/>
            <Setter Property="CanUserAddRows" Value="False"/>
            <Setter Property="CanUserDeleteRows" Value="False"/>
            <Setter Property="CanUserResizeRows" Value="False"/>
            <Setter Property="GridLinesVisibility" Value="None"/>
            <Setter Property="HeadersVisibility" Value="Column"/>
            <Setter Property="HorizontalScrollBarVisibility" Value="Auto"/>
            <Setter Property="VerticalScrollBarVisibility" Value="Auto"/>
        </Style>
        
        <!-- Modern DataGrid Column Header Style -->
        <Style x:Key="ModernDataGridColumnHeader" TargetType="DataGridColumnHeader">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="Foreground" Value="{DynamicResource TextSecondaryBrush}"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="FontSize" Value="11"/>
            <Setter Property="Padding" Value="12,16"/>
            <Setter Property="BorderThickness" Value="0,0,0,1"/>
            <Setter Property="BorderBrush" Value="{DynamicResource SurfaceHoverBrush}"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="DataGridColumnHeader">
                        <Border Background="{TemplateBinding Background}" 
                                BorderBrush="{TemplateBinding BorderBrush}"
                                BorderThickness="{TemplateBinding BorderThickness}"
                                Padding="{TemplateBinding Padding}">
                            <ContentPresenter HorizontalAlignment="{TemplateBinding HorizontalContentAlignment}"
                                              VerticalAlignment="Center"/>
                        </Border>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
        
        <!-- Modern DataGrid Cell Style -->
        <Style x:Key="ModernDataGridCell" TargetType="DataGridCell">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="Foreground" Value="{DynamicResource TextPrimaryBrush}"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Padding" Value="12,14"/>
            <Setter Property="FontSize" Value="13"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="DataGridCell">
                        <Border Background="{TemplateBinding Background}" 
                                Padding="{TemplateBinding Padding}">
                            <ContentPresenter VerticalAlignment="Center"/>
                        </Border>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
            <Style.Triggers>
                <Trigger Property="IsSelected" Value="True">
                    <Setter Property="Background" Value="{DynamicResource SidebarActiveBrush}"/>
                    <Setter Property="Foreground" Value="{StaticResource ExpireWiseAccentLightBrush}"/>
                </Trigger>
            </Style.Triggers>
        </Style>
        
        <!-- Modern DataGrid Row Style with animations -->
        <Style x:Key="ModernDataGridRow" TargetType="DataGridRow">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="Margin" Value="0,1"/>
            <Setter Property="RenderTransformOrigin" Value="0,0.5"/>
            <Setter Property="RenderTransform">
                <Setter.Value>
                    <TranslateTransform X="0"/>
                </Setter.Value>
            </Setter>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="DataGridRow">
                        <Border x:Name="RowBorder" 
                                Background="{TemplateBinding Background}" 
                                CornerRadius="8"
                                Margin="4,2">
                            <SelectiveScrollingGrid>
                                <SelectiveScrollingGrid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="*"/>
                                </SelectiveScrollingGrid.ColumnDefinitions>
                                <SelectiveScrollingGrid.RowDefinitions>
                                    <RowDefinition Height="*"/>
                                    <RowDefinition Height="Auto"/>
                                </SelectiveScrollingGrid.RowDefinitions>
                                <DataGridCellsPresenter Grid.Column="1" ItemsPanel="{TemplateBinding ItemsPanel}"
                                                        SnapsToDevicePixels="{TemplateBinding SnapsToDevicePixels}"/>
                                <DataGridDetailsPresenter Grid.Column="1" Grid.Row="1"
                                                          Visibility="{TemplateBinding DetailsVisibility}"
                                                          SelectiveScrollingGrid.SelectiveScrollingOrientation="Both"/>
                            </SelectiveScrollingGrid>
                        </Border>
                        <ControlTemplate.Triggers>
                            <EventTrigger RoutedEvent="MouseEnter">
                                <BeginStoryboard>
                                    <Storyboard>
                                        <DoubleAnimation Storyboard.TargetProperty="RenderTransform.X" To="4" Duration="0:0:0.15">
                                            <DoubleAnimation.EasingFunction><QuadraticEase EasingMode="EaseOut"/></DoubleAnimation.EasingFunction>
                                        </DoubleAnimation>
                                    </Storyboard>
                                </BeginStoryboard>
                            </EventTrigger>
                            <EventTrigger RoutedEvent="MouseLeave">
                                <BeginStoryboard>
                                    <Storyboard>
                                        <DoubleAnimation Storyboard.TargetProperty="RenderTransform.X" To="0" Duration="0:0:0.2">
                                            <DoubleAnimation.EasingFunction><QuadraticEase EasingMode="EaseOut"/></DoubleAnimation.EasingFunction>
                                        </DoubleAnimation>
                                    </Storyboard>
                                </BeginStoryboard>
                            </EventTrigger>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="RowBorder" Property="Background" Value="{DynamicResource SurfaceHoverBrush}"/>
                            </Trigger>
                            <Trigger Property="IsSelected" Value="True">
                                <Setter TargetName="RowBorder" Property="Background" Value="{DynamicResource SidebarActiveBrush}"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
    </UserControl.Resources>

    <UserControl.Triggers>
        <EventTrigger RoutedEvent="Loaded">
            <BeginStoryboard Storyboard="{StaticResource FadeInStoryboard}"/>
        </EventTrigger>
    </UserControl.Triggers>

    <Grid>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="220"/>
            <ColumnDefinition Width="*"/>
        </Grid.ColumnDefinitions>
        
        <!-- Left Sidebar -->
        <Border Grid.Column="0" Background="{DynamicResource SurfaceBrush}" BorderBrush="{DynamicResource SurfaceHoverBrush}" BorderThickness="0,0,1,0">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <!-- Header -->
                <StackPanel Grid.Row="0" Margin="16,20,16,16">
                    <StackPanel Orientation="Horizontal" Margin="0,0,0,4">
                        <Border Width="36" Height="36" CornerRadius="10" Margin="0,0,12,0">
                            <Border.Background>
                                <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                                    <GradientStop Color="{StaticResource ExpireWiseAccentColor}" Offset="0"/>
                                    <GradientStop Color="{StaticResource ExpireWiseAccentLightColor}" Offset="1"/>
                                </LinearGradientBrush>
                            </Border.Background>
                            <TextBlock Text="ðŸ“…" FontSize="18" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                        <StackPanel VerticalAlignment="Center">
                            <TextBlock Text="ExpireWise" FontSize="16" FontWeight="Bold" Foreground="{DynamicResource TextPrimaryBrush}"/>
                            <TextBlock Text="Expiration Tracker" FontSize="11" Foreground="{DynamicResource TextTertiaryBrush}"/>
                        </StackPanel>
                    </StackPanel>
                </StackPanel>

                <!-- Stats Summary -->
                <Border Grid.Row="1" Background="{DynamicResource BackgroundBrush}" CornerRadius="12" Margin="12,0,12,12" Padding="12">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>
                        
                        <StackPanel Grid.Column="0" Grid.Row="0" Margin="0,0,0,8">
                            <TextBlock Text="{Binding TotalItems}" FontSize="20" FontWeight="Bold" Foreground="{StaticResource ExpireWiseAccentLightBrush}"/>
                            <TextBlock Text="Total Items" FontSize="10" Foreground="{DynamicResource TextTertiaryBrush}"/>
                        </StackPanel>
                        
                        <StackPanel Grid.Column="1" Grid.Row="0" Margin="0,0,0,8">
                            <TextBlock Text="{Binding MonthItemCount}" FontSize="20" FontWeight="Bold" Foreground="{DynamicResource WarningLightBrush}"/>
                            <TextBlock Text="This Month" FontSize="10" Foreground="{DynamicResource TextTertiaryBrush}"/>
                        </StackPanel>
                        
                        <StackPanel Grid.Column="0" Grid.Row="1">
                            <TextBlock Text="{Binding CriticalCount}" FontSize="20" FontWeight="Bold" Foreground="{DynamicResource DangerBrush}"/>
                            <TextBlock Text="Critical" FontSize="10" Foreground="{DynamicResource TextTertiaryBrush}"/>
                        </StackPanel>
                        
                        <StackPanel Grid.Column="1" Grid.Row="1">
                            <TextBlock Text="{Binding MonthTotalUnits}" FontSize="20" FontWeight="Bold" Foreground="{DynamicResource TextPrimaryBrush}"/>
                            <TextBlock Text="Total Units" FontSize="10" Foreground="{DynamicResource TextTertiaryBrush}"/>
                        </StackPanel>
                    </Grid>
                </Border>

                <!-- Navigation -->
                <StackPanel Grid.Row="2" Margin="0,8,0,0">
                    <TextBlock Text="NAVIGATION" FontSize="10" FontWeight="SemiBold" 
                               Foreground="{DynamicResource TextDisabledBrush}" Margin="20,0,0,8"/>
                    
                    <RadioButton x:Name="DataTab" Style="{StaticResource SidebarNavButton}" 
                                 IsChecked="True" GroupName="ExpireWiseNav">
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Text="ðŸ“‹" FontSize="16" Margin="0,0,12,0"/>
                            <TextBlock Text="Data View" VerticalAlignment="Center"/>
                        </StackPanel>
                    </RadioButton>
                    
                    <RadioButton x:Name="AnalyticsTab" Style="{StaticResource SidebarNavButton}" GroupName="ExpireWiseNav">
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Text="ðŸ“Š" FontSize="16" Margin="0,0,12,0"/>
                            <TextBlock Text="Analytics" VerticalAlignment="Center"/>
                        </StackPanel>
                    </RadioButton>
                    
                    <Separator Background="{DynamicResource SurfaceHoverBrush}" Margin="16,12"/>
                    
                    <TextBlock Text="ACTIONS" FontSize="10" FontWeight="SemiBold" 
                               Foreground="{DynamicResource TextDisabledBrush}" Margin="20,0,0,8"/>
                    
                    <Button Style="{StaticResource SidebarActionButton}" Command="{Binding AddItemCommand}">
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Text="âž•" FontSize="16" Margin="0,0,12,0"/>
                            <TextBlock Text="Add Item" VerticalAlignment="Center"/>
                        </StackPanel>
                    </Button>
                    
                    <Button Style="{StaticResource SidebarActionButton}" Command="{Binding ImportFromExcelCommand}">
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Text="ðŸ“¥" FontSize="16" Margin="0,0,12,0"/>
                            <TextBlock Text="Import Data" VerticalAlignment="Center"/>
                        </StackPanel>
                    </Button>
                    
                    <Button Style="{StaticResource SidebarActionButton}" Command="{Binding ExportToExcelCommand}">
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Text="ðŸ“¤" FontSize="16" Margin="0,0,12,0"/>
                            <TextBlock Text="Export Excel" VerticalAlignment="Center"/>
                        </StackPanel>
                    </Button>
                    
                    <Button Style="{StaticResource SidebarActionButton}" Command="{Binding ExportToCsvCommand}">
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Text="ðŸ“„" FontSize="16" Margin="0,0,12,0"/>
                            <TextBlock Text="Export CSV" VerticalAlignment="Center"/>
                        </StackPanel>
                    </Button>
                </StackPanel>

                <!-- Bottom Actions -->
                <StackPanel Grid.Row="3" Margin="8,0,8,12">
                    <Separator Background="{DynamicResource SurfaceHoverBrush}" Margin="8,0,8,12"/>
                    
                    <Button Style="{StaticResource SidebarActionButton}" Command="{Binding OpenSettingsCommand}">
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Text="âš™ï¸" FontSize="16" Margin="0,0,12,0"/>
                            <TextBlock Text="Settings" VerticalAlignment="Center"/>
                        </StackPanel>
                    </Button>
                    
                    <!-- Last Saved Status -->
                    <Border Background="{DynamicResource BackgroundBrush}" CornerRadius="8" Padding="12,8" Margin="8,8,8,0"
                            Visibility="{Binding LastSavedDisplay, Converter={StaticResource StringToVisibilityConverter}}">
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Text="âœ“" FontSize="11" Foreground="{DynamicResource SuccessBrush}" Margin="0,0,6,0"/>
                            <TextBlock Text="{Binding LastSavedDisplay}" FontSize="10" Foreground="{DynamicResource TextTertiaryBrush}"/>
                        </StackPanel>
                    </Border>
                </StackPanel>
            </Grid>
        </Border>
        
        <!-- Main Content Area -->
        <Grid Grid.Column="1" Background="{DynamicResource BackgroundBrush}">
            <!-- Data View -->
            <Grid Visibility="{Binding IsChecked, ElementName=DataTab, Converter={StaticResource BooleanToVisibilityConverter}}">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>
                
                <!-- Header with Month Navigator -->
                <Border Grid.Row="0" Background="{DynamicResource SurfaceBrush}" Padding="20,16">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>

                        <!-- Left - Title -->
                        <StackPanel Grid.Column="0" VerticalAlignment="Center">
                            <TextBlock Text="Expiration Calendar" FontSize="18" FontWeight="SemiBold" 
                                       Foreground="{DynamicResource TextPrimaryBrush}"/>
                            <TextBlock Text="Track items by expiration month" FontSize="12" 
                                       Foreground="{DynamicResource TextTertiaryBrush}" Margin="0,2,0,0"/>
                        </StackPanel>

                        <!-- Center - Month Navigator -->
                        <StackPanel Grid.Column="1" Orientation="Horizontal" HorizontalAlignment="Center">
                            <Button Command="{Binding PreviousMonthCommand}" 
                                    IsEnabled="{Binding CanGoToPreviousMonth}"
                                    Style="{StaticResource SecondaryButton}"
                                    Width="36" Height="36" Padding="0" Margin="0,0,8,0">
                                <TextBlock Text="â—€" FontSize="12" HorizontalAlignment="Center"/>
                            </Button>
                            
                            <Border CornerRadius="10" Padding="20,8" MinWidth="180">
                                <Border.Background>
                                    <LinearGradientBrush StartPoint="0,0" EndPoint="1,0">
                                        <GradientStop Color="{StaticResource ExpireWiseAccentDarkColor}" Offset="0"/>
                                        <GradientStop Color="{StaticResource ExpireWiseAccentColor}" Offset="0.5"/>
                                        <GradientStop Color="{StaticResource ExpireWiseAccentLightColor}" Offset="1"/>
                                    </LinearGradientBrush>
                                </Border.Background>
                                <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                                    <TextBlock Text="ðŸ“†" FontSize="14" VerticalAlignment="Center" Margin="0,0,8,0"/>
                                    <TextBlock Text="{Binding CurrentMonthDisplay}" 
                                               FontSize="14" FontWeight="Bold" Foreground="White"
                                               VerticalAlignment="Center"/>
                                </StackPanel>
                            </Border>
                            
                            <Button Command="{Binding NextMonthCommand}" 
                                    IsEnabled="{Binding CanGoToNextMonth}"
                                    Style="{StaticResource SecondaryButton}"
                                    Width="36" Height="36" Padding="0" Margin="8,0,0,0">
                                <TextBlock Text="â–¶" FontSize="12" HorizontalAlignment="Center"/>
                            </Button>
                        </StackPanel>

                        <!-- Right - Quick Actions -->
                        <StackPanel Grid.Column="2" Orientation="Horizontal" HorizontalAlignment="Right">
                            <Button Command="{Binding EditItemCommand}" Style="{StaticResource SecondaryButton}" Margin="0,0,8,0" Padding="12,8">
                                <StackPanel Orientation="Horizontal">
                                    <TextBlock Text="âœï¸" FontSize="12" Margin="0,0,6,0"/>
                                    <TextBlock Text="Edit" FontSize="12"/>
                                </StackPanel>
                            </Button>
                            <Button Command="{Binding DeleteSelectedCommand}" Style="{StaticResource DangerButton}" Padding="12,8">
                                <StackPanel Orientation="Horizontal">
                                    <TextBlock Text="ðŸ—‘ï¸" FontSize="12" Margin="0,0,6,0"/>
                                    <TextBlock Text="Delete" FontSize="12"/>
                                </StackPanel>
                            </Button>
                        </StackPanel>
                    </Grid>
                </Border>
                
                <!-- Search Bar with Group Toggle -->
                <Border Grid.Row="1" Background="{DynamicResource SurfaceBrush}" Padding="20,12">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>
                        
                        <!-- Search Box -->
                        <Border Grid.Column="0" Background="{DynamicResource SurfaceHoverBrush}" CornerRadius="10" Padding="12,0" MaxWidth="500" HorizontalAlignment="Left">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                <TextBlock Grid.Column="0" Text="ðŸ”" FontSize="14" VerticalAlignment="Center" Margin="0,0,8,0"/>
                                <TextBox x:Name="SearchBox" Grid.Column="1" Text="{Binding SearchText, UpdateSourceTrigger=PropertyChanged}"
                                         Background="Transparent" BorderThickness="0" Foreground="{DynamicResource TextPrimaryBrush}"
                                         VerticalAlignment="Center" Padding="0,8" FontSize="14"
                                         CaretBrush="{DynamicResource TextPrimaryBrush}">
                                    <TextBox.Style>
                                        <Style TargetType="TextBox">
                                            <Style.Triggers>
                                                <Trigger Property="Text" Value="">
                                                    <Setter Property="Background">
                                                        <Setter.Value>
                                                            <VisualBrush Stretch="None" AlignmentX="Left">
                                                                <VisualBrush.Visual>
                                                                    <TextBlock Text="Search items..." Foreground="{DynamicResource TextTertiaryBrush}"/>
                                                                </VisualBrush.Visual>
                                                            </VisualBrush>
                                                        </Setter.Value>
                                                    </Setter>
                                                </Trigger>
                                            </Style.Triggers>
                                        </Style>
                                    </TextBox.Style>
                                </TextBox>
                            </Grid>
                        </Border>
                        
                        <!-- Group by Store Toggle -->
                        <ToggleButton Grid.Column="1" IsChecked="{Binding GroupByStore}" 
                                      ToolTip="Group items by store location" Cursor="Hand">
                            <ToggleButton.Style>
                                <Style TargetType="ToggleButton">
                                    <Setter Property="Background" Value="{DynamicResource SurfaceHoverBrush}"/>
                                    <Setter Property="Foreground" Value="{DynamicResource TextSecondaryBrush}"/>
                                    <Setter Property="BorderThickness" Value="0"/>
                                    <Setter Property="Padding" Value="14,10"/>
                                    <Setter Property="Template">
                                        <Setter.Value>
                                            <ControlTemplate TargetType="ToggleButton">
                                                <Border x:Name="Bg" Background="{TemplateBinding Background}" 
                                                        CornerRadius="10" Padding="{TemplateBinding Padding}">
                                                    <StackPanel Orientation="Horizontal">
                                                        <TextBlock Text="ðŸ“" FontSize="14" Margin="0,0,8,0" VerticalAlignment="Center"/>
                                                        <TextBlock Text="Group by Store" FontSize="13" 
                                                                   Foreground="{TemplateBinding Foreground}" VerticalAlignment="Center"/>
                                                    </StackPanel>
                                                </Border>
                                                <ControlTemplate.Triggers>
                                                    <Trigger Property="IsMouseOver" Value="True">
                                                        <Setter TargetName="Bg" Property="Background" Value="{DynamicResource SidebarActiveBrush}"/>
                                                    </Trigger>
                                                    <Trigger Property="IsChecked" Value="True">
                                                        <Setter TargetName="Bg" Property="Background" Value="{StaticResource ExpireWiseAccentBrush}"/>
                                                        <Setter Property="Foreground" Value="White"/>
                                                    </Trigger>
                                                </ControlTemplate.Triggers>
                                            </ControlTemplate>
                                        </Setter.Value>
                                    </Setter>
                                </Style>
                            </ToggleButton.Style>
                        </ToggleButton>
                    </Grid>
                </Border>
                
                <!-- Data Grid Area -->
                <Grid Grid.Row="2" Margin="20">
                    <!-- Empty State -->
                    <Border Visibility="{Binding HasData, Converter={StaticResource InverseBoolToVisibilityConverter}}"
                            Background="{DynamicResource SurfaceBrush}" CornerRadius="16" Padding="40">
                        <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center">
                            <Border Width="100" Height="100" CornerRadius="50" Margin="0,0,0,24">
                                <Border.Background>
                                    <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                                        <GradientStop Color="{StaticResource ExpireWiseAccentColor}" Offset="0"/>
                                        <GradientStop Color="{StaticResource ExpireWiseAccentLightColor}" Offset="1"/>
                                    </LinearGradientBrush>
                                </Border.Background>
                                <TextBlock Text="ðŸ“…" FontSize="48" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                            </Border>
                            <TextBlock Text="No Expiration Data" FontSize="20" FontWeight="Bold"
                                       Foreground="{DynamicResource TextPrimaryBrush}" HorizontalAlignment="Center"/>
                            <TextBlock Text="Add items or import data to start tracking" 
                                       FontSize="13" Foreground="{DynamicResource TextSecondaryBrush}" 
                                       HorizontalAlignment="Center" Margin="0,8,0,24"/>
                            
                            <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                                <Button Command="{Binding AddItemCommand}" Style="{StaticResource PrimaryButton}" Padding="16,10" Margin="0,0,8,0">
                                    <StackPanel Orientation="Horizontal">
                                        <TextBlock Text="âž•" FontSize="14" Margin="0,0,8,0"/>
                                        <TextBlock Text="Add Item" FontSize="13"/>
                                    </StackPanel>
                                </Button>
                                
                                <Button Command="{Binding ImportFromExcelCommand}" Style="{StaticResource SecondaryButton}" Padding="16,10">
                                    <StackPanel Orientation="Horizontal">
                                        <TextBlock Text="ðŸ“¥" FontSize="14" Margin="0,0,8,0"/>
                                        <TextBlock Text="Import Data" FontSize="13"/>
                                    </StackPanel>
                                </Button>
                            </StackPanel>
                        </StackPanel>
                    </Border>
                    
                    <!-- Data Grid (visible when has data) -->
                    <DataGrid x:Name="ItemsGrid" ItemsSource="{Binding Source={StaticResource GroupedItemsView}}"
                              Visibility="{Binding HasData, Converter={StaticResource BooleanToVisibilityConverter}}"
                              SelectedItem="{Binding SelectedItem}"
                              SelectionMode="Extended" SelectionUnit="FullRow"
                              SelectionChanged="OnItemsGridSelectionChanged"
                              VirtualizingStackPanel.IsVirtualizing="True"
                              VirtualizingStackPanel.VirtualizationMode="Recycling"
                              EnableRowVirtualization="True"
                              EnableColumnVirtualization="True"
                              Style="{StaticResource ModernDataGrid}"
                              ColumnHeaderStyle="{StaticResource ModernDataGridColumnHeader}"
                              CellStyle="{StaticResource ModernDataGridCell}"
                              RowStyle="{StaticResource ModernDataGridRow}">
                        <DataGrid.InputBindings>
                            <MouseBinding MouseAction="LeftDoubleClick" Command="{Binding EditItemCommand}"/>
                        </DataGrid.InputBindings>
                        <DataGrid.Columns>
                            <DataGridTextColumn Header="ITEM NUMBER" Binding="{Binding ItemNumber}" Width="120"/>
                            <DataGridTextColumn Header="DESCRIPTION" Binding="{Binding Description}" Width="*"/>
                            <DataGridTextColumn Header="STORE" Binding="{Binding Location, Converter={StaticResource StoreDisplayConverter}}" Width="200"/>
                            <DataGridTextColumn Header="QTY" Binding="{Binding Quantity}" Width="70"/>
                            <DataGridTemplateColumn Header="STATUS" Width="100">
                                <DataGridTemplateColumn.CellTemplate>
                                    <DataTemplate>
                                        <Border CornerRadius="6" Padding="8,4" HorizontalAlignment="Center">
                                            <Border.Style>
                                                <Style TargetType="Border">
                                                    <Setter Property="Background" Value="{DynamicResource SuccessBrush}"/>
                                                    <Style.Triggers>
                                                        <DataTrigger Binding="{Binding Status}" Value="Warning">
                                                            <Setter Property="Background" Value="{DynamicResource WarningBrush}"/>
                                                        </DataTrigger>
                                                        <DataTrigger Binding="{Binding Status}" Value="Critical">
                                                            <Setter Property="Background" Value="{DynamicResource DangerBrush}"/>
                                                        </DataTrigger>
                                                        <DataTrigger Binding="{Binding Status}" Value="Expired">
                                                            <Setter Property="Background" Value="{DynamicResource TextTertiaryBrush}"/>
                                                        </DataTrigger>
                                                    </Style.Triggers>
                                                </Style>
                                            </Border.Style>
                                            <TextBlock Text="{Binding Status}" FontWeight="SemiBold" 
                                                       Foreground="White" FontSize="11"/>
                                        </Border>
                                    </DataTemplate>
                                </DataGridTemplateColumn.CellTemplate>
                            </DataGridTemplateColumn>
                        </DataGrid.Columns>

                        <DataGrid.GroupStyle>
                            <GroupStyle>
                                <GroupStyle.ContainerStyle>
                                    <Style TargetType="{x:Type GroupItem}">
                                        <Setter Property="Margin" Value="0,12,0,0"/>
                                        <Setter Property="Template">
                                            <Setter.Value>
                                                <ControlTemplate TargetType="{x:Type GroupItem}">
                                                    <Border Background="{DynamicResource SurfaceBrush}" CornerRadius="12" 
                                                            BorderBrush="{DynamicResource SurfaceHoverBrush}" BorderThickness="1"
                                                            Margin="0,0,0,4">
                                                        <Expander IsExpanded="True" Background="Transparent" BorderThickness="0">
                                                            <Expander.Header>
                                                                <Grid Margin="8,8,8,4">
                                                                    <Grid.ColumnDefinitions>
                                                                        <ColumnDefinition Width="Auto"/>
                                                                        <ColumnDefinition Width="*"/>
                                                                        <ColumnDefinition Width="Auto"/>
                                                                    </Grid.ColumnDefinitions>
                                                                    
                                                                    <Border Grid.Column="0" Background="{StaticResource ExpireWiseAccentBrush}" 
                                                                            CornerRadius="6" Width="28" Height="28" Margin="0,0,12,0">
                                                                        <TextBlock Text="ðŸ“" FontSize="12" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                                                    </Border>
                                                                    
                                                                    <TextBlock Grid.Column="1" 
                                                                               Text="{Binding Name, Converter={StaticResource StoreDisplayConverter}}" 
                                                                               FontWeight="SemiBold" FontSize="14" 
                                                                               Foreground="{StaticResource ExpireWiseAccentLightBrush}" 
                                                                               VerticalAlignment="Center"/>
                                                                    
                                                                    <Border Grid.Column="2" Background="{DynamicResource SurfaceHoverBrush}" 
                                                                            CornerRadius="8" Padding="12,6" Margin="12,0,0,0">
                                                                        <TextBlock VerticalAlignment="Center">
                                                                            <Run Text="{Binding ItemCount, Mode=OneWay}" FontWeight="SemiBold" 
                                                                                 Foreground="{DynamicResource TextPrimaryBrush}"/>
                                                                            <Run Text=" items" Foreground="{DynamicResource TextSecondaryBrush}"/>
                                                                        </TextBlock>
                                                                    </Border>
                                                                </Grid>
                                                            </Expander.Header>
                                                            <ItemsPresenter Margin="0,0,0,8"/>
                                                        </Expander>
                                                    </Border>
                                                </ControlTemplate>
                                            </Setter.Value>
                                        </Setter>
                                    </Style>
                                </GroupStyle.ContainerStyle>
                                <GroupStyle.Panel>
                                    <ItemsPanelTemplate>
                                        <DataGridRowsPresenter/>
                                    </ItemsPanelTemplate>
                                </GroupStyle.Panel>
                            </GroupStyle>
                        </DataGrid.GroupStyle>
                    </DataGrid>
                </Grid>

                <!-- Status Bar -->
                <Border Grid.Row="3" Background="{DynamicResource SurfaceBrush}" Padding="20,12">
                    <Grid>
                        <TextBlock Text="{Binding StatusMessage}" Foreground="{DynamicResource TextSecondaryBrush}" FontSize="12"/>
                        <StackPanel Orientation="Horizontal" HorizontalAlignment="Right"
                                    Visibility="{Binding IsLoading, Converter={StaticResource BooleanToVisibilityConverter}}">
                            <TextBlock Text="â³" FontSize="12" Margin="0,0,8,0"/>
                            <TextBlock Text="Loading..." Foreground="{DynamicResource TextSecondaryBrush}" FontSize="12"/>
                        </StackPanel>
                    </Grid>
                </Border>
            </Grid>

            <!-- Analytics View -->
            <local:ExpireWiseAnalyticsView DataContext="{Binding Analytics}"
                                           Visibility="{Binding IsChecked, ElementName=AnalyticsTab, Converter={StaticResource BooleanToVisibilityConverter}}"/>
        </Grid>
    </Grid>
</UserControl>
