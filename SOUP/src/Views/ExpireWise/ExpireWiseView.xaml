<UserControl x:Class="SOUP.Views.ExpireWise.ExpireWiseView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:vm="clr-namespace:SOUP.ViewModels"
             xmlns:local="clr-namespace:SOUP.Views.ExpireWise"
             xmlns:views="clr-namespace:SOUP.Features.ExpireWise.Views"
             xmlns:converters="clr-namespace:SOUP.Converters"
             mc:Ignorable="d"
             d:DesignHeight="800" d:DesignWidth="1200"
             d:DataContext="{d:DesignInstance Type=vm:ExpireWiseViewModel}"
             Focusable="True">

    <!-- Keyboard Shortcuts -->
    <UserControl.InputBindings>
        <!-- Quick Actions -->
        <KeyBinding Key="N" Modifiers="Ctrl" Command="{Binding ToggleQuickAddCommand}"/>
        <KeyBinding Key="I" Modifiers="Ctrl" Command="{Binding ImportFromExcelCommand}"/>
        <KeyBinding Key="E" Modifiers="Ctrl" Command="{Binding ExportToCsvCommand}"/>
        <KeyBinding Key="F" Modifiers="Ctrl" Command="{Binding FocusSearchCommand}"/>

        <!-- Item Actions -->
        <KeyBinding Key="Return" Modifiers="Ctrl" Command="{Binding EditItemCommand}"/>
        <KeyBinding Key="Delete" Command="{Binding DeleteSelectedCommand}"/>

        <!-- Month Navigation -->
        <KeyBinding Key="Left" Modifiers="Ctrl" Command="{Binding PreviousMonthCommand}"/>
        <KeyBinding Key="Right" Modifiers="Ctrl" Command="{Binding NextMonthCommand}"/>

        <!-- Refresh -->
        <KeyBinding Key="R" Modifiers="Ctrl" Command="{Binding LoadItemsCommand}"/>
    </UserControl.InputBindings>

    <UserControl.Resources>
        <local:StoreDisplayConverter x:Key="StoreDisplayConverter"/>
        <converters:IntToBoolConverter x:Key="IntToBoolConverter"/>
        <converters:IntToVisibilityConverter x:Key="IntToVisibilityConverter"/>
        <converters:BoolToSidebarWidthConverter x:Key="BoolToSidebarWidthConverter"/>
        <!-- CollectionView now managed in ViewModel for better performance -->
        <CollectionViewSource x:Key="GroupedItemsView" Source="{Binding FilteredItems}"/>

        <!-- Custom Keyboard Focus Visual Style -->
        <Style x:Key="KeyboardFocusVisual">
            <Setter Property="Control.Template">
                <Setter.Value>
                    <ControlTemplate>
                        <Rectangle Stroke="#f59e0b" StrokeThickness="2" StrokeDashArray="2 2"
                                   SnapsToDevicePixels="True" RadiusX="4" RadiusY="4"/>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- ExpireWise Accent Colors (Amber/Orange theme - matches launcher) -->
        <Color x:Key="ExpireWiseAccentColor">#f59e0b</Color>
        <Color x:Key="ExpireWiseAccentLightColor">#fbbf24</Color>
        <Color x:Key="ExpireWiseAccentDarkColor">#d97706</Color>
        <SolidColorBrush x:Key="ExpireWiseAccentBrush" Color="{StaticResource ExpireWiseAccentColor}"/>
        <SolidColorBrush x:Key="ExpireWiseAccentLightBrush" Color="{StaticResource ExpireWiseAccentLightColor}"/>
        <SolidColorBrush x:Key="ExpireWiseAccentDarkBrush" Color="{StaticResource ExpireWiseAccentDarkColor}"/>
        
        <!-- Sidebar Navigation RadioButton Style -->
        <Style x:Key="SidebarNavButton" TargetType="RadioButton">
            <Setter Property="Foreground" Value="{DynamicResource TextSecondaryBrush}"/>
            <Setter Property="FontSize" Value="13"/>
            <Setter Property="FontWeight" Value="Medium"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Padding" Value="16,12"/>
            <Setter Property="Margin" Value="8,2"/>
            <Setter Property="FocusVisualStyle" Value="{x:Null}"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="RadioButton">
                        <Border x:Name="Bg" Background="Transparent" CornerRadius="10"
                                Padding="{TemplateBinding Padding}">
                            <ContentPresenter VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="Bg" Property="Background" Value="{DynamicResource SurfaceHoverBrush}"/>
                            </Trigger>
                            <Trigger Property="IsChecked" Value="True">
                                <Setter TargetName="Bg" Property="Background" Value="{DynamicResource SidebarActiveBrush}"/>
                                <Setter Property="Foreground" Value="{StaticResource ExpireWiseAccentLightBrush}"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
        
        <!-- Sidebar Action Button Style -->
        <Style x:Key="SidebarActionButton" TargetType="Button">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="Foreground" Value="{DynamicResource TextSecondaryBrush}"/>
            <Setter Property="FontSize" Value="13"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Padding" Value="16,12"/>
            <Setter Property="Margin" Value="8,2"/>
            <Setter Property="HorizontalContentAlignment" Value="Left"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="FocusVisualStyle" Value="{x:Null}"/>
            <Setter Property="Focusable" Value="False"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border x:Name="Bg" Background="{TemplateBinding Background}" CornerRadius="10"
                                Padding="{TemplateBinding Padding}">
                            <ContentPresenter VerticalAlignment="Center" HorizontalAlignment="{TemplateBinding HorizontalContentAlignment}"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="Bg" Property="Background" Value="{DynamicResource SurfaceHoverBrush}"/>
                            </Trigger>
                            <Trigger Property="IsPressed" Value="True">
                                <Setter TargetName="Bg" Property="Background" Value="{DynamicResource SidebarActiveBrush}"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Top Navigation Tab Style (for Dashboard/Inventory/Analytics) -->
        <Style x:Key="TopNavTabStyle" TargetType="RadioButton">
            <Setter Property="Foreground" Value="{DynamicResource TextSecondaryBrush}"/>
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="FontWeight" Value="Medium"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Padding" Value="20,0"/>
            <Setter Property="Margin" Value="0,0,8,0"/>
            <Setter Property="Height" Value="64"/>
            <Setter Property="FocusVisualStyle" Value="{x:Null}"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="RadioButton">
                        <Grid>
                            <ContentPresenter x:Name="Content" VerticalAlignment="Center" HorizontalAlignment="Center"
                                              RenderTransformOrigin="0.5,0.5">
                                <ContentPresenter.RenderTransform>
                                    <TranslateTransform Y="0"/>
                                </ContentPresenter.RenderTransform>
                            </ContentPresenter>
                            <!-- Active underline with enhanced thickness and animation -->
                            <Border x:Name="ActiveLine" Height="3" VerticalAlignment="Bottom"
                                    Background="{StaticResource ExpireWiseAccentBrush}"
                                    CornerRadius="2,2,0,0" Opacity="0"
                                    RenderTransformOrigin="0.5,0.5">
                                <Border.RenderTransform>
                                    <ScaleTransform ScaleX="0.8" ScaleY="1"/>
                                </Border.RenderTransform>
                            </Border>
                        </Grid>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="Foreground" Value="{DynamicResource TextPrimaryBrush}"/>
                                <Trigger.EnterActions>
                                    <BeginStoryboard>
                                        <Storyboard>
                                            <DoubleAnimation Storyboard.TargetName="ActiveLine"
                                                           Storyboard.TargetProperty="Opacity"
                                                           To="0.5" Duration="0:0:0.2"/>
                                            <DoubleAnimation Storyboard.TargetName="ActiveLine"
                                                           Storyboard.TargetProperty="(UIElement.RenderTransform).(ScaleTransform.ScaleX)"
                                                           To="0.9" Duration="0:0:0.2">
                                                <DoubleAnimation.EasingFunction>
                                                    <CubicEase EasingMode="EaseOut"/>
                                                </DoubleAnimation.EasingFunction>
                                            </DoubleAnimation>
                                            <DoubleAnimation Storyboard.TargetName="Content"
                                                           Storyboard.TargetProperty="(UIElement.RenderTransform).(TranslateTransform.Y)"
                                                           To="-2" Duration="0:0:0.2">
                                                <DoubleAnimation.EasingFunction>
                                                    <CubicEase EasingMode="EaseOut"/>
                                                </DoubleAnimation.EasingFunction>
                                            </DoubleAnimation>
                                        </Storyboard>
                                    </BeginStoryboard>
                                </Trigger.EnterActions>
                                <Trigger.ExitActions>
                                    <BeginStoryboard>
                                        <Storyboard>
                                            <DoubleAnimation Storyboard.TargetName="ActiveLine"
                                                           Storyboard.TargetProperty="Opacity"
                                                           To="0" Duration="0:0:0.2"/>
                                            <DoubleAnimation Storyboard.TargetName="ActiveLine"
                                                           Storyboard.TargetProperty="(UIElement.RenderTransform).(ScaleTransform.ScaleX)"
                                                           To="0.8" Duration="0:0:0.2">
                                                <DoubleAnimation.EasingFunction>
                                                    <CubicEase EasingMode="EaseOut"/>
                                                </DoubleAnimation.EasingFunction>
                                            </DoubleAnimation>
                                            <DoubleAnimation Storyboard.TargetName="Content"
                                                           Storyboard.TargetProperty="(UIElement.RenderTransform).(TranslateTransform.Y)"
                                                           To="0" Duration="0:0:0.2">
                                                <DoubleAnimation.EasingFunction>
                                                    <CubicEase EasingMode="EaseOut"/>
                                                </DoubleAnimation.EasingFunction>
                                            </DoubleAnimation>
                                        </Storyboard>
                                    </BeginStoryboard>
                                </Trigger.ExitActions>
                            </Trigger>
                            <Trigger Property="IsChecked" Value="True">
                                <Setter Property="Foreground" Value="{StaticResource ExpireWiseAccentLightBrush}"/>
                                <Setter TargetName="ActiveLine" Property="Opacity" Value="1"/>
                                <Setter TargetName="ActiveLine" Property="RenderTransform">
                                    <Setter.Value>
                                        <ScaleTransform ScaleX="1" ScaleY="1"/>
                                    </Setter.Value>
                                </Setter>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Modern DataGrid Style -->
        <Style x:Key="ModernDataGrid" TargetType="DataGrid">
            <Setter Property="Background" Value="{DynamicResource SurfaceBrush}"/>
            <Setter Property="Foreground" Value="{DynamicResource TextPrimaryBrush}"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="RowHeaderWidth" Value="0"/>
            <Setter Property="AutoGenerateColumns" Value="False"/>
            <Setter Property="CanUserAddRows" Value="False"/>
            <Setter Property="CanUserDeleteRows" Value="False"/>
            <Setter Property="CanUserResizeRows" Value="False"/>
            <Setter Property="GridLinesVisibility" Value="None"/>
            <Setter Property="HeadersVisibility" Value="Column"/>
            <Setter Property="HorizontalScrollBarVisibility" Value="Auto"/>
            <Setter Property="VerticalScrollBarVisibility" Value="Auto"/>
        </Style>
        
        <!-- Modern DataGrid Column Header Style -->
        <Style x:Key="ModernDataGridColumnHeader" TargetType="DataGridColumnHeader">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="Foreground" Value="{DynamicResource TextSecondaryBrush}"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="FontSize" Value="11"/>
            <Setter Property="Padding" Value="12,16"/>
            <Setter Property="BorderThickness" Value="0,0,0,1"/>
            <Setter Property="BorderBrush" Value="{DynamicResource SurfaceHoverBrush}"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="DataGridColumnHeader">
                        <Border Background="{TemplateBinding Background}" 
                                BorderBrush="{TemplateBinding BorderBrush}"
                                BorderThickness="{TemplateBinding BorderThickness}"
                                Padding="{TemplateBinding Padding}">
                            <ContentPresenter HorizontalAlignment="{TemplateBinding HorizontalContentAlignment}"
                                              VerticalAlignment="Center"/>
                        </Border>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
        
        <!-- Modern DataGrid Cell Style -->
        <Style x:Key="ModernDataGridCell" TargetType="DataGridCell">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="Foreground" Value="{DynamicResource TextPrimaryBrush}"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Padding" Value="12,14"/>
            <Setter Property="FontSize" Value="13"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="DataGridCell">
                        <Border Background="{TemplateBinding Background}" 
                                Padding="{TemplateBinding Padding}">
                            <ContentPresenter VerticalAlignment="Center"/>
                        </Border>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
            <Style.Triggers>
                <Trigger Property="IsSelected" Value="True">
                    <Setter Property="Background" Value="{DynamicResource SidebarActiveBrush}"/>
                    <Setter Property="Foreground" Value="{StaticResource ExpireWiseAccentLightBrush}"/>
                </Trigger>
            </Style.Triggers>
        </Style>
        
        <!-- Modern DataGrid Row Style with animations -->
        <Style x:Key="ModernDataGridRow" TargetType="DataGridRow">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="Margin" Value="0,1"/>
            <Setter Property="RenderTransformOrigin" Value="0,0.5"/>
            <Setter Property="RenderTransform">
                <Setter.Value>
                    <TranslateTransform X="0"/>
                </Setter.Value>
            </Setter>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="DataGridRow">
                        <Border x:Name="RowBorder" 
                                Background="{TemplateBinding Background}" 
                                CornerRadius="8"
                                Margin="4,2">
                            <SelectiveScrollingGrid>
                                <SelectiveScrollingGrid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="*"/>
                                </SelectiveScrollingGrid.ColumnDefinitions>
                                <SelectiveScrollingGrid.RowDefinitions>
                                    <RowDefinition Height="*"/>
                                    <RowDefinition Height="Auto"/>
                                </SelectiveScrollingGrid.RowDefinitions>
                                <DataGridCellsPresenter Grid.Column="1" ItemsPanel="{TemplateBinding ItemsPanel}"
                                                        SnapsToDevicePixels="{TemplateBinding SnapsToDevicePixels}"/>
                                <DataGridDetailsPresenter Grid.Column="1" Grid.Row="1"
                                                          Visibility="{TemplateBinding DetailsVisibility}"
                                                          SelectiveScrollingGrid.SelectiveScrollingOrientation="Both"/>
                            </SelectiveScrollingGrid>
                        </Border>
                        <ControlTemplate.Triggers>
                            <EventTrigger RoutedEvent="MouseEnter">
                                <BeginStoryboard>
                                    <Storyboard>
                                        <DoubleAnimation Storyboard.TargetProperty="RenderTransform.X" To="4" Duration="0:0:0.15">
                                            <DoubleAnimation.EasingFunction><QuadraticEase EasingMode="EaseOut"/></DoubleAnimation.EasingFunction>
                                        </DoubleAnimation>
                                    </Storyboard>
                                </BeginStoryboard>
                            </EventTrigger>
                            <EventTrigger RoutedEvent="MouseLeave">
                                <BeginStoryboard>
                                    <Storyboard>
                                        <DoubleAnimation Storyboard.TargetProperty="RenderTransform.X" To="0" Duration="0:0:0.2">
                                            <DoubleAnimation.EasingFunction><QuadraticEase EasingMode="EaseOut"/></DoubleAnimation.EasingFunction>
                                        </DoubleAnimation>
                                    </Storyboard>
                                </BeginStoryboard>
                            </EventTrigger>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="RowBorder" Property="Background" Value="{DynamicResource SurfaceHoverBrush}"/>
                            </Trigger>
                            <Trigger Property="IsSelected" Value="True">
                                <Setter TargetName="RowBorder" Property="Background" Value="{DynamicResource SidebarActiveBrush}"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
    </UserControl.Resources>

    <UserControl.Triggers>
        <EventTrigger RoutedEvent="Loaded">
            <BeginStoryboard Storyboard="{StaticResource FadeInStoryboard}"/>
        </EventTrigger>
    </UserControl.Triggers>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="64"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- Top Navigation Bar -->
        <Border Grid.Row="0" Background="{DynamicResource SurfaceBrush}" BorderBrush="{DynamicResource BorderBrush}" BorderThickness="0,0,0,1">
            <Grid Margin="20,0">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                <StackPanel Grid.Column="0" Orientation="Horizontal" VerticalAlignment="Center" Margin="0,0,40,0">
                    <Border Width="40" Height="40" CornerRadius="10" Margin="0,0,12,0">
                        <Border.Background>
                            <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                                <GradientStop Color="{StaticResource ExpireWiseAccentColor}" Offset="0"/>
                                <GradientStop Color="{StaticResource ExpireWiseAccentLightColor}" Offset="1"/>
                            </LinearGradientBrush>
                        </Border.Background>
                        <TextBlock Text="ðŸ“…" FontSize="20" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                    </Border>
                    <StackPanel VerticalAlignment="Center">
                        <TextBlock Text="ExpireWise" FontSize="16" FontWeight="Bold" Foreground="{DynamicResource TextPrimaryBrush}"/>
                        <TextBlock Text="Expiration Tracker" FontSize="10" Foreground="{DynamicResource TextTertiaryBrush}"/>
                    </StackPanel>
                </StackPanel>
                <StackPanel Grid.Column="1" Orientation="Horizontal" HorizontalAlignment="Center" VerticalAlignment="Stretch">
                    <RadioButton x:Name="DashboardTab" GroupName="MainNav" IsChecked="{Binding SelectedViewIndex, Converter={StaticResource IntToBoolConverter}, ConverterParameter=0}" Style="{StaticResource TopNavTabStyle}"
                                 AutomationProperties.Name="Dashboard View Tab"
                                 AutomationProperties.HelpText="Navigate to the dashboard view showing overview and key metrics"
                                 KeyboardNavigation.TabIndex="1">
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Text="ðŸ“Š" FontSize="16" Margin="0,0,8,0" AutomationProperties.Name="Dashboard icon"/>
                            <TextBlock Text="Dashboard" FontSize="14"/>
                        </StackPanel>
                    </RadioButton>
                    <RadioButton x:Name="InventoryTab" GroupName="MainNav" IsChecked="{Binding SelectedViewIndex, Converter={StaticResource IntToBoolConverter}, ConverterParameter=1}" Style="{StaticResource TopNavTabStyle}"
                                 AutomationProperties.Name="Inventory View Tab"
                                 AutomationProperties.HelpText="Navigate to the inventory view showing all expiration items"
                                 KeyboardNavigation.TabIndex="2">
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Text="ðŸ“‹" FontSize="16" Margin="0,0,8,0" AutomationProperties.Name="Inventory icon"/>
                            <TextBlock Text="Inventory" FontSize="14"/>
                        </StackPanel>
                    </RadioButton>
                    <RadioButton x:Name="AnalyticsTab2" GroupName="MainNav" IsChecked="{Binding SelectedViewIndex, Converter={StaticResource IntToBoolConverter}, ConverterParameter=2}" Style="{StaticResource TopNavTabStyle}"
                                 AutomationProperties.Name="Analytics View Tab"
                                 AutomationProperties.HelpText="Navigate to the analytics view showing charts and insights"
                                 KeyboardNavigation.TabIndex="3">
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Text="ðŸ“ˆ" FontSize="16" Margin="0,0,8,0" AutomationProperties.Name="Analytics icon"/>
                            <TextBlock Text="Analytics" FontSize="14"/>
                        </StackPanel>
                    </RadioButton>
                </StackPanel>
                <StackPanel Grid.Column="2" Orientation="Horizontal" VerticalAlignment="Center">
                    <Button Command="{Binding ShowQuickAddDialogCommand}" Style="{StaticResource PrimaryButton}" Padding="16,8" Margin="0,0,12,0"
                            AutomationProperties.Name="Quick Add Item"
                            AutomationProperties.HelpText="Open the quick add dialog to add a new item to inventory. Keyboard shortcut: Ctrl+N"
                            KeyboardNavigation.TabIndex="4">
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Text="âš¡" FontSize="14" Margin="0,0,6,0" AutomationProperties.Name="Quick add icon"/>
                            <TextBlock Text="Quick Add" FontSize="12" FontWeight="SemiBold"/>
                        </StackPanel>
                    </Button>
                </StackPanel>
            </Grid>
        </Border>

        <Grid Grid.Row="1">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>

        <!-- Contextual Sidebar (Collapsible) -->
        <Border Grid.Column="0" Background="{DynamicResource SurfaceBrush}"
                BorderBrush="{DynamicResource SurfaceHoverBrush}" BorderThickness="0,0,1,0">
            <Border.Width>
                <Binding Path="SidebarCollapsed" Converter="{StaticResource BoolToSidebarWidthConverter}"/>
            </Border.Width>
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <!-- Header -->
                <StackPanel Grid.Row="0" Margin="16,20,16,16">
                    <StackPanel Orientation="Horizontal" Margin="0,0,0,4">
                        <Border Width="36" Height="36" CornerRadius="10" Margin="0,0,12,0">
                            <Border.Background>
                                <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                                    <GradientStop Color="{StaticResource ExpireWiseAccentColor}" Offset="0"/>
                                    <GradientStop Color="{StaticResource ExpireWiseAccentLightColor}" Offset="1"/>
                                </LinearGradientBrush>
                            </Border.Background>
                            <TextBlock Text="ðŸ“…" FontSize="18" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                        <StackPanel VerticalAlignment="Center">
                            <TextBlock Text="ExpireWise" FontSize="16" FontWeight="Bold" Foreground="{DynamicResource TextPrimaryBrush}"/>
                            <TextBlock Text="Expiration Tracker" FontSize="11" Foreground="{DynamicResource TextTertiaryBrush}"/>
                        </StackPanel>
                    </StackPanel>
                </StackPanel>

                <!-- Stats Summary - Enhanced -->
                <Border Grid.Row="1" Background="{DynamicResource BackgroundBrush}"
                        CornerRadius="12" Margin="12,0,12,16" Padding="16">
                    <Border.Effect>
                        <DropShadowEffect BlurRadius="8" ShadowDepth="0" Opacity="0.05" Color="Black"/>
                    </Border.Effect>
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>

                        <StackPanel Grid.Column="0" Grid.Row="0" Margin="0,0,0,16">
                            <TextBlock Text="{Binding TotalItems}" FontSize="24" FontWeight="Bold"
                                       Foreground="{StaticResource ExpireWiseAccentLightBrush}"/>
                            <TextBlock Text="TOTAL ITEMS" FontSize="9" FontWeight="SemiBold"
                                       Foreground="{DynamicResource TextTertiaryBrush}" Margin="0,4,0,0"/>
                        </StackPanel>

                        <StackPanel Grid.Column="1" Grid.Row="0" Margin="0,0,0,16">
                            <TextBlock Text="{Binding MonthItemCount}" FontSize="24" FontWeight="Bold"
                                       Foreground="{DynamicResource WarningLightBrush}"/>
                            <TextBlock Text="THIS MONTH" FontSize="9" FontWeight="SemiBold"
                                       Foreground="{DynamicResource TextTertiaryBrush}" Margin="0,4,0,0"/>
                        </StackPanel>

                        <StackPanel Grid.Column="0" Grid.Row="1">
                            <TextBlock Text="{Binding CriticalCount}" FontSize="24" FontWeight="Bold"
                                       Foreground="{DynamicResource DangerBrush}"/>
                            <TextBlock Text="CRITICAL" FontSize="9" FontWeight="SemiBold"
                                       Foreground="{DynamicResource TextTertiaryBrush}" Margin="0,4,0,0"/>
                        </StackPanel>

                        <StackPanel Grid.Column="1" Grid.Row="1">
                            <TextBlock Text="{Binding MonthTotalUnits}" FontSize="24" FontWeight="Bold"
                                       Foreground="{DynamicResource TextPrimaryBrush}"/>
                            <TextBlock Text="TOTAL UNITS" FontSize="9" FontWeight="SemiBold"
                                       Foreground="{DynamicResource TextTertiaryBrush}" Margin="0,4,0,0"/>
                        </StackPanel>
                    </Grid>
                </Border>

                <!-- Navigation -->
                <StackPanel Grid.Row="2" Margin="0,8,0,0">
                    <TextBlock Text="NAVIGATION" FontSize="10" FontWeight="SemiBold" 
                               Foreground="{DynamicResource TextDisabledBrush}" Margin="20,0,0,8"/>
                    
                    <RadioButton x:Name="DataTab" Style="{StaticResource SidebarNavButton}"
                                 IsChecked="True" GroupName="ExpireWiseNav"
                                 AutomationProperties.Name="Data View"
                                 AutomationProperties.HelpText="View and manage expiration items in a table">
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Text="ðŸ“‹" FontSize="14" Margin="0,0,12,0"/>
                            <TextBlock Text="Data View" VerticalAlignment="Center" FontSize="13"/>
                        </StackPanel>
                    </RadioButton>

                    <RadioButton x:Name="AnalyticsTab" Style="{StaticResource SidebarNavButton}" GroupName="ExpireWiseNav"
                                 AutomationProperties.Name="Analytics View"
                                 AutomationProperties.HelpText="View charts and statistics about expiring items">
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Text="ðŸ“Š" FontSize="14" Margin="0,0,12,0"/>
                            <TextBlock Text="Analytics" VerticalAlignment="Center" FontSize="13"/>
                        </StackPanel>
                    </RadioButton>
                    
                    <Separator Background="{DynamicResource SurfaceHoverBrush}" Margin="16,12"/>
                    
                    <TextBlock Text="ACTIONS" FontSize="10" FontWeight="SemiBold"
                               Foreground="{DynamicResource TextDisabledBrush}" Margin="20,0,0,8"/>

                    <Button Style="{StaticResource SidebarActionButton}" Command="{Binding ToggleQuickAddCommand}"
                            Margin="0,0,0,8"
                            ToolTip="Add single items quickly with SKU lookup (Ctrl+N)">
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Text="âš¡" FontSize="14" Margin="0,0,10,0"/>
                            <TextBlock Text="Quick Add" VerticalAlignment="Center" FontSize="13"/>
                        </StackPanel>
                    </Button>

                    <Button Style="{StaticResource SidebarActionButton}" Command="{Binding ImportFromExcelCommand}"
                            Margin="0,0,0,8"
                            ToolTip="Import multiple items from Excel or CSV file (Ctrl+I)">
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Text="ðŸ“¥" FontSize="14" Margin="0,0,10,0"/>
                            <TextBlock Text="Import Data" VerticalAlignment="Center" FontSize="13"/>
                        </StackPanel>
                    </Button>

                    <Button Style="{StaticResource SidebarActionButton}" Command="{Binding ExportToExcelCommand}"
                            Margin="0,0,0,8"
                            ToolTip="Export current month data to Excel workbook">
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Text="ðŸ“¤" FontSize="14" Margin="0,0,10,0"/>
                            <TextBlock Text="Export Excel" VerticalAlignment="Center" FontSize="13"/>
                        </StackPanel>
                    </Button>

                    <Button Style="{StaticResource SidebarActionButton}" Command="{Binding ExportToCsvCommand}"
                            Margin="0,0,0,8"
                            ToolTip="Export current month data to CSV file (Ctrl+E)">
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Text="ðŸ“„" FontSize="14" Margin="0,0,10,0"/>
                            <TextBlock Text="Export CSV" VerticalAlignment="Center" FontSize="13"/>
                        </StackPanel>
                    </Button>
                </StackPanel>

                <!-- Bottom Actions -->
                <StackPanel Grid.Row="3" Margin="8,0,8,12">
                    <Separator Background="{DynamicResource SurfaceHoverBrush}" Margin="8,0,8,12"/>

                    <Button Style="{StaticResource SidebarActionButton}" Command="{Binding OpenSettingsCommand}"
                            ToolTip="Configure thresholds, notifications, and preferences">
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Text="âš™ï¸" FontSize="16" Margin="0,0,12,0"/>
                            <TextBlock Text="Settings" VerticalAlignment="Center"/>
                        </StackPanel>
                    </Button>

                    <Button Style="{StaticResource SidebarActionButton}" Command="{Binding CheckNotificationsCommand}" Margin="0,8,0,0">
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Text="ðŸ””" FontSize="16" Margin="0,0,12,0"/>
                            <TextBlock Text="Check Notifications" VerticalAlignment="Center"/>
                        </StackPanel>
                    </Button>

                    <!-- Inline notification list (hidden when empty) -->
                    <StackPanel Margin="8,8,8,0">
                        <StackPanel Orientation="Horizontal" HorizontalAlignment="Right">
                            <Button Command="{Binding ClearNotificationsCommand}" Style="{StaticResource SidebarActionButton}" Padding="8,6" Margin="0,0,0,8">
                                <TextBlock Text="Clear" FontSize="12"/>
                            </Button>
                        </StackPanel>
                        <ListBox ItemsSource="{Binding Notifications}">
                        <ListBox.Style>
                            <Style TargetType="ListBox">
                                <Setter Property="Visibility" Value="Collapsed"/>
                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding Notifications.Count}" Value="0">
                                        <Setter Property="Visibility" Value="Collapsed"/>
                                    </DataTrigger>
                                    <DataTrigger Binding="{Binding Notifications.Count}" Value="1">
                                        <Setter Property="Visibility" Value="Visible"/>
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </ListBox.Style>
                            <ListBox.ItemTemplate>
                                <DataTemplate>
                                    <Border Background="{DynamicResource SurfaceBrush}" CornerRadius="8" Padding="8" Margin="0,2,0,2">
                                        <Grid>
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="Auto"/>
                                            </Grid.ColumnDefinitions>
                                            <StackPanel>
                                                <TextBlock Text="{Binding ItemNumber}" FontWeight="SemiBold"/>
                                                <TextBlock Text="{Binding ExpiryDate, StringFormat='Expires: {0:MMM d, yyyy}'}" FontSize="11" Foreground="{DynamicResource TextSecondaryBrush}"/>
                                            </StackPanel>
                                            <Button Grid.Column="1" Command="{Binding RemoveNotificationCommand}" CommandParameter="{Binding}" Style="{StaticResource SidebarActionButton}" Width="56" Height="28">
                                                <TextBlock Text="Dismiss" FontSize="11"/>
                                            </Button>
                                        </Grid>
                                    </Border>
                                </DataTemplate>
                            </ListBox.ItemTemplate>
                        </ListBox>
                    </StackPanel>
                    
                    <!-- Last Saved Status -->
                    <Border Background="{DynamicResource BackgroundBrush}" CornerRadius="8" Padding="12,8" Margin="8,8,8,0"
                            Visibility="{Binding LastSavedDisplay, Converter={StaticResource StringToVisibilityConverter}}">
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Text="âœ“" FontSize="11" Foreground="{DynamicResource SuccessBrush}" Margin="0,0,6,0"/>
                            <TextBlock Text="{Binding LastSavedDisplay}" FontSize="10" Foreground="{DynamicResource TextTertiaryBrush}"/>
                        </StackPanel>
                    </Border>
                </StackPanel>

                <!-- Collapse/Expand Button (Grid.Row="3") -->
                <Border Grid.Row="3" Background="{DynamicResource SurfaceHoverBrush}"
                        Padding="12,8" Margin="8"  CornerRadius="8">
                    <Button Command="{Binding ToggleSidebarCommand}"
                            Style="{StaticResource GhostButton}"
                            HorizontalAlignment="Stretch"
                            Padding="0,8"
                            ToolTip="Collapse/Expand Sidebar">
                        <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                            <TextBlock FontSize="14" Margin="0,0,8,0">
                                <TextBlock.Style>
                                    <Style TargetType="TextBlock">
                                        <Setter Property="Text" Value="â—€"/>
                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding SidebarCollapsed}" Value="True">
                                                <Setter Property="Text" Value="â–¶"/>
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </TextBlock.Style>
                            </TextBlock>
                            <TextBlock Text="Collapse" FontSize="12" FontWeight="Medium">
                                <TextBlock.Style>
                                    <Style TargetType="TextBlock">
                                        <Setter Property="Visibility" Value="Visible"/>
                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding SidebarCollapsed}" Value="True">
                                                <Setter Property="Visibility" Value="Collapsed"/>
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </TextBlock.Style>
                            </TextBlock>
                        </StackPanel>
                    </Button>
                </Border>
            </Grid>
        </Border>

        <!-- Main Content Area -->
        <Grid Grid.Column="1" Background="{DynamicResource BackgroundBrush}">
            <!-- Dashboard View with Transition -->
            <Border Visibility="{Binding SelectedViewIndex, Converter={StaticResource IntToVisibilityConverter}, ConverterParameter=0}"
                    Opacity="0" RenderTransformOrigin="0.5,0.5">
                <Border.RenderTransform>
                    <TranslateTransform X="0" Y="20"/>
                </Border.RenderTransform>
                <Border.Triggers>
                    <EventTrigger RoutedEvent="Border.Loaded">
                        <BeginStoryboard>
                            <Storyboard>
                                <DoubleAnimation Storyboard.TargetProperty="Opacity"
                                               From="0" To="1" Duration="0:0:0.3">
                                    <DoubleAnimation.EasingFunction>
                                        <QuadraticEase EasingMode="EaseOut"/>
                                    </DoubleAnimation.EasingFunction>
                                </DoubleAnimation>
                                <DoubleAnimation Storyboard.TargetProperty="(UIElement.RenderTransform).(TranslateTransform.Y)"
                                               From="20" To="0" Duration="0:0:0.4">
                                    <DoubleAnimation.EasingFunction>
                                        <QuadraticEase EasingMode="EaseOut"/>
                                    </DoubleAnimation.EasingFunction>
                                </DoubleAnimation>
                            </Storyboard>
                        </BeginStoryboard>
                    </EventTrigger>
                </Border.Triggers>
                <local:DashboardView/>
            </Border>

            <!-- Inventory View (formerly Data View) with Transition -->
            <Border Visibility="{Binding SelectedViewIndex, Converter={StaticResource IntToVisibilityConverter}, ConverterParameter=1}"
                    Opacity="0" RenderTransformOrigin="0.5,0.5">
                <Border.RenderTransform>
                    <TranslateTransform X="0" Y="20"/>
                </Border.RenderTransform>
                <Border.Triggers>
                    <EventTrigger RoutedEvent="Border.Loaded">
                        <BeginStoryboard>
                            <Storyboard>
                                <DoubleAnimation Storyboard.TargetProperty="Opacity"
                                               From="0" To="1" Duration="0:0:0.3">
                                    <DoubleAnimation.EasingFunction>
                                        <QuadraticEase EasingMode="EaseOut"/>
                                    </DoubleAnimation.EasingFunction>
                                </DoubleAnimation>
                                <DoubleAnimation Storyboard.TargetProperty="(UIElement.RenderTransform).(TranslateTransform.Y)"
                                               From="20" To="0" Duration="0:0:0.4">
                                    <DoubleAnimation.EasingFunction>
                                        <QuadraticEase EasingMode="EaseOut"/>
                                    </DoubleAnimation.EasingFunction>
                                </DoubleAnimation>
                            </Storyboard>
                        </BeginStoryboard>
                    </EventTrigger>
                </Border.Triggers>
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="52"/> <!-- Compact Header (includes month nav, stats pills, search) -->
                        <RowDefinition Height="*"/> <!-- Data Grid -->
                        <RowDefinition Height="24"/> <!-- Status Bar -->
                    </Grid.RowDefinitions>

                <!-- Compact Header (52px) - Month Navigation + Search -->
                <Border Grid.Row="0" Background="{DynamicResource SurfaceBrush}" Padding="12,0">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="28"/> <!-- Top: Month + Stats + Actions -->
                            <RowDefinition Height="24"/> <!-- Bottom: Search + Filter + Group -->
                        </Grid.RowDefinitions>

                        <!-- Top Row: Month Navigation + Inline Stats Pills + Actions -->
                        <Grid Grid.Row="0">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/> <!-- Month Navigation -->
                                <ColumnDefinition Width="*"/> <!-- Inline Stats Pills -->
                                <ColumnDefinition Width="Auto"/> <!-- Quick Actions -->
                            </Grid.ColumnDefinitions>

                            <!-- Month Navigation - Compact -->
                            <StackPanel Grid.Column="0" Orientation="Horizontal" VerticalAlignment="Center">
                                <Button Command="{Binding PreviousMonthCommand}"
                                        IsEnabled="{Binding CanGoToPreviousMonth}"
                                        Width="24" Height="24" Padding="0" Margin="0,0,6,0"
                                        ToolTip="Previous Month (Ctrl+Left)"
                                        Style="{StaticResource SecondaryButton}">
                                    <TextBlock Text="â—€" FontSize="10" FontWeight="SemiBold"/>
                                </Button>

                                <Border Background="{StaticResource ExpireWiseAccentBrush}"
                                        CornerRadius="8" Padding="12,2" MinWidth="140"
                                        ToolTip="Current viewing month - Use Ctrl+Left/Right to navigate">
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="Auto"/>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="Auto"/>
                                        </Grid.ColumnDefinitions>

                                        <TextBlock Grid.Column="0" Text="ðŸ“†" FontSize="12" VerticalAlignment="Center" Margin="0,0,6,0"/>

                                        <TextBlock Grid.Column="1" Text="{Binding CurrentMonthDisplay}"
                                                  FontSize="12" FontWeight="Bold" Foreground="White"
                                                  VerticalAlignment="Center"/>

                                        <TextBlock Grid.Column="2" VerticalAlignment="Center" Margin="6,0,0,0">
                                            <Run Text="{Binding MonthItemCount}" FontSize="10" Foreground="White" FontWeight="SemiBold"/>
                                        </TextBlock>
                                    </Grid>
                                </Border>

                                <Button Command="{Binding NextMonthCommand}"
                                        IsEnabled="{Binding CanGoToNextMonth}"
                                        Width="24" Height="24" Padding="0" Margin="6,0,0,0"
                                        ToolTip="Next Month (Ctrl+Right)"
                                        Style="{StaticResource SecondaryButton}">
                                    <TextBlock Text="â–¶" FontSize="10" FontWeight="SemiBold"/>
                                </Button>
                            </StackPanel>

                            <!-- Inline Stats Pills - Center -->
                            <StackPanel Grid.Column="1" Orientation="Horizontal" HorizontalAlignment="Center" VerticalAlignment="Center">
                                <!-- Total Items -->
                                <Border Background="{DynamicResource SurfaceHoverBrush}" CornerRadius="8"
                                        Padding="8,2" Margin="4,0" ToolTip="Total items this month"
                                        Visibility="{Binding HasData, Converter={StaticResource BooleanToVisibilityConverter}}">
                                    <StackPanel Orientation="Horizontal">
                                        <TextBlock Text="ðŸ“¦" FontSize="10" Margin="0,0,4,0"/>
                                        <TextBlock Text="{Binding MonthItemCount}" FontSize="11" FontWeight="SemiBold"/>
                                    </StackPanel>
                                </Border>

                                <!-- Warning Items -->
                                <Border Background="{DynamicResource WarningBackgroundBrush}" CornerRadius="8" Padding="8,2" Margin="4,0"
                                        ToolTip="Items expiring soon"
                                        Visibility="{Binding WarningCount, Converter={StaticResource ZeroToVisibilityConverter}, ConverterParameter=Invert}">
                                    <StackPanel Orientation="Horizontal">
                                        <TextBlock Text="âš ï¸" FontSize="10" Margin="0,0,4,0"/>
                                        <TextBlock Text="{Binding WarningCount}" FontSize="11" FontWeight="SemiBold" Foreground="{DynamicResource WarningDarkBrush}"/>
                                    </StackPanel>
                                </Border>

                                <!-- Critical Items -->
                                <Border Background="{DynamicResource DangerBackgroundBrush}" CornerRadius="8" Padding="8,2" Margin="4,0"
                                        ToolTip="Critical items"
                                        Visibility="{Binding CriticalCount, Converter={StaticResource ZeroToVisibilityConverter}, ConverterParameter=Invert}">
                                    <StackPanel Orientation="Horizontal">
                                        <TextBlock Text="ðŸš¨" FontSize="10" Margin="0,0,4,0"/>
                                        <TextBlock Text="{Binding CriticalCount}" FontSize="11" FontWeight="SemiBold" Foreground="{DynamicResource DangerDarkBrush}"/>
                                    </StackPanel>
                                </Border>

                                <!-- Expired Items -->
                                <Border Background="{DynamicResource InfoBackgroundBrush}" CornerRadius="8" Padding="8,2" Margin="4,0"
                                        ToolTip="Expired items"
                                        Visibility="{Binding ExpiredCount, Converter={StaticResource ZeroToVisibilityConverter}, ConverterParameter=Invert}">
                                    <StackPanel Orientation="Horizontal">
                                        <TextBlock Text="â±ï¸" FontSize="10" Margin="0,0,4,0"/>
                                        <TextBlock Text="{Binding ExpiredCount}" FontSize="11" FontWeight="SemiBold" Foreground="{DynamicResource InfoDarkBrush}"/>
                                    </StackPanel>
                                </Border>
                            </StackPanel>

                            <!-- Quick Actions - Right -->
                            <StackPanel Grid.Column="2" Orientation="Horizontal" HorizontalAlignment="Right" VerticalAlignment="Center">
                                <Button Command="{Binding EditItemCommand}"
                                        Width="24" Height="24" Padding="0" Margin="0,0,4,0"
                                        ToolTip="Edit selected item (Ctrl+Enter)"
                                        Style="{StaticResource SecondaryButton}">
                                    <TextBlock Text="âœï¸" FontSize="11"/>
                                </Button>
                                <Button Command="{Binding DeleteSelectedCommand}"
                                        Width="24" Height="24" Padding="0"
                                        ToolTip="Delete selected items (Delete)"
                                        Style="{StaticResource DangerButton}">
                                    <TextBlock Text="ðŸ—‘ï¸" FontSize="11"/>
                                </Button>
                            </StackPanel>
                        </Grid>

                        <!-- Bottom Row: Unified Search + Filter + Group -->
                        <Grid Grid.Row="1">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/> <!-- Search -->
                                <ColumnDefinition Width="Auto"/> <!-- Filter -->
                                <ColumnDefinition Width="Auto"/> <!-- Group -->
                            </Grid.ColumnDefinitions>

                            <!-- Compact Search Box -->
                            <Border Grid.Column="0" Background="{DynamicResource SurfaceHoverBrush}"
                                    CornerRadius="8" Padding="8,0" Height="20" MaxWidth="400"
                                    HorizontalAlignment="Left" MinWidth="250"
                                    BorderThickness="1" BorderBrush="Transparent">
                                <Border.Style>
                                    <Style TargetType="Border">
                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding ElementName=SearchBox, Path=IsFocused}" Value="True">
                                                <Setter Property="BorderBrush" Value="{StaticResource ExpireWiseAccentBrush}"/>
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </Border.Style>
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto"/>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>

                                    <TextBlock Grid.Column="0" Text="ðŸ”" FontSize="10" VerticalAlignment="Center" Margin="0,0,6,0" Opacity="0.6"/>

                                    <TextBox x:Name="SearchBox" Grid.Column="1"
                                             Text="{Binding SearchText, UpdateSourceTrigger=PropertyChanged}"
                                             Background="Transparent" BorderThickness="0"
                                             Foreground="{DynamicResource TextPrimaryBrush}"
                                             VerticalAlignment="Center" Padding="0" FontSize="11"
                                             CaretBrush="{StaticResource ExpireWiseAccentBrush}"
                                             TabIndex="1">
                                        <TextBox.Style>
                                            <Style TargetType="TextBox">
                                                <Style.Triggers>
                                                    <Trigger Property="Text" Value="">
                                                        <Setter Property="Background">
                                                            <Setter.Value>
                                                                <VisualBrush Stretch="None" AlignmentX="Left">
                                                                    <VisualBrush.Visual>
                                                                        <TextBlock Text="Search items..." Foreground="{DynamicResource TextTertiaryBrush}" FontSize="11"/>
                                                                    </VisualBrush.Visual>
                                                                </VisualBrush>
                                                            </Setter.Value>
                                                        </Setter>
                                                    </Trigger>
                                                </Style.Triggers>
                                            </Style>
                                        </TextBox.Style>
                                    </TextBox>

                                    <!-- Clear Button -->
                                    <Button Grid.Column="2" Width="16" Height="16" Padding="0"
                                            Command="{Binding ClearSearchCommand}"
                                            ToolTip="Clear search"
                                            Visibility="{Binding SearchText, Converter={StaticResource StringToVisibilityConverter}}">
                                        <Button.Style>
                                            <Style TargetType="Button">
                                                <Setter Property="Background" Value="Transparent"/>
                                                <Setter Property="Foreground" Value="{DynamicResource TextTertiaryBrush}"/>
                                                <Setter Property="BorderThickness" Value="0"/>
                                                <Setter Property="Template">
                                                    <Setter.Value>
                                                        <ControlTemplate TargetType="Button">
                                                            <Border Background="{TemplateBinding Background}" CornerRadius="8">
                                                                <TextBlock Text="âœ•" FontSize="9" FontWeight="Bold"
                                                                          Foreground="{TemplateBinding Foreground}"
                                                                          HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                                            </Border>
                                                        </ControlTemplate>
                                                    </Setter.Value>
                                                </Setter>
                                                <Style.Triggers>
                                                    <Trigger Property="IsMouseOver" Value="True">
                                                        <Setter Property="Background" Value="{DynamicResource DangerBrush}"/>
                                                        <Setter Property="Foreground" Value="White"/>
                                                    </Trigger>
                                                </Style.Triggers>
                                            </Style>
                                        </Button.Style>
                                    </Button>
                                </Grid>
                            </Border>

                            <!-- Status Filter - Compact -->
                            <ComboBox Grid.Column="1" ItemsSource="{Binding StatusFilters}"
                                      SelectedItem="{Binding StatusFilter}"
                                      Margin="6,0" MinWidth="90" Height="20"
                                      FontSize="11"
                                      Style="{StaticResource ModernComboBoxStyle}"
                                      TabIndex="2"/>

                            <!-- Group Toggle - Compact -->
                            <ToggleButton Grid.Column="2" IsChecked="{Binding GroupByStore}"
                                          Height="20" Padding="8,2"
                                          ToolTip="Group by store"
                                          TabIndex="3">
                                <ToggleButton.Style>
                                    <Style TargetType="ToggleButton">
                                        <Setter Property="Background" Value="{DynamicResource SurfaceHoverBrush}"/>
                                        <Setter Property="Foreground" Value="{DynamicResource TextSecondaryBrush}"/>
                                        <Setter Property="BorderThickness" Value="0"/>
                                        <Setter Property="Template">
                                            <Setter.Value>
                                                <ControlTemplate TargetType="ToggleButton">
                                                    <Border x:Name="Bg" Background="{TemplateBinding Background}" CornerRadius="8" Padding="{TemplateBinding Padding}">
                                                        <StackPanel Orientation="Horizontal">
                                                            <TextBlock Text="ðŸ“" FontSize="10" Margin="0,0,4,0" VerticalAlignment="Center"/>
                                                            <TextBlock Text="Group" FontSize="10" Foreground="{TemplateBinding Foreground}" VerticalAlignment="Center"/>
                                                        </StackPanel>
                                                    </Border>
                                                    <ControlTemplate.Triggers>
                                                        <Trigger Property="IsMouseOver" Value="True">
                                                            <Setter TargetName="Bg" Property="Background" Value="{DynamicResource SidebarActiveBrush}"/>
                                                        </Trigger>
                                                        <Trigger Property="IsChecked" Value="True">
                                                            <Setter TargetName="Bg" Property="Background" Value="{StaticResource ExpireWiseAccentBrush}"/>
                                                            <Setter Property="Foreground" Value="White"/>
                                                        </Trigger>
                                                    </ControlTemplate.Triggers>
                                                </ControlTemplate>
                                            </Setter.Value>
                                        </Setter>
                                    </Style>
                                </ToggleButton.Style>
                            </ToggleButton>
                        </Grid>
                    </Grid>
                </Border>

                <!-- Data Grid Area -->
                <Grid Grid.Row="1" Margin="20">
                    <!-- Enhanced Empty State with Animations -->
                    <Border Visibility="{Binding HasData, Converter={StaticResource InverseBoolToVisibilityConverter}}"
                            Background="{DynamicResource SurfaceBrush}" CornerRadius="16"
                            MaxWidth="520" Padding="48,40"
                            HorizontalAlignment="Center" VerticalAlignment="Center"
                            RenderTransformOrigin="0.5,0.5">
                        <Border.RenderTransform>
                            <ScaleTransform ScaleX="1" ScaleY="1"/>
                        </Border.RenderTransform>
                        <Border.Effect>
                            <DropShadowEffect BlurRadius="20" ShadowDepth="4" Opacity="0.15" Color="#000000"/>
                        </Border.Effect>
                        <Border.Triggers>
                            <EventTrigger RoutedEvent="Loaded">
                                <BeginStoryboard>
                                    <Storyboard>
                                        <DoubleAnimation Storyboard.TargetProperty="Opacity" From="0" To="1" Duration="0:0:0.4"/>
                                        <DoubleAnimation Storyboard.TargetProperty="(UIElement.RenderTransform).(ScaleTransform.ScaleX)"
                                                       From="0.95" To="1" Duration="0:0:0.4">
                                            <DoubleAnimation.EasingFunction>
                                                <QuadraticEase EasingMode="EaseOut"/>
                                            </DoubleAnimation.EasingFunction>
                                        </DoubleAnimation>
                                        <DoubleAnimation Storyboard.TargetProperty="(UIElement.RenderTransform).(ScaleTransform.ScaleY)"
                                                       From="0.95" To="1" Duration="0:0:0.4">
                                            <DoubleAnimation.EasingFunction>
                                                <QuadraticEase EasingMode="EaseOut"/>
                                            </DoubleAnimation.EasingFunction>
                                        </DoubleAnimation>
                                    </Storyboard>
                                </BeginStoryboard>
                            </EventTrigger>
                        </Border.Triggers>

                        <StackPanel>
                            <!-- Large Icon with Gradient Background -->
                            <Border Width="80" Height="80" CornerRadius="40" Margin="0,0,0,20"
                                    HorizontalAlignment="Center">
                                <Border.Background>
                                    <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                                        <GradientStop Color="{StaticResource ExpireWiseAccentDarkColor}" Offset="0"/>
                                        <GradientStop Color="{StaticResource ExpireWiseAccentColor}" Offset="0.5"/>
                                        <GradientStop Color="{StaticResource ExpireWiseAccentLightColor}" Offset="1"/>
                                    </LinearGradientBrush>
                                </Border.Background>
                                <Border.Effect>
                                    <DropShadowEffect BlurRadius="16" ShadowDepth="0" Opacity="0.3" Color="{StaticResource ExpireWiseAccentColor}"/>
                                </Border.Effect>
                                <TextBlock Text="ðŸ“…" FontSize="40" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                            </Border>

                            <!-- Heading -->
                            <TextBlock Text="Ready to Start Tracking?" FontSize="22" FontWeight="Bold"
                                       Foreground="{DynamicResource TextPrimaryBrush}"
                                       HorizontalAlignment="Center" Margin="0,0,0,8"/>

                            <!-- Description -->
                            <TextBlock FontSize="13" Foreground="{DynamicResource TextSecondaryBrush}"
                                       HorizontalAlignment="Center" TextAlignment="Center"
                                       Margin="0,0,0,28" MaxWidth="380" TextWrapping="Wrap" LineHeight="20">
                                <Run Text="Start monitoring your inventory expiration dates to reduce waste and stay ahead of critical items."/>
                            </TextBlock>

                            <!-- Primary & Secondary Actions -->
                            <StackPanel Orientation="Horizontal" HorizontalAlignment="Center" Margin="0,0,0,20">
                                <!-- Quick Add Button (Primary) -->
                                <Button Command="{Binding ShowQuickAddDialogCommand}" Style="{StaticResource PrimaryButton}"
                                        Padding="20,12" Margin="0,0,12,0">
                                    <StackPanel Orientation="Horizontal">
                                        <TextBlock Text="âš¡" FontSize="16" Margin="0,0,8,0"/>
                                        <TextBlock Text="Quick Add Item" FontSize="14" FontWeight="SemiBold"/>
                                    </StackPanel>
                                </Button>

                                <!-- Import Button (Secondary) -->
                                <Button Command="{Binding ImportExcelCommand}" Style="{StaticResource SecondaryButton}"
                                        Padding="20,12">
                                    <StackPanel Orientation="Horizontal">
                                        <TextBlock Text="ðŸ“¥" FontSize="16" Margin="0,0,8,0"/>
                                        <TextBlock Text="Import Data" FontSize="14" FontWeight="SemiBold"/>
                                    </StackPanel>
                                </Button>
                            </StackPanel>

                            <!-- Tips Section -->
                            <Border Background="{DynamicResource BackgroundBrush}"
                                    CornerRadius="10" Padding="20,16" Margin="0,0,0,0"
                                    BorderBrush="{DynamicResource BorderBrush}" BorderThickness="1">
                                <StackPanel>
                                    <StackPanel Orientation="Horizontal" Margin="0,0,0,12">
                                        <TextBlock Text="ðŸ’¡" FontSize="16" Margin="0,0,8,0"/>
                                        <TextBlock Text="Quick Tips" FontSize="13" FontWeight="SemiBold"
                                                   Foreground="{DynamicResource TextPrimaryBrush}"/>
                                    </StackPanel>

                                    <!-- Tip 1 -->
                                    <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                                        <Border Width="20" Height="20" CornerRadius="10"
                                                Background="{StaticResource ExpireWiseAccentBrush}" Opacity="0.15"
                                                Margin="0,0,8,0" VerticalAlignment="Top">
                                            <TextBlock Text="1" FontSize="10" FontWeight="Bold"
                                                       Foreground="{StaticResource ExpireWiseAccentBrush}"
                                                       HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                        </Border>
                                        <TextBlock FontSize="12" Foreground="{DynamicResource TextSecondaryBrush}" TextWrapping="Wrap">
                                            <Run Text="Use" FontWeight="SemiBold"/>
                                            <Run Text="Ctrl+N"/>
                                            <Run Text="to quickly add items with SKU validation"/>
                                        </TextBlock>
                                    </StackPanel>

                                    <!-- Tip 2 -->
                                    <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                                        <Border Width="20" Height="20" CornerRadius="10"
                                                Background="{StaticResource ExpireWiseAccentBrush}" Opacity="0.15"
                                                Margin="0,0,8,0" VerticalAlignment="Top">
                                            <TextBlock Text="2" FontSize="10" FontWeight="Bold"
                                                       Foreground="{StaticResource ExpireWiseAccentBrush}"
                                                       HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                        </Border>
                                        <TextBlock FontSize="12" Foreground="{DynamicResource TextSecondaryBrush}" TextWrapping="Wrap">
                                            <Run Text="Import bulk data from Excel or CSV files" FontWeight="SemiBold"/>
                                            <Run Text="(Ctrl+I)"/>
                                        </TextBlock>
                                    </StackPanel>

                                    <!-- Tip 3 -->
                                    <StackPanel Orientation="Horizontal">
                                        <Border Width="20" Height="20" CornerRadius="10"
                                                Background="{StaticResource ExpireWiseAccentBrush}" Opacity="0.15"
                                                Margin="0,0,8,0" VerticalAlignment="Top">
                                            <TextBlock Text="3" FontSize="10" FontWeight="Bold"
                                                       Foreground="{StaticResource ExpireWiseAccentBrush}"
                                                       HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                        </Border>
                                        <TextBlock FontSize="12" Foreground="{DynamicResource TextSecondaryBrush}" TextWrapping="Wrap">
                                            <Run Text="Track items across multiple locations" FontWeight="SemiBold"/>
                                            <Run Text="and monitor critical expiration alerts"/>
                                        </TextBlock>
                                    </StackPanel>
                                </StackPanel>
                            </Border>
                        </StackPanel>
                    </Border>
                    
                    <!-- Data Grid (visible when has data) - Wrapped in elevated card -->
                    <Border Visibility="{Binding HasData, Converter={StaticResource BooleanToVisibilityConverter}}"
                            Background="{DynamicResource SurfaceBrush}"
                            CornerRadius="12">
                        <Border.Effect>
                            <DropShadowEffect BlurRadius="20" ShadowDepth="4" Opacity="0.15"
                                              Color="#000000" Direction="270"/>
                        </Border.Effect>

                        <DataGrid x:Name="ItemsGrid" ItemsSource="{Binding ItemsView}"
                                  SelectedItem="{Binding SelectedItem}"
                                  SelectionMode="Extended" SelectionUnit="FullRow"
                                  SelectionChanged="OnItemsGridSelectionChanged"
                                  VirtualizingStackPanel.IsVirtualizing="True"
                                  VirtualizingStackPanel.VirtualizationMode="Recycling"
                                  EnableRowVirtualization="True"
                                  EnableColumnVirtualization="True"
                                  Style="{StaticResource ModernDataGrid}"
                                  ColumnHeaderStyle="{StaticResource ModernDataGridColumnHeader}"
                                  RowHeight="32"
                                  GridLinesVisibility="Horizontal"
                                  HorizontalGridLinesBrush="{DynamicResource BorderBrush}"
                                  AlternatingRowBackground="{DynamicResource SurfaceBrush}"
                                  AutomationProperties.Name="Expiration Items Table"
                                  AutomationProperties.HelpText="Table of items with expiration dates. Use arrow keys to navigate, Enter to edit, Delete to remove items.">
                            <DataGrid.InputBindings>
                                <MouseBinding MouseAction="LeftDoubleClick" Command="{Binding EditItemCommand}"/>
                            </DataGrid.InputBindings>
                            <DataGrid.ContextMenu>
                                <ContextMenu>
                                    <MenuItem Header="Edit Item" Command="{Binding EditItemCommand}">
                                        <MenuItem.Icon>
                                            <TextBlock Text="âœï¸" FontSize="14"/>
                                        </MenuItem.Icon>
                                    </MenuItem>
                                    <Separator/>
                                    <MenuItem Header="Delete" Command="{Binding DeleteSelectedCommand}">
                                        <MenuItem.Icon>
                                            <TextBlock Text="ðŸ—‘ï¸" FontSize="14"/>
                                        </MenuItem.Icon>
                                    </MenuItem>
                                    <Separator/>
                                    <MenuItem Header="Export to CSV" Command="{Binding ExportToCsvCommand}">
                                        <MenuItem.Icon>
                                            <TextBlock Text="ðŸ“„" FontSize="14"/>
                                        </MenuItem.Icon>
                                    </MenuItem>
                                    <MenuItem Header="Export to Excel" Command="{Binding ExportToExcelCommand}">
                                        <MenuItem.Icon>
                                            <TextBlock Text="ðŸ“Š" FontSize="14"/>
                                        </MenuItem.Icon>
                                    </MenuItem>
                                </ContextMenu>
                            </DataGrid.ContextMenu>

                            <!-- Compact Row Style -->
                            <DataGrid.RowStyle>
                                <Style TargetType="DataGridRow">
                                    <Setter Property="Background" Value="Transparent"/>
                                    <Setter Property="BorderThickness" Value="0"/>
                                    <Setter Property="Margin" Value="0"/>
                                    <Setter Property="Padding" Value="0"/>
                                    <Style.Triggers>
                                        <Trigger Property="IsSelected" Value="True">
                                            <Setter Property="Background">
                                                <Setter.Value>
                                                    <SolidColorBrush Color="{StaticResource ExpireWiseAccentColor}" Opacity="0.15"/>
                                                </Setter.Value>
                                            </Setter>
                                        </Trigger>
                                        <MultiTrigger>
                                            <MultiTrigger.Conditions>
                                                <Condition Property="IsMouseOver" Value="True"/>
                                                <Condition Property="IsSelected" Value="False"/>
                                            </MultiTrigger.Conditions>
                                            <Setter Property="Background" Value="{DynamicResource SurfaceHoverBrush}"/>
                                        </MultiTrigger>
                                    </Style.Triggers>
                                </Style>
                            </DataGrid.RowStyle>

                            <!-- Compact Cell Style -->
                            <DataGrid.CellStyle>
                                <Style TargetType="DataGridCell">
                                    <Setter Property="BorderThickness" Value="0"/>
                                    <Setter Property="Padding" Value="8,6"/>
                                    <Setter Property="FontSize" Value="12"/>
                                    <Setter Property="Foreground" Value="{DynamicResource TextPrimaryBrush}"/>
                                    <Setter Property="Template">
                                        <Setter.Value>
                                            <ControlTemplate TargetType="DataGridCell">
                                                <Border Padding="{TemplateBinding Padding}"
                                                        Background="{TemplateBinding Background}">
                                                    <ContentPresenter VerticalAlignment="Center"/>
                                                </Border>
                                            </ControlTemplate>
                                        </Setter.Value>
                                    </Setter>
                                    <Style.Triggers>
                                        <Trigger Property="IsSelected" Value="True">
                                            <Setter Property="Background" Value="Transparent"/>
                                            <Setter Property="Foreground" Value="{DynamicResource TextPrimaryBrush}"/>
                                        </Trigger>
                                    </Style.Triggers>
                                </Style>
                            </DataGrid.CellStyle>

                        <DataGrid.Columns>
                            <DataGridTextColumn Header="ITEM NUMBER" Binding="{Binding ItemNumber}" Width="90"/>
                            <DataGridTextColumn Header="DESCRIPTION" Binding="{Binding Description}" Width="*"/>
                            <DataGridTextColumn Header="STORE" Binding="{Binding Location, Converter={StaticResource StoreDisplayConverter}}" Width="140"/>
                            <DataGridTextColumn Header="QTY" Binding="{Binding Quantity}" Width="60"/>
                            <DataGridTemplateColumn Header="STATUS" Width="100">
                                <DataGridTemplateColumn.CellTemplate>
                                    <DataTemplate>
                                        <Border x:Name="StatusBadge" CornerRadius="10" Padding="10,4" HorizontalAlignment="Center"
                                                RenderTransformOrigin="0.5,0.5"
                                                ToolTip="{Binding StatusDescription}">
                                            <Border.RenderTransform>
                                                <ScaleTransform x:Name="StatusBadgeScale"/>
                                            </Border.RenderTransform>
                                            <Border.Effect>
                                                <DropShadowEffect x:Name="StatusBadgeShadow" BlurRadius="8" ShadowDepth="0" Opacity="0.4" Direction="270"/>
                                            </Border.Effect>
                                            <Border.Style>
                                                <Style TargetType="Border">
                                                    <!-- Good Status - Green Gradient -->
                                                    <Setter Property="Background">
                                                        <Setter.Value>
                                                            <LinearGradientBrush StartPoint="0,0" EndPoint="1,0">
                                                                <GradientStop Color="#059669" Offset="0"/>
                                                                <GradientStop Color="#10b981" Offset="1"/>
                                                            </LinearGradientBrush>
                                                        </Setter.Value>
                                                    </Setter>
                                                    <Style.Triggers>
                                                        <!-- Warning Status - Amber Gradient with Pulse -->
                                                        <DataTrigger Binding="{Binding Status}" Value="Warning">
                                                            <Setter Property="Background">
                                                                <Setter.Value>
                                                                    <LinearGradientBrush StartPoint="0,0" EndPoint="1,0">
                                                                        <GradientStop Color="#d97706" Offset="0"/>
                                                                        <GradientStop Color="#f59e0b" Offset="1"/>
                                                                    </LinearGradientBrush>
                                                                </Setter.Value>
                                                            </Setter>
                                                            <DataTrigger.EnterActions>
                                                                <BeginStoryboard>
                                                                    <Storyboard RepeatBehavior="Forever">
                                                                        <DoubleAnimation Storyboard.TargetProperty="Opacity"
                                                                                       From="1.0" To="0.85" Duration="0:0:2"
                                                                                       AutoReverse="True">
                                                                            <DoubleAnimation.EasingFunction>
                                                                                <SineEase EasingMode="EaseInOut"/>
                                                                            </DoubleAnimation.EasingFunction>
                                                                        </DoubleAnimation>
                                                                    </Storyboard>
                                                                </BeginStoryboard>
                                                            </DataTrigger.EnterActions>
                                                        </DataTrigger>
                                                        <!-- Critical Status - Red Gradient with Pulse -->
                                                        <DataTrigger Binding="{Binding Status}" Value="Critical">
                                                            <Setter Property="Background">
                                                                <Setter.Value>
                                                                    <LinearGradientBrush StartPoint="0,0" EndPoint="1,0">
                                                                        <GradientStop Color="#dc2626" Offset="0"/>
                                                                        <GradientStop Color="#ef4444" Offset="1"/>
                                                                    </LinearGradientBrush>
                                                                </Setter.Value>
                                                            </Setter>
                                                            <DataTrigger.EnterActions>
                                                                <BeginStoryboard>
                                                                    <Storyboard RepeatBehavior="Forever">
                                                                        <DoubleAnimation Storyboard.TargetProperty="Opacity"
                                                                                       From="1.0" To="0.7" Duration="0:0:1.5"
                                                                                       AutoReverse="True">
                                                                            <DoubleAnimation.EasingFunction>
                                                                                <SineEase EasingMode="EaseInOut"/>
                                                                            </DoubleAnimation.EasingFunction>
                                                                        </DoubleAnimation>
                                                                        <ColorAnimation Storyboard.TargetProperty="(Border.Effect).(DropShadowEffect.Color)"
                                                                                      From="#ef4444" To="#dc2626" Duration="0:0:1.5"
                                                                                      AutoReverse="True"/>
                                                                    </Storyboard>
                                                                </BeginStoryboard>
                                                            </DataTrigger.EnterActions>
                                                        </DataTrigger>
                                                        <!-- Expired Status - Gray Gradient -->
                                                        <DataTrigger Binding="{Binding Status}" Value="Expired">
                                                            <Setter Property="Background">
                                                                <Setter.Value>
                                                                    <LinearGradientBrush StartPoint="0,0" EndPoint="1,0">
                                                                        <GradientStop Color="#52525b" Offset="0"/>
                                                                        <GradientStop Color="#71717a" Offset="1"/>
                                                                    </LinearGradientBrush>
                                                                </Setter.Value>
                                                            </Setter>
                                                        </DataTrigger>
                                                        <!-- Hover Animation - Enhanced -->
                                                        <Trigger Property="IsMouseOver" Value="True">
                                                            <Trigger.EnterActions>
                                                                <BeginStoryboard>
                                                                    <Storyboard>
                                                                        <DoubleAnimation Storyboard.TargetProperty="(UIElement.RenderTransform).(ScaleTransform.ScaleX)"
                                                                                       To="1.08" Duration="0:0:0.2">
                                                                            <DoubleAnimation.EasingFunction>
                                                                                <CubicEase EasingMode="EaseOut"/>
                                                                            </DoubleAnimation.EasingFunction>
                                                                        </DoubleAnimation>
                                                                        <DoubleAnimation Storyboard.TargetProperty="(UIElement.RenderTransform).(ScaleTransform.ScaleY)"
                                                                                       To="1.08" Duration="0:0:0.2">
                                                                            <DoubleAnimation.EasingFunction>
                                                                                <CubicEase EasingMode="EaseOut"/>
                                                                            </DoubleAnimation.EasingFunction>
                                                                        </DoubleAnimation>
                                                                        <DoubleAnimation Storyboard.TargetProperty="(Border.Effect).(DropShadowEffect.BlurRadius)"
                                                                                       To="16" Duration="0:0:0.2"/>
                                                                        <DoubleAnimation Storyboard.TargetProperty="(Border.Effect).(DropShadowEffect.Opacity)"
                                                                                       To="0.5" Duration="0:0:0.2"/>
                                                                    </Storyboard>
                                                                </BeginStoryboard>
                                                            </Trigger.EnterActions>
                                                            <Trigger.ExitActions>
                                                                <BeginStoryboard>
                                                                    <Storyboard>
                                                                        <DoubleAnimation Storyboard.TargetProperty="(UIElement.RenderTransform).(ScaleTransform.ScaleX)"
                                                                                       To="1.0" Duration="0:0:0.2">
                                                                            <DoubleAnimation.EasingFunction>
                                                                                <CubicEase EasingMode="EaseOut"/>
                                                                            </DoubleAnimation.EasingFunction>
                                                                        </DoubleAnimation>
                                                                        <DoubleAnimation Storyboard.TargetProperty="(UIElement.RenderTransform).(ScaleTransform.ScaleY)"
                                                                                       To="1.0" Duration="0:0:0.2">
                                                                            <DoubleAnimation.EasingFunction>
                                                                                <CubicEase EasingMode="EaseOut"/>
                                                                            </DoubleAnimation.EasingFunction>
                                                                        </DoubleAnimation>
                                                                        <DoubleAnimation Storyboard.TargetProperty="(Border.Effect).(DropShadowEffect.BlurRadius)"
                                                                                       To="8" Duration="0:0:0.2"/>
                                                                        <DoubleAnimation Storyboard.TargetProperty="(Border.Effect).(DropShadowEffect.Opacity)"
                                                                                       To="0.4" Duration="0:0:0.2"/>
                                                                    </Storyboard>
                                                                </BeginStoryboard>
                                                            </Trigger.ExitActions>
                                                        </Trigger>
                                                    </Style.Triggers>
                                                </Style>
                                            </Border.Style>
                                            <StackPanel Orientation="Horizontal">
                                                <TextBlock FontSize="11" Margin="0,0,4,0">
                                                    <TextBlock.Style>
                                                        <Style TargetType="TextBlock">
                                                            <Setter Property="Text" Value="âœ…"/>
                                                            <Style.Triggers>
                                                                <DataTrigger Binding="{Binding Status}" Value="Warning">
                                                                    <Setter Property="Text" Value="âš ï¸"/>
                                                                </DataTrigger>
                                                                <DataTrigger Binding="{Binding Status}" Value="Critical">
                                                                    <Setter Property="Text" Value="ðŸš¨"/>
                                                                </DataTrigger>
                                                                <DataTrigger Binding="{Binding Status}" Value="Expired">
                                                                    <Setter Property="Text" Value="â±ï¸"/>
                                                                </DataTrigger>
                                                            </Style.Triggers>
                                                        </Style>
                                                    </TextBlock.Style>
                                                </TextBlock>
                                                <TextBlock Text="{Binding Status}" FontWeight="SemiBold"
                                                           Foreground="{DynamicResource TextOnPrimaryBrush}" FontSize="11"/>
                                            </StackPanel>
                                        </Border>
                                    </DataTemplate>
                                </DataGridTemplateColumn.CellTemplate>
                            </DataGridTemplateColumn>
                        </DataGrid.Columns>

                        <DataGrid.GroupStyle>
                            <GroupStyle>
                                <GroupStyle.ContainerStyle>
                                    <Style TargetType="{x:Type GroupItem}">
                                        <Setter Property="Margin" Value="0,6,0,0"/>
                                        <Setter Property="Template">
                                            <Setter.Value>
                                                <ControlTemplate TargetType="{x:Type GroupItem}">
                                                    <Border Background="{DynamicResource SurfaceBrush}" CornerRadius="8"
                                                            BorderBrush="{DynamicResource SurfaceHoverBrush}" BorderThickness="1"
                                                            Margin="0,0,0,2">
                                                        <Expander IsExpanded="True" Background="Transparent" BorderThickness="0">
                                                            <Expander.Header>
                                                                <Grid Margin="6,4" Height="20">
                                                                    <Grid.ColumnDefinitions>
                                                                        <ColumnDefinition Width="Auto"/>
                                                                        <ColumnDefinition Width="*"/>
                                                                        <ColumnDefinition Width="Auto"/>
                                                                    </Grid.ColumnDefinitions>

                                                                    <Border Grid.Column="0" Background="{StaticResource ExpireWiseAccentBrush}"
                                                                            CornerRadius="6" Width="20" Height="20" Margin="0,0,8,0">
                                                                        <TextBlock Text="ðŸ“" FontSize="10" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                                                    </Border>

                                                                    <TextBlock Grid.Column="1"
                                                                               Text="{Binding Name, Converter={StaticResource StoreDisplayConverter}}"
                                                                               FontWeight="SemiBold" FontSize="12"
                                                                               Foreground="{StaticResource ExpireWiseAccentLightBrush}"
                                                                               VerticalAlignment="Center"/>

                                                                    <Border Grid.Column="2" Background="{DynamicResource SurfaceHoverBrush}"
                                                                            CornerRadius="8" Padding="8,2" Margin="8,0,0,0">
                                                                        <TextBlock VerticalAlignment="Center" FontSize="11">
                                                                            <Run Text="{Binding ItemCount, Mode=OneWay}" FontWeight="SemiBold"
                                                                                 Foreground="{DynamicResource TextPrimaryBrush}"/>
                                                                            <Run Text=" items" Foreground="{DynamicResource TextSecondaryBrush}"/>
                                                                        </TextBlock>
                                                                    </Border>
                                                                </Grid>
                                                            </Expander.Header>
                                                            <ItemsPresenter Margin="0,0,0,4"/>
                                                        </Expander>
                                                    </Border>
                                                </ControlTemplate>
                                            </Setter.Value>
                                        </Setter>
                                    </Style>
                                </GroupStyle.ContainerStyle>
                                <GroupStyle.Panel>
                                    <ItemsPanelTemplate>
                                        <DataGridRowsPresenter/>
                                    </ItemsPanelTemplate>
                                </GroupStyle.Panel>
                            </GroupStyle>
                        </DataGrid.GroupStyle>
                    </DataGrid>
                </Border>
                </Grid>

                <!-- Status Bar -->
                <Border Grid.Row="2" Background="{DynamicResource SurfaceBrush}" Padding="20,12">
                    <Grid>
                        <TextBlock Text="{Binding StatusMessage}" Foreground="{DynamicResource TextSecondaryBrush}" FontSize="12"/>
                        <StackPanel Orientation="Horizontal" HorizontalAlignment="Right"
                                    Visibility="{Binding IsLoading, Converter={StaticResource BooleanToVisibilityConverter}}">
                            <TextBlock Text="â³" FontSize="12" Margin="0,0,8,0"/>
                            <TextBlock Text="Loading..." Foreground="{DynamicResource TextSecondaryBrush}" FontSize="12"/>
                        </StackPanel>
                    </Grid>
                </Border>
                </Grid>
            </Border>

            <!-- Analytics View with Transition -->
            <Border Visibility="{Binding SelectedViewIndex, Converter={StaticResource IntToVisibilityConverter}, ConverterParameter=2}"
                    Opacity="0" RenderTransformOrigin="0.5,0.5">
                <Border.RenderTransform>
                    <TranslateTransform X="0" Y="20"/>
                </Border.RenderTransform>
                <Border.Triggers>
                    <EventTrigger RoutedEvent="Border.Loaded">
                        <BeginStoryboard>
                            <Storyboard>
                                <DoubleAnimation Storyboard.TargetProperty="Opacity"
                                               From="0" To="1" Duration="0:0:0.3">
                                    <DoubleAnimation.EasingFunction>
                                        <QuadraticEase EasingMode="EaseOut"/>
                                    </DoubleAnimation.EasingFunction>
                                </DoubleAnimation>
                                <DoubleAnimation Storyboard.TargetProperty="(UIElement.RenderTransform).(TranslateTransform.Y)"
                                               From="20" To="0" Duration="0:0:0.4">
                                    <DoubleAnimation.EasingFunction>
                                        <QuadraticEase EasingMode="EaseOut"/>
                                    </DoubleAnimation.EasingFunction>
                                </DoubleAnimation>
                            </Storyboard>
                        </BeginStoryboard>
                    </EventTrigger>
                </Border.Triggers>
                <local:ExpireWiseAnalyticsView DataContext="{Binding Analytics}"/>
            </Border>

                <!-- Quick Add Panel Overlay (Slide-out from left) -->
                    <Border x:Name="QuickAddOverlay"
                    Grid.RowSpan="5"
                    Panel.ZIndex="100"
                        HorizontalAlignment="Left"
                        Width="420"
                    Background="{DynamicResource SurfaceBrush}"
                    BorderBrush="{DynamicResource BorderBrush}"
                    BorderThickness="0,0,1,0"
                    Visibility="{Binding QuickAddExpanded, Converter={StaticResource BooleanToVisibilityConverter}}">
                <Border.Effect>
                    <DropShadowEffect Color="Black" Opacity="0.3" BlurRadius="20" ShadowDepth="0"/>
                </Border.Effect>
                <Border.RenderTransform>
                    <TranslateTransform X="0"/>
                </Border.RenderTransform>
                <Border.Style>
                    <Style TargetType="Border">
                        <Style.Triggers>
                            <DataTrigger Binding="{Binding QuickAddExpanded}" Value="True">
                                <DataTrigger.EnterActions>
                                    <BeginStoryboard>
                                        <Storyboard>
                                            <DoubleAnimation Storyboard.TargetProperty="RenderTransform.(TranslateTransform.X)"
                                                            From="-520" To="0" Duration="0:0:0.28">
                                                <DoubleAnimation.EasingFunction>
                                                    <CubicEase EasingMode="EaseOut"/>
                                                </DoubleAnimation.EasingFunction>
                                            </DoubleAnimation>
                                        </Storyboard>
                                    </BeginStoryboard>
                                </DataTrigger.EnterActions>
                                <DataTrigger.ExitActions>
                                    <BeginStoryboard>
                                        <Storyboard>
                                            <DoubleAnimation Storyboard.TargetProperty="RenderTransform.(TranslateTransform.X)"
                                                            To="-520" Duration="0:0:0.22">
                                                <DoubleAnimation.EasingFunction>
                                                    <CubicEase EasingMode="EaseIn"/>
                                                </DoubleAnimation.EasingFunction>
                                            </DoubleAnimation>
                                        </Storyboard>
                                    </BeginStoryboard>
                                </DataTrigger.ExitActions>
                            </DataTrigger>
                        </Style.Triggers>
                    </Style>
                </Border.Style>

                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <!-- Header -->
                    <Border Grid.Row="0" Background="{DynamicResource BackgroundBrush}" Padding="20,16" BorderBrush="{DynamicResource BorderBrush}" BorderThickness="0,0,0,1">
                        <Grid>
                            <StackPanel>
                                <TextBlock Text="Quick Add" FontSize="16" FontWeight="SemiBold" Foreground="{DynamicResource TextPrimaryBrush}"/>
                                <TextBlock Text="Fast single-item entry" FontSize="11" Foreground="{DynamicResource TextTertiaryBrush}" Margin="0,2,0,0"/>
                            </StackPanel>
                            <Button Content="X"
                                    Command="{Binding ToggleQuickAddCommand}"
                                    HorizontalAlignment="Right"
                                    Style="{StaticResource IconButton}"
                                    Width="32" Height="32"
                                    FontSize="16"
                                    ToolTip="Close (Ctrl+N)"/>
                        </Grid>
                    </Border>

                    <!-- Content -->
                    <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto">
                        <views:QuickAddPanel x:Name="QuickAddPanel" Margin="0"/>
                    </ScrollViewer>
                </Grid>
            </Border>
        </Grid>

        <!-- Loading Overlay -->
        <Border Grid.ColumnSpan="2"
                Visibility="{Binding IsBusy, Converter={StaticResource BooleanToVisibilityConverter}}"
                Background="#CC000000"
                HorizontalAlignment="Stretch"
                VerticalAlignment="Stretch">
            <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center">
                <Border Background="{DynamicResource SurfaceBrush}"
                        CornerRadius="16"
                        Padding="40,32"
                        MinWidth="250">
                    <StackPanel>
                        <!-- Spinner Animation -->
                        <Border Width="48" Height="48" Margin="0,0,0,20" HorizontalAlignment="Center">
                            <Border.RenderTransform>
                                <RotateTransform x:Name="SpinnerRotate" CenterX="24" CenterY="24"/>
                            </Border.RenderTransform>
                            <Border.Triggers>
                                <EventTrigger RoutedEvent="Loaded">
                                    <BeginStoryboard>
                                        <Storyboard>
                                            <DoubleAnimation Storyboard.TargetProperty="RenderTransform.(RotateTransform.Angle)"
                                                           From="0" To="360" Duration="0:0:1.5" RepeatBehavior="Forever"/>
                                        </Storyboard>
                                    </BeginStoryboard>
                                </EventTrigger>
                            </Border.Triggers>
                            <Border.Background>
                                <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                                    <GradientStop Color="{StaticResource ExpireWiseAccentColor}" Offset="0"/>
                                    <GradientStop Color="{StaticResource ExpireWiseAccentLightColor}" Offset="0.5"/>
                                    <GradientStop Color="Transparent" Offset="0.5"/>
                                    <GradientStop Color="Transparent" Offset="1"/>
                                </LinearGradientBrush>
                            </Border.Background>
                            <Border.OpacityMask>
                                <RadialGradientBrush>
                                    <GradientStop Color="Transparent" Offset="0.5"/>
                                    <GradientStop Color="Black" Offset="0.75"/>
                                    <GradientStop Color="Black" Offset="1"/>
                                </RadialGradientBrush>
                            </Border.OpacityMask>
                        </Border>

                        <!-- Loading Message -->
                        <TextBlock Text="{Binding BusyMessage}"
                                   FontSize="16"
                                   FontWeight="SemiBold"
                                   Foreground="{DynamicResource TextPrimaryBrush}"
                                   HorizontalAlignment="Center"
                                   TextAlignment="Center"
                                   TextWrapping="Wrap"/>
                    </StackPanel>
                </Border>
            </StackPanel>
        </Border>
    </Grid>
    </Grid>
</UserControl>
