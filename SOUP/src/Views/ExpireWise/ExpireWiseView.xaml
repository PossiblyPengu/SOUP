<UserControl x:Class="SOUP.Views.ExpireWise.ExpireWiseView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:vm="clr-namespace:SOUP.ViewModels"
             xmlns:local="clr-namespace:SOUP.Views.ExpireWise"
             xmlns:views="clr-namespace:SOUP.Features.ExpireWise.Views"
             xmlns:converters="clr-namespace:SOUP.Converters"
             mc:Ignorable="d"
             d:DesignHeight="800" d:DesignWidth="1200"
             d:DataContext="{d:DesignInstance Type=vm:ExpireWiseViewModel}"
             Focusable="True">

    <!-- Keyboard Shortcuts -->
    <UserControl.InputBindings>
        <!-- Quick Actions -->
        <KeyBinding Key="N" Modifiers="Ctrl" Command="{Binding ToggleQuickAddCommand}"/>
        <KeyBinding Key="I" Modifiers="Ctrl" Command="{Binding ImportFromExcelCommand}"/>
        <KeyBinding Key="E" Modifiers="Ctrl" Command="{Binding ExportToCsvCommand}"/>
        <KeyBinding Key="F" Modifiers="Ctrl" Command="{Binding FocusSearchCommand}"/>

        <!-- Item Actions -->
        <KeyBinding Key="Return" Modifiers="Ctrl" Command="{Binding EditItemCommand}"/>
        <KeyBinding Key="Delete" Command="{Binding DeleteSelectedCommand}"/>

        <!-- Month Navigation -->
        <KeyBinding Key="Left" Modifiers="Ctrl" Command="{Binding PreviousMonthCommand}"/>
        <KeyBinding Key="Right" Modifiers="Ctrl" Command="{Binding NextMonthCommand}"/>

        <!-- Refresh -->
        <KeyBinding Key="R" Modifiers="Ctrl" Command="{Binding LoadItemsCommand}"/>
    </UserControl.InputBindings>

    <UserControl.Resources>
        <local:StoreDisplayConverter x:Key="StoreDisplayConverter"/>
        <converters:IntToBoolConverter x:Key="IntToBoolConverter"/>
        <converters:IntToVisibilityConverter x:Key="IntToVisibilityConverter"/>
        <converters:BoolToSidebarWidthConverter x:Key="BoolToSidebarWidthConverter"/>
        <converters:MonthYearGroupConverter x:Key="MonthYearGroupConverter"/>
        <converters:BoolToArchiveIconConverter x:Key="BoolToArchiveIconConverter"/>
        <!-- CollectionView now managed in ViewModel for better performance -->
        <CollectionViewSource x:Key="GroupedItemsView" Source="{Binding FilteredItems}"/>

        <!-- Custom Keyboard Focus Visual Style -->
        <Style x:Key="KeyboardFocusVisual">
            <Setter Property="Control.Template">
                <Setter.Value>
                    <ControlTemplate>
                        <Rectangle Stroke="#f59e0b" StrokeThickness="2" StrokeDashArray="2 2"
                                   SnapsToDevicePixels="True" RadiusX="4" RadiusY="4"/>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- ExpireWise Accent Colors (Amber/Orange theme - matches launcher) -->
        <Color x:Key="ExpireWiseAccentColor">#f59e0b</Color>
        <Color x:Key="ExpireWiseAccentLightColor">#fbbf24</Color>
        <Color x:Key="ExpireWiseAccentDarkColor">#d97706</Color>
        <SolidColorBrush x:Key="ExpireWiseAccentBrush" Color="{StaticResource ExpireWiseAccentColor}"/>
        <SolidColorBrush x:Key="ExpireWiseAccentLightBrush" Color="{StaticResource ExpireWiseAccentLightColor}"/>
        <SolidColorBrush x:Key="ExpireWiseAccentDarkBrush" Color="{StaticResource ExpireWiseAccentDarkColor}"/>
        
        <!-- Sidebar Navigation RadioButton Style -->
        <Style x:Key="SidebarNavButton" TargetType="RadioButton">
            <Setter Property="Foreground" Value="{DynamicResource TextSecondaryBrush}"/>
            <Setter Property="FontSize" Value="13"/>
            <Setter Property="FontWeight" Value="Medium"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Padding" Value="16,12"/>
            <Setter Property="Margin" Value="8,2"/>
            <Setter Property="FocusVisualStyle" Value="{x:Null}"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="RadioButton">
                        <Border x:Name="Bg" Background="Transparent" CornerRadius="10"
                                Padding="{TemplateBinding Padding}">
                            <ContentPresenter VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="Bg" Property="Background" Value="{DynamicResource SurfaceHoverBrush}"/>
                            </Trigger>
                            <Trigger Property="IsChecked" Value="True">
                                <Setter TargetName="Bg" Property="Background" Value="{DynamicResource SidebarActiveBrush}"/>
                                <Setter Property="Foreground" Value="{StaticResource ExpireWiseAccentLightBrush}"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
        
        <!-- Sidebar Action Button Style -->
        <Style x:Key="SidebarActionButton" TargetType="Button">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="Foreground" Value="{DynamicResource TextSecondaryBrush}"/>
            <Setter Property="FontSize" Value="13"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Padding" Value="16,12"/>
            <Setter Property="Margin" Value="8,2"/>
            <Setter Property="HorizontalContentAlignment" Value="Left"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="FocusVisualStyle" Value="{x:Null}"/>
            <Setter Property="Focusable" Value="False"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border x:Name="Bg" Background="{TemplateBinding Background}" CornerRadius="10"
                                Padding="{TemplateBinding Padding}">
                            <ContentPresenter VerticalAlignment="Center" HorizontalAlignment="{TemplateBinding HorizontalContentAlignment}"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="Bg" Property="Background" Value="{DynamicResource SurfaceHoverBrush}"/>
                            </Trigger>
                            <Trigger Property="IsPressed" Value="True">
                                <Setter TargetName="Bg" Property="Background" Value="{DynamicResource SidebarActiveBrush}"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Top Navigation Tab Style (for Dashboard/Inventory/Analytics) -->
        <Style x:Key="TopNavTabStyle" TargetType="RadioButton">
            <Setter Property="Foreground" Value="{DynamicResource TextSecondaryBrush}"/>
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="FontWeight" Value="Medium"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Padding" Value="20,0"/>
            <Setter Property="Margin" Value="0,0,8,0"/>
            <Setter Property="Height" Value="64"/>
            <Setter Property="FocusVisualStyle" Value="{x:Null}"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="RadioButton">
                        <Grid>
                            <ContentPresenter x:Name="Content" VerticalAlignment="Center" HorizontalAlignment="Center"
                                              RenderTransformOrigin="0.5,0.5">
                                <ContentPresenter.RenderTransform>
                                    <TranslateTransform Y="0"/>
                                </ContentPresenter.RenderTransform>
                            </ContentPresenter>
                            <!-- Active underline with enhanced thickness and animation -->
                            <Border x:Name="ActiveLine" Height="3" VerticalAlignment="Bottom"
                                    Background="{StaticResource ExpireWiseAccentBrush}"
                                    CornerRadius="2,2,0,0" Opacity="0"
                                    RenderTransformOrigin="0.5,0.5">
                                <Border.RenderTransform>
                                    <ScaleTransform ScaleX="0.8" ScaleY="1"/>
                                </Border.RenderTransform>
                            </Border>
                        </Grid>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="Foreground" Value="{DynamicResource TextPrimaryBrush}"/>
                                <Trigger.EnterActions>
                                    <BeginStoryboard>
                                        <Storyboard>
                                            <DoubleAnimation Storyboard.TargetName="ActiveLine"
                                                           Storyboard.TargetProperty="Opacity"
                                                           To="0.5" Duration="0:0:0.2"/>
                                            <DoubleAnimation Storyboard.TargetName="ActiveLine"
                                                           Storyboard.TargetProperty="(UIElement.RenderTransform).(ScaleTransform.ScaleX)"
                                                           To="0.9" Duration="0:0:0.2">
                                                <DoubleAnimation.EasingFunction>
                                                    <CubicEase EasingMode="EaseOut"/>
                                                </DoubleAnimation.EasingFunction>
                                            </DoubleAnimation>
                                            <DoubleAnimation Storyboard.TargetName="Content"
                                                           Storyboard.TargetProperty="(UIElement.RenderTransform).(TranslateTransform.Y)"
                                                           To="-2" Duration="0:0:0.2">
                                                <DoubleAnimation.EasingFunction>
                                                    <CubicEase EasingMode="EaseOut"/>
                                                </DoubleAnimation.EasingFunction>
                                            </DoubleAnimation>
                                        </Storyboard>
                                    </BeginStoryboard>
                                </Trigger.EnterActions>
                                <Trigger.ExitActions>
                                    <BeginStoryboard>
                                        <Storyboard>
                                            <DoubleAnimation Storyboard.TargetName="ActiveLine"
                                                           Storyboard.TargetProperty="Opacity"
                                                           To="0" Duration="0:0:0.2"/>
                                            <DoubleAnimation Storyboard.TargetName="ActiveLine"
                                                           Storyboard.TargetProperty="(UIElement.RenderTransform).(ScaleTransform.ScaleX)"
                                                           To="0.8" Duration="0:0:0.2">
                                                <DoubleAnimation.EasingFunction>
                                                    <CubicEase EasingMode="EaseOut"/>
                                                </DoubleAnimation.EasingFunction>
                                            </DoubleAnimation>
                                            <DoubleAnimation Storyboard.TargetName="Content"
                                                           Storyboard.TargetProperty="(UIElement.RenderTransform).(TranslateTransform.Y)"
                                                           To="0" Duration="0:0:0.2">
                                                <DoubleAnimation.EasingFunction>
                                                    <CubicEase EasingMode="EaseOut"/>
                                                </DoubleAnimation.EasingFunction>
                                            </DoubleAnimation>
                                        </Storyboard>
                                    </BeginStoryboard>
                                </Trigger.ExitActions>
                            </Trigger>
                            <Trigger Property="IsChecked" Value="True">
                                <Setter Property="Foreground" Value="{StaticResource ExpireWiseAccentLightBrush}"/>
                                <Setter TargetName="ActiveLine" Property="Opacity" Value="1"/>
                                <Setter TargetName="ActiveLine" Property="RenderTransform">
                                    <Setter.Value>
                                        <ScaleTransform ScaleX="1" ScaleY="1"/>
                                    </Setter.Value>
                                </Setter>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Month Expander Style -->
        <Style x:Key="MonthExpanderStyle" TargetType="Expander">
            <Setter Property="IsExpanded" Value="True"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Expander">
                        <StackPanel>
                            <ToggleButton IsChecked="{Binding Path=IsExpanded, Mode=TwoWay, RelativeSource={RelativeSource TemplatedParent}}"
                                          Background="Transparent"
                                          BorderThickness="0"
                                          Cursor="Hand">
                                <ToggleButton.Template>
                                    <ControlTemplate TargetType="ToggleButton">
                                        <ContentPresenter/>
                                    </ControlTemplate>
                                </ToggleButton.Template>
                                <ContentPresenter Content="{TemplateBinding Header}"/>
                            </ToggleButton>
                            <ContentPresenter x:Name="Content" Visibility="Collapsed"/>
                        </StackPanel>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsExpanded" Value="True">
                                <Setter TargetName="Content" Property="Visibility" Value="Visible"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
        
        <!-- Modern DataGrid Style -->
        <Style x:Key="ModernDataGrid" TargetType="DataGrid">
            <Setter Property="Background" Value="{DynamicResource SurfaceBrush}"/>
            <Setter Property="Foreground" Value="{DynamicResource TextPrimaryBrush}"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="RowHeaderWidth" Value="0"/>
            <Setter Property="AutoGenerateColumns" Value="False"/>
            <Setter Property="CanUserAddRows" Value="False"/>
            <Setter Property="CanUserDeleteRows" Value="False"/>
            <Setter Property="CanUserResizeRows" Value="False"/>
            <Setter Property="GridLinesVisibility" Value="None"/>
            <Setter Property="HeadersVisibility" Value="Column"/>
            <Setter Property="HorizontalScrollBarVisibility" Value="Auto"/>
            <Setter Property="VerticalScrollBarVisibility" Value="Auto"/>
        </Style>
        
        <!-- Modern DataGrid Column Header Style -->
        <Style x:Key="ModernDataGridColumnHeader" TargetType="DataGridColumnHeader">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="Foreground" Value="{DynamicResource TextSecondaryBrush}"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="FontSize" Value="11"/>
            <Setter Property="Padding" Value="12,16"/>
            <Setter Property="BorderThickness" Value="0,0,0,1"/>
            <Setter Property="BorderBrush" Value="{DynamicResource SurfaceHoverBrush}"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="DataGridColumnHeader">
                        <Border Background="{TemplateBinding Background}" 
                                BorderBrush="{TemplateBinding BorderBrush}"
                                BorderThickness="{TemplateBinding BorderThickness}"
                                Padding="{TemplateBinding Padding}">
                            <ContentPresenter HorizontalAlignment="{TemplateBinding HorizontalContentAlignment}"
                                              VerticalAlignment="Center"/>
                        </Border>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
        
        <!-- Modern DataGrid Cell Style -->
        <Style x:Key="ModernDataGridCell" TargetType="DataGridCell">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="Foreground" Value="{DynamicResource TextPrimaryBrush}"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Padding" Value="12,14"/>
            <Setter Property="FontSize" Value="13"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="DataGridCell">
                        <Border Background="{TemplateBinding Background}" 
                                Padding="{TemplateBinding Padding}">
                            <ContentPresenter VerticalAlignment="Center"/>
                        </Border>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
            <Style.Triggers>
                <Trigger Property="IsSelected" Value="True">
                    <Setter Property="Background" Value="{DynamicResource SidebarActiveBrush}"/>
                    <Setter Property="Foreground" Value="{StaticResource ExpireWiseAccentLightBrush}"/>
                </Trigger>
            </Style.Triggers>
        </Style>
        
        <!-- Modern DataGrid Row Style with animations -->
        <Style x:Key="ModernDataGridRow" TargetType="DataGridRow">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="Margin" Value="0,1"/>
            <Setter Property="RenderTransformOrigin" Value="0,0.5"/>
            <Setter Property="RenderTransform">
                <Setter.Value>
                    <TranslateTransform X="0"/>
                </Setter.Value>
            </Setter>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="DataGridRow">
                        <Border x:Name="RowBorder" 
                                Background="{TemplateBinding Background}" 
                                CornerRadius="8"
                                Margin="4,2">
                            <SelectiveScrollingGrid>
                                <SelectiveScrollingGrid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="*"/>
                                </SelectiveScrollingGrid.ColumnDefinitions>
                                <SelectiveScrollingGrid.RowDefinitions>
                                    <RowDefinition Height="*"/>
                                    <RowDefinition Height="Auto"/>
                                </SelectiveScrollingGrid.RowDefinitions>
                                <DataGridCellsPresenter Grid.Column="1" ItemsPanel="{TemplateBinding ItemsPanel}"
                                                        SnapsToDevicePixels="{TemplateBinding SnapsToDevicePixels}"/>
                                <DataGridDetailsPresenter Grid.Column="1" Grid.Row="1"
                                                          Visibility="{TemplateBinding DetailsVisibility}"
                                                          SelectiveScrollingGrid.SelectiveScrollingOrientation="Both"/>
                            </SelectiveScrollingGrid>
                        </Border>
                        <ControlTemplate.Triggers>
                            <EventTrigger RoutedEvent="MouseEnter">
                                <BeginStoryboard>
                                    <Storyboard>
                                        <DoubleAnimation Storyboard.TargetProperty="RenderTransform.X" To="4" Duration="0:0:0.15">
                                            <DoubleAnimation.EasingFunction><QuadraticEase EasingMode="EaseOut"/></DoubleAnimation.EasingFunction>
                                        </DoubleAnimation>
                                    </Storyboard>
                                </BeginStoryboard>
                            </EventTrigger>
                            <EventTrigger RoutedEvent="MouseLeave">
                                <BeginStoryboard>
                                    <Storyboard>
                                        <DoubleAnimation Storyboard.TargetProperty="RenderTransform.X" To="0" Duration="0:0:0.2">
                                            <DoubleAnimation.EasingFunction><QuadraticEase EasingMode="EaseOut"/></DoubleAnimation.EasingFunction>
                                        </DoubleAnimation>
                                    </Storyboard>
                                </BeginStoryboard>
                            </EventTrigger>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="RowBorder" Property="Background" Value="{DynamicResource SurfaceHoverBrush}"/>
                            </Trigger>
                            <Trigger Property="IsSelected" Value="True">
                                <Setter TargetName="RowBorder" Property="Background" Value="{DynamicResource SidebarActiveBrush}"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
    </UserControl.Resources>

    <!-- Clean, Simple Full-Width Layout with Timeline View -->
    <Grid Background="{DynamicResource BackgroundBrush}">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/> <!-- Header with Month Nav -->
            <RowDefinition Height="Auto"/> <!-- Stats Bar -->
            <RowDefinition Height="*"/> <!-- Timeline Content -->
        </Grid.RowDefinitions>

        <!-- Compact Header Bar -->
        <Border Grid.Row="0" Background="{DynamicResource SurfaceBrush}" 
                Padding="32,20">
            <Border.Effect>
                <DropShadowEffect BlurRadius="16" ShadowDepth="2" Opacity="0.08" Direction="270"/>
            </Border.Effect>
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <!-- Logo + Title -->
                <StackPanel Grid.Column="0" Orientation="Horizontal" VerticalAlignment="Center">
                    <Border Width="48" Height="48" CornerRadius="12" Margin="0,0,16,0">
                        <Border.Background>
                            <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                                <GradientStop Color="{StaticResource ExpireWiseAccentColor}" Offset="0"/>
                                <GradientStop Color="{StaticResource ExpireWiseAccentLightColor}" Offset="1"/>
                            </LinearGradientBrush>
                        </Border.Background>
                        <Border.Effect>
                            <DropShadowEffect BlurRadius="12" ShadowDepth="0" Opacity="0.3" Color="{StaticResource ExpireWiseAccentColor}"/>
                        </Border.Effect>
                        <TextBlock Text="ðŸ“…" FontSize="24" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                    </Border>
                    <StackPanel VerticalAlignment="Center">
                        <TextBlock Text="ExpireWise" FontSize="20" FontWeight="Bold" Foreground="{DynamicResource TextPrimaryBrush}"/>
                        <TextBlock Text="Store Timeline" FontSize="11" Foreground="{DynamicResource TextTertiaryBrush}"/>
                    </StackPanel>
                </StackPanel>

                <!-- Store Selector (Center) -->
                <StackPanel Grid.Column="1" Orientation="Horizontal" HorizontalAlignment="Center" VerticalAlignment="Center">
                    <Border CornerRadius="16" Padding="20,12" MinWidth="320">
                        <Border.Background>
                            <LinearGradientBrush StartPoint="0,0" EndPoint="1,0">
                                <GradientStop Color="{StaticResource ExpireWiseAccentColor}" Offset="0"/>
                                <GradientStop Color="{StaticResource ExpireWiseAccentLightColor}" Offset="1"/>
                            </LinearGradientBrush>
                        </Border.Background>
                        <Border.Effect>
                            <DropShadowEffect BlurRadius="20" ShadowDepth="4" Opacity="0.25" Color="{StaticResource ExpireWiseAccentColor}"/>
                        </Border.Effect>
                        <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                            <TextBlock Text="ðŸª" FontSize="16" Margin="0,0,12,0" VerticalAlignment="Center"/>
                            <ComboBox ItemsSource="{Binding AvailableStoreNames}"
                                      SelectedItem="{Binding SelectedStore}"
                                      MinWidth="200"
                                      Foreground="White"
                                      FontSize="16"
                                      FontWeight="Bold"
                                      VerticalAlignment="Center"
                                      Background="Transparent"
                                      BorderThickness="0">
                                <ComboBox.ItemContainerStyle>
                                    <Style TargetType="ComboBoxItem">
                                        <Setter Property="Foreground" Value="{DynamicResource TextPrimaryBrush}"/>
                                        <Setter Property="Background" Value="{DynamicResource BackgroundBrush}"/>
                                        <Setter Property="Padding" Value="12,8"/>
                                    </Style>
                                </ComboBox.ItemContainerStyle>
                            </ComboBox>
                        </StackPanel>
                    </Border>
                </StackPanel>

                <!-- Actions -->
                <StackPanel Grid.Column="2" Orientation="Horizontal" VerticalAlignment="Center">
                    <Button Command="{Binding ShowQuickAddDialogCommand}" 
                            Style="{StaticResource PrimaryButton}" 
                            Padding="20,10" Margin="0,0,12,0">
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Text="âš¡" FontSize="16" Margin="0,0,8,0"/>
                            <TextBlock Text="Quick Add" FontSize="13" FontWeight="SemiBold"/>
                        </StackPanel>
                    </Button>
                    <Button Command="{Binding ArchiveExpiredItemsCommand}" 
                            Style="{StaticResource SecondaryButton}" 
                            Padding="16,10" Margin="0,0,12,0"
                            ToolTip="Archive expired items for current store">
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Text="ðŸ“¦" FontSize="16" Margin="0,0,6,0"/>
                            <TextBlock Text="Archive" FontSize="13"/>
                        </StackPanel>
                    </Button>
                    <Button Command="{Binding ViewArchiveCommand}" 
                            Style="{StaticResource SecondaryButton}" 
                            Padding="16,10" Margin="0,0,12,0"
                            ToolTip="View archived items">
                        <TextBlock Text="{Binding ShowArchive, Converter={StaticResource BoolToArchiveIconConverter}, FallbackValue='ðŸ“‹'}" FontSize="16"/>
                    </Button>
                    <Button Command="{Binding ImportFromExcelCommand}" 
                            Style="{StaticResource SecondaryButton}" 
                            Padding="16,10">
                        <TextBlock Text="ðŸ“¥" FontSize="16"/>
                    </Button>
                </StackPanel>
            </Grid>
        </Border>

        <!-- Stats Bar -->
        <Border Grid.Row="1" Background="{DynamicResource SurfaceBrush}" Padding="32,20">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>

                <!-- Total Items -->
                <Border Grid.Column="0" Background="{DynamicResource BackgroundBrush}" 
                        CornerRadius="16" Padding="24,20" Margin="0,0,8,0">
                    <Border.Effect>
                        <DropShadowEffect BlurRadius="12" ShadowDepth="2" Opacity="0.06"/>
                    </Border.Effect>
                    <StackPanel>
                        <TextBlock Text="{Binding MonthItemCount}" 
                                   FontSize="36" FontWeight="Bold"
                                   Foreground="{StaticResource ExpireWiseAccentBrush}"/>
                        <TextBlock Text="Items This Month" 
                                   FontSize="12" 
                                   FontWeight="Medium"
                                   Foreground="{DynamicResource TextSecondaryBrush}"
                                   Margin="0,6,0,0"/>
                    </StackPanel>
                </Border>

                <!-- Warning Items -->
                <Border Grid.Column="1" Background="{DynamicResource WarningBackgroundBrush}" 
                        CornerRadius="16" Padding="24,20" Margin="8,0">
                    <Border.Effect>
                        <DropShadowEffect BlurRadius="12" ShadowDepth="2" Opacity="0.06"/>
                    </Border.Effect>
                    <StackPanel>
                        <TextBlock Text="{Binding WarningCount}" 
                                   FontSize="36" FontWeight="Bold"
                                   Foreground="{DynamicResource WarningDarkBrush}"/>
                        <TextBlock Text="Expiring Soon" 
                                   FontSize="12" 
                                   FontWeight="Medium"
                                   Foreground="{DynamicResource WarningDarkBrush}"
                                   Margin="0,6,0,0"/>
                    </StackPanel>
                </Border>

                <!-- Critical Items -->
                <Border Grid.Column="2" Background="{DynamicResource DangerBackgroundBrush}" 
                        CornerRadius="12" Padding="20,16" Margin="8,0">
                    <StackPanel>
                        <TextBlock Text="{Binding CriticalCount}" 
                                   FontSize="32" FontWeight="Bold"
                                   Foreground="{DynamicResource DangerDarkBrush}"/>
                        <TextBlock Text="Critical" 
                                   FontSize="11" 
                                   Foreground="{DynamicResource DangerDarkBrush}"
                                   Margin="0,4,0,0"/>
                    </StackPanel>
                </Border>

                <!-- Total Units -->
                <Border Grid.Column="3" Background="{DynamicResource BackgroundBrush}" 
                        CornerRadius="12" Padding="20,16" Margin="8,0,0,0">
                    <StackPanel>
                        <TextBlock Text="{Binding MonthTotalUnits}" 
                                   FontSize="32" FontWeight="Bold"
                                   Foreground="{DynamicResource TextPrimaryBrush}"/>
                        <TextBlock Text="Total Units" 
                                   FontSize="11" 
                                   Foreground="{DynamicResource TextSecondaryBrush}"
                                   Margin="0,4,0,0"/>
                    </StackPanel>
                </Border>
            </Grid>
        </Border>

        <!-- Timeline Content Area -->
        <ScrollViewer Grid.Row="2" VerticalScrollBarVisibility="Auto" Padding="32,24">
            <Grid>
                <!-- Active Items View -->
                <StackPanel Visibility="{Binding ShowArchive, Converter={StaticResource InverseBoolToVisibilityConverter}}">
                    <!-- Empty State -->
                    <Border Visibility="{Binding HasData, Converter={StaticResource InverseBoolToVisibilityConverter}}"
                            Background="{DynamicResource SurfaceBrush}" 
                            CornerRadius="16"
                            MaxWidth="600" 
                            Padding="48,40"
                            HorizontalAlignment="Center" 
                            VerticalAlignment="Center">
                    <Border.Effect>
                        <DropShadowEffect BlurRadius="20" ShadowDepth="4" Opacity="0.1"/>
                    </Border.Effect>
                    <StackPanel>
                        <Border Width="80" Height="80" CornerRadius="40" Margin="0,0,0,20"
                                HorizontalAlignment="Center">
                            <Border.Background>
                                <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                                    <GradientStop Color="{StaticResource ExpireWiseAccentColor}" Offset="0"/>
                                    <GradientStop Color="{StaticResource ExpireWiseAccentLightColor}" Offset="1"/>
                                </LinearGradientBrush>
                            </Border.Background>
                            <Border.Effect>
                                <DropShadowEffect BlurRadius="16" ShadowDepth="0" Opacity="0.3" Color="{StaticResource ExpireWiseAccentColor}"/>
                            </Border.Effect>
                            <TextBlock Text="ðŸ“…" FontSize="40" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                        <TextBlock Text="No Items This Month" 
                                   FontSize="24" FontWeight="Bold"
                                   Foreground="{DynamicResource TextPrimaryBrush}"
                                   HorizontalAlignment="Center" 
                                   Margin="0,0,0,12"/>
                        <TextBlock Text="Add items to start tracking expiration dates" 
                                   FontSize="14" 
                                   Foreground="{DynamicResource TextSecondaryBrush}"
                                   HorizontalAlignment="Center" 
                                   TextAlignment="Center"
                                   Margin="0,0,0,28"/>
                        <Button Command="{Binding ShowQuickAddDialogCommand}" 
                                Style="{StaticResource PrimaryButton}"
                                Padding="24,12"
                                HorizontalAlignment="Center">
                            <StackPanel Orientation="Horizontal">
                                <TextBlock Text="âš¡" FontSize="16" Margin="0,0,8,0"/>
                                <TextBlock Text="Add First Item" FontSize="14" FontWeight="SemiBold"/>
                            </StackPanel>
                        </Button>
                    </StackPanel>
                </Border>

                <!-- Timeline View with Month Grouping -->
                <ItemsControl ItemsSource="{Binding ItemsView}"
                              Visibility="{Binding HasData, Converter={StaticResource BooleanToVisibilityConverter}}">
                    
                    <!-- Group by Month -->
                    <ItemsControl.GroupStyle>
                        <GroupStyle>
                            <GroupStyle.ContainerStyle>
                                <Style TargetType="GroupItem">
                                    <Setter Property="Template">
                                        <Setter.Value>
                                            <ControlTemplate>
                                                <Expander IsExpanded="True" Margin="0,0,0,32" Style="{StaticResource MonthExpanderStyle}">
                                                    <Expander.Header>
                                                        <Border CornerRadius="16"
                                                                Padding="28,16"
                                                                Cursor="Hand">
                                                            <Border.Background>
                                                                <LinearGradientBrush StartPoint="0,0" EndPoint="1,0">
                                                                    <GradientStop Color="{StaticResource ExpireWiseAccentColor}" Offset="0"/>
                                                                    <GradientStop Color="{StaticResource ExpireWiseAccentLightColor}" Offset="1"/>
                                                                </LinearGradientBrush>
                                                            </Border.Background>
                                                            <Border.Effect>
                                                                <DropShadowEffect BlurRadius="16" ShadowDepth="3" Opacity="0.2" Color="{StaticResource ExpireWiseAccentColor}"/>
                                                            </Border.Effect>
                                                            <Grid>
                                                                <Grid.ColumnDefinitions>
                                                                    <ColumnDefinition Width="Auto"/>
                                                                    <ColumnDefinition Width="Auto"/>
                                                                    <ColumnDefinition Width="*"/>
                                                                    <ColumnDefinition Width="Auto"/>
                                                                    <ColumnDefinition Width="Auto"/>
                                                                </Grid.ColumnDefinitions>
                                                                
                                                                <!-- Expand/Collapse Icon -->
                                                                <TextBlock Grid.Column="0" 
                                                                           Text="â–¼" 
                                                                           FontSize="14" 
                                                                           Foreground="White"
                                                                           Margin="0,0,12,0" 
                                                                           VerticalAlignment="Center"
                                                                           RenderTransformOrigin="0.5,0.5">
                                                                    <TextBlock.Style>
                                                                        <Style TargetType="TextBlock">
                                                                            <Setter Property="RenderTransform">
                                                                                <Setter.Value>
                                                                                    <RotateTransform Angle="0"/>
                                                                                </Setter.Value>
                                                                            </Setter>
                                                                            <Style.Triggers>
                                                                                <DataTrigger Binding="{Binding IsExpanded, RelativeSource={RelativeSource AncestorType=Expander}}" Value="False">
                                                                                    <Setter Property="RenderTransform">
                                                                                        <Setter.Value>
                                                                                            <RotateTransform Angle="-90"/>
                                                                                        </Setter.Value>
                                                                                    </Setter>
                                                                                </DataTrigger>
                                                                            </Style.Triggers>
                                                                        </Style>
                                                                    </TextBlock.Style>
                                                                </TextBlock>
                                                                
                                                                <StackPanel Grid.Column="1" Orientation="Horizontal">
                                                                    <TextBlock Text="ðŸ“…" FontSize="20" Margin="0,0,12,0" VerticalAlignment="Center"/>
                                                                    <TextBlock Text="{Binding Name}" 
                                                                               FontSize="20" 
                                                                               FontWeight="Bold"
                                                                               Foreground="White"
                                                                               VerticalAlignment="Center"/>
                                                                </StackPanel>
                                                                
                                                                <Border Grid.Column="4"
                                                                        Background="White"
                                                                        CornerRadius="12"
                                                                        Padding="12,4"
                                                                        VerticalAlignment="Center">
                                                                    <TextBlock FontSize="14" FontWeight="Bold">
                                                                        <Run Text="{Binding ItemCount, Mode=OneWay}" Foreground="{StaticResource ExpireWiseAccentBrush}"/>
                                                                        <Run Text=" items" Foreground="{DynamicResource TextSecondaryBrush}"/>
                                                                    </TextBlock>
                                                                </Border>
                                                            </Grid>
                                                        </Border>
                                                    </Expander.Header>
                                                    
                                                    <!-- Items for this Month -->
                                                    <Border Padding="0,16,0,0">
                                                        <ItemsPresenter/>
                                                    </Border>
                                                </Expander>
                                            </ControlTemplate>
                                        </Setter.Value>
                                    </Setter>
                                </Style>
                            </GroupStyle.ContainerStyle>
                        </GroupStyle>
                    </ItemsControl.GroupStyle>

                    <!-- Timeline Item Template -->
                    <ItemsControl.ItemTemplate>
                        <DataTemplate>
                            <!-- Timeline Item Row -->
                            <Grid Margin="0,0,0,16">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="120"/> <!-- Date Column -->
                                    <ColumnDefinition Width="12"/> <!-- Timeline Connector -->
                                    <ColumnDefinition Width="*"/> <!-- Item Card -->
                                </Grid.ColumnDefinitions>

                                <!-- Date Badge -->
                                <Border Grid.Column="0" 
                                        Background="{DynamicResource BackgroundBrush}"
                                        BorderBrush="{StaticResource ExpireWiseAccentBrush}"
                                        BorderThickness="2"
                                        CornerRadius="12"
                                        Padding="16,10"
                                        HorizontalAlignment="Right"
                                        VerticalAlignment="Top"
                                        Margin="0,12,0,0">
                                    <Border.Effect>
                                        <DropShadowEffect BlurRadius="8" ShadowDepth="2" Opacity="0.1"/>
                                    </Border.Effect>
                                    <StackPanel>
                                        <TextBlock Text="{Binding ExpirationDate, StringFormat='MMM dd'}"
                                                   FontSize="16"
                                                   FontWeight="Bold"
                                                   Foreground="{DynamicResource TextPrimaryBrush}"
                                                   HorizontalAlignment="Center"/>
                                        <TextBlock Text="{Binding ExpirationDate, StringFormat='yyyy'}"
                                                   FontSize="11"
                                                   Foreground="{DynamicResource TextSecondaryBrush}"
                                                   HorizontalAlignment="Center"
                                                   Margin="0,2,0,0"/>
                                        <TextBlock Text="{Binding DaysUntilExpiry, StringFormat='{}{0}d'}"
                                                   FontSize="12"
                                                   FontWeight="SemiBold"
                                                   Foreground="{StaticResource ExpireWiseAccentBrush}"
                                                   HorizontalAlignment="Center"
                                                   Margin="0,4,0,0"/>
                                    </StackPanel>
                                </Border>

                                <!-- Timeline Connector Dot -->
                                <Border Grid.Column="1" 
                                        Width="12" Height="12" 
                                        CornerRadius="6"
                                        Background="{StaticResource ExpireWiseAccentBrush}"
                                        HorizontalAlignment="Center"
                                        VerticalAlignment="Top"
                                        Margin="0,20,0,0"/>

                                <!-- Item Card -->
                                <Border Grid.Column="2" 
                                        Background="{DynamicResource BackgroundBrush}"
                                        BorderBrush="{DynamicResource BorderBrush}"
                                        BorderThickness="1"
                                        CornerRadius="16"
                                        Padding="24,20"
                                        Cursor="Hand"
                                        Margin="16,0,0,0">
                                    <Border.Effect>
                                        <DropShadowEffect BlurRadius="12" ShadowDepth="2" Opacity="0.06"/>
                                    </Border.Effect>
                                    <Border.Style>
                                        <Style TargetType="Border">
                                            <Setter Property="RenderTransform">
                                                <Setter.Value>
                                                    <TranslateTransform/>
                                                </Setter.Value>
                                            </Setter>
                                            <Style.Triggers>
                                                <Trigger Property="IsMouseOver" Value="True">
                                                    <Setter Property="BorderBrush" Value="{StaticResource ExpireWiseAccentBrush}"/>
                                                    <Setter Property="BorderThickness" Value="2"/>
                                                    <Trigger.EnterActions>
                                                        <BeginStoryboard>
                                                            <Storyboard>
                                                                <DoubleAnimation Storyboard.TargetProperty="RenderTransform.(TranslateTransform.Y)" 
                                                                                 To="-4" Duration="0:0:0.2">
                                                                    <DoubleAnimation.EasingFunction>
                                                                        <QuadraticEase EasingMode="EaseOut"/>
                                                                    </DoubleAnimation.EasingFunction>
                                                                </DoubleAnimation>
                                                            </Storyboard>
                                                        </BeginStoryboard>
                                                    </Trigger.EnterActions>
                                                    <Trigger.ExitActions>
                                                        <BeginStoryboard>
                                                            <Storyboard>
                                                                <DoubleAnimation Storyboard.TargetProperty="RenderTransform.(TranslateTransform.Y)" 
                                                                                 To="0" Duration="0:0:0.2">
                                                                    <DoubleAnimation.EasingFunction>
                                                                        <QuadraticEase EasingMode="EaseOut"/>
                                                                    </DoubleAnimation.EasingFunction>
                                                                </DoubleAnimation>
                                                            </Storyboard>
                                                        </BeginStoryboard>
                                                    </Trigger.ExitActions>
                                                </Trigger>
                                            </Style.Triggers>
                                        </Style>
                                    </Border.Style>
                                    <Border.InputBindings>
                                        <MouseBinding MouseAction="LeftDoubleClick" 
                                                      Command="{Binding DataContext.EditItemCommand, RelativeSource={RelativeSource AncestorType=ItemsControl}}"
                                                      CommandParameter="{Binding}"/>
                                    </Border.InputBindings>
                                    <Border.ContextMenu>
                                        <ContextMenu>
                                            <MenuItem Header="Edit Item" 
                                                      Command="{Binding DataContext.EditItemCommand, RelativeSource={RelativeSource AncestorType=ContextMenu}}"
                                                      CommandParameter="{Binding}">
                                                <MenuItem.Icon>
                                                    <TextBlock Text="âœï¸" FontSize="14"/>
                                                </MenuItem.Icon>
                                            </MenuItem>
                                            <Separator/>
                                            <MenuItem Header="Delete" 
                                                      Command="{Binding DataContext.DeleteItemCommand, RelativeSource={RelativeSource AncestorType=ContextMenu}}"
                                                      CommandParameter="{Binding}">
                                                <MenuItem.Icon>
                                                    <TextBlock Text="ðŸ—‘ï¸" FontSize="14"/>
                                                </MenuItem.Icon>
                                            </MenuItem>
                                        </ContextMenu>
                                    </Border.ContextMenu>

                                    <Grid>
                                        <Grid.RowDefinitions>
                                            <RowDefinition Height="Auto"/>
                                            <RowDefinition Height="Auto"/>
                                        </Grid.RowDefinitions>

                                        <!-- Header Row -->
                                        <Grid Grid.Row="0" Margin="0,0,0,12">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="Auto"/>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="Auto"/>
                                            </Grid.ColumnDefinitions>

                                            <!-- Item Number -->
                                            <Border Grid.Column="0"
                                                    Background="{StaticResource ExpireWiseAccentBrush}"
                                                    CornerRadius="8"
                                                    Padding="12,6"
                                                    Margin="0,0,12,0">
                                                <TextBlock Text="{Binding ItemNumber}"
                                                           FontSize="13"
                                                           FontWeight="Bold"
                                                           Foreground="White"/>
                                            </Border>

                                            <!-- Description -->
                                            <TextBlock Grid.Column="1"
                                                       Text="{Binding Description}"
                                                       FontSize="18"
                                                       FontWeight="SemiBold"
                                                       Foreground="{DynamicResource TextPrimaryBrush}"
                                                       TextWrapping="Wrap"
                                                       VerticalAlignment="Center"/>

                                            <!-- Status Badge -->
                                            <Border Grid.Column="2" 
                                                    CornerRadius="12" 
                                                    Padding="14,6"
                                                    Margin="12,0,0,0">
                                                <Border.Style>
                                                    <Style TargetType="Border">
                                                        <Setter Property="Background" Value="#d4edda"/>
                                                        <Style.Triggers>
                                                            <DataTrigger Binding="{Binding Status}" Value="Warning">
                                                                <Setter Property="Background" Value="#fff3cd"/>
                                                            </DataTrigger>
                                                            <DataTrigger Binding="{Binding Status}" Value="Critical">
                                                                <Setter Property="Background" Value="#f8d7da"/>
                                                            </DataTrigger>
                                                            <DataTrigger Binding="{Binding Status}" Value="Expired">
                                                                <Setter Property="Background" Value="#e0e0e0"/>
                                                            </DataTrigger>
                                                        </Style.Triggers>
                                                    </Style>
                                                </Border.Style>
                                                <TextBlock Text="{Binding Status}"
                                                           FontWeight="SemiBold"
                                                           FontSize="12">
                                                    <TextBlock.Style>
                                                        <Style TargetType="TextBlock">
                                                            <Setter Property="Foreground" Value="#28a745"/>
                                                            <Style.Triggers>
                                                                <DataTrigger Binding="{Binding Status}" Value="Warning">
                                                                    <Setter Property="Foreground" Value="#ffc107"/>
                                                                </DataTrigger>
                                                                <DataTrigger Binding="{Binding Status}" Value="Critical">
                                                                    <Setter Property="Foreground" Value="#dc3545"/>
                                                                </DataTrigger>
                                                                <DataTrigger Binding="{Binding Status}" Value="Expired">
                                                                    <Setter Property="Foreground" Value="#666666"/>
                                                                </DataTrigger>
                                                            </Style.Triggers>
                                                        </Style>
                                                    </TextBlock.Style>
                                                </TextBlock>
                                            </Border>
                                        </Grid>

                                        <!-- Details Row -->
                                        <Grid Grid.Row="1">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="Auto"/>
                                                <ColumnDefinition Width="Auto"/>
                                            </Grid.ColumnDefinitions>

                                            <!-- Quantity -->
                                            <StackPanel Grid.Column="0" Orientation="Horizontal" Margin="0,0,24,0">
                                                <TextBlock Text="ðŸ“¦" FontSize="14" Margin="0,0,6,0" VerticalAlignment="Center"/>
                                                <TextBlock FontSize="14" VerticalAlignment="Center">
                                                    <Run Text="{Binding Quantity}" FontWeight="SemiBold" Foreground="{DynamicResource TextPrimaryBrush}"/>
                                                    <Run Text=" units" Foreground="{DynamicResource TextSecondaryBrush}"/>
                                                </TextBlock>
                                            </StackPanel>

                                            <!-- UPC -->
                                            <StackPanel Grid.Column="1" Orientation="Horizontal" Visibility="{Binding Upc, Converter={StaticResource StringToVisibilityConverter}}">
                                                <TextBlock Text="ðŸ”¢" FontSize="14" Margin="0,0,6,0" VerticalAlignment="Center"/>
                                                <TextBlock Text="{Binding Upc}"
                                                           FontSize="13"
                                                           Foreground="{DynamicResource TextSecondaryBrush}"
                                                           VerticalAlignment="Center"/>
                                            </StackPanel>
                                        </Grid>
                                    </Grid>
                                </Border>
                            </Grid>
                        </DataTemplate>
                    </ItemsControl.ItemTemplate>
                </ItemsControl>
                </StackPanel>

                <!-- Archive View -->
                <StackPanel Visibility="{Binding ShowArchive, Converter={StaticResource BooleanToVisibilityConverter}}">
                    <!-- Archive Header -->
                    <Border Background="{DynamicResource SurfaceBrush}" 
                            CornerRadius="16"
                            Padding="24,20"
                            Margin="0,0,0,24">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            
                            <StackPanel>
                                <TextBlock Text="ðŸ“¦ Archived Items" 
                                           FontSize="24" FontWeight="Bold"
                                           Foreground="{DynamicResource TextPrimaryBrush}"/>
                                <TextBlock Foreground="{DynamicResource TextSecondaryBrush}"
                                           FontSize="13" Margin="0,4,0,0">
                                    <Run Text="{Binding ArchivedItemsCount, Mode=OneWay}"/>
                                    <Run Text="items archived from"/>
                                    <Run Text="{Binding SelectedStore, Mode=OneWay, FallbackValue='all stores'}"/>
                                </TextBlock>
                            </StackPanel>
                            
                            <Button Grid.Column="1" 
                                    Command="{Binding ClearOldArchiveCommand}"
                                    Style="{StaticResource SecondaryButton}"
                                    Padding="16,10">
                                <StackPanel Orientation="Horizontal">
                                    <TextBlock Text="ðŸ—‘ï¸" FontSize="16" Margin="0,0,6,0"/>
                                    <TextBlock Text="Clear Old" FontSize="13"/>
                                </StackPanel>
                            </Button>
                        </Grid>
                    </Border>

                    <!-- Archive Empty State -->
                    <Border Visibility="{Binding ArchivedItemsCount, Converter={StaticResource IntToVisibilityConverter}, ConverterParameter=inverse}"
                            Background="{DynamicResource SurfaceBrush}" 
                            CornerRadius="16"
                            Padding="48,40"
                            HorizontalAlignment="Center">
                        <StackPanel HorizontalAlignment="Center">
                            <TextBlock Text="ðŸ“­" FontSize="48" HorizontalAlignment="Center" Margin="0,0,0,16"/>
                            <TextBlock Text="No Archived Items" 
                                       FontSize="20" FontWeight="SemiBold"
                                       Foreground="{DynamicResource TextPrimaryBrush}"
                                       HorizontalAlignment="Center" 
                                       Margin="0,0,0,8"/>
                            <TextBlock Text="Expired items will appear here after archiving" 
                                       FontSize="13" 
                                       Foreground="{DynamicResource TextSecondaryBrush}"
                                       HorizontalAlignment="Center"/>
                        </StackPanel>
                    </Border>

                    <!-- Archived Items List -->
                    <ItemsControl ItemsSource="{Binding ArchivedItems}"
                                  Visibility="{Binding ArchivedItemsCount, Converter={StaticResource IntToVisibilityConverter}}">
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <Border Background="{DynamicResource SurfaceBrush}"
                                        CornerRadius="16"
                                        Padding="24,20"
                                        Margin="0,0,0,16">
                                    <Border.Effect>
                                        <DropShadowEffect BlurRadius="8" ShadowDepth="2" Opacity="0.05"/>
                                    </Border.Effect>
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="Auto"/>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="Auto"/>
                                        </Grid.ColumnDefinitions>

                                        <!-- Archive Icon -->
                                        <Border Grid.Column="0"
                                                Width="48" Height="48"
                                                CornerRadius="12"
                                                Background="#f5f5f5"
                                                Margin="0,0,20,0">
                                            <TextBlock Text="ðŸ“¦" 
                                                       FontSize="24" 
                                                       HorizontalAlignment="Center" 
                                                       VerticalAlignment="Center"/>
                                        </Border>

                                        <!-- Item Info -->
                                        <StackPanel Grid.Column="1" VerticalAlignment="Center">
                                            <TextBlock Text="{Binding Description}" 
                                                       FontSize="16" FontWeight="SemiBold"
                                                       Foreground="{DynamicResource TextPrimaryBrush}"
                                                       TextWrapping="Wrap"/>
                                            <StackPanel Orientation="Horizontal" Margin="0,6,0,0">
                                                <Border Background="{DynamicResource BackgroundBrush}"
                                                        CornerRadius="6"
                                                        Padding="8,4"
                                                        Margin="0,0,8,0">
                                                    <TextBlock Text="{Binding ItemNumber}" 
                                                               FontSize="12" 
                                                               FontWeight="Medium"
                                                               Foreground="{DynamicResource TextPrimaryBrush}"/>
                                                </Border>
                                                <Border Background="{DynamicResource BackgroundBrush}"
                                                        CornerRadius="6"
                                                        Padding="8,4">
                                                    <TextBlock FontSize="12" 
                                                               Foreground="{DynamicResource TextSecondaryBrush}">
                                                        <Run Text="{Binding Units}"/>
                                                        <Run Text="units"/>
                                                    </TextBlock>
                                                </Border>
                                            </StackPanel>
                                        </StackPanel>

                                        <!-- Archive Date Info -->
                                        <StackPanel Grid.Column="2" HorizontalAlignment="Right" VerticalAlignment="Center">
                                            <Border Background="#ffebee"
                                                    CornerRadius="8"
                                                    Padding="12,6"
                                                    Margin="0,0,0,6">
                                                <TextBlock FontSize="12" FontWeight="Medium">
                                                    <Run Text="Expired:" Foreground="#c62828"/>
                                                    <Run Text="{Binding ExpiryDate, StringFormat='{}{0:MMM yyyy}'}" Foreground="#c62828"/>
                                                </TextBlock>
                                            </Border>
                                            <TextBlock Text="{Binding ArchivedDate, StringFormat='Archived {0:MMM d, yyyy}'}" 
                                                       FontSize="11" 
                                                       Foreground="{DynamicResource TextTertiaryBrush}"
                                                       TextAlignment="Right"/>
                                        </StackPanel>
                                    </Grid>
                                </Border>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </StackPanel>
            </Grid>
        </ScrollViewer>

        <!-- Loading Overlay -->
        <Border Grid.RowSpan="3"
                Visibility="{Binding IsBusy, Converter={StaticResource BooleanToVisibilityConverter}}"
                Background="#CC000000"
                HorizontalAlignment="Stretch"
                VerticalAlignment="Stretch">
            <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center">
                <Border Background="{DynamicResource SurfaceBrush}"
                        CornerRadius="16"
                        Padding="40,32"
                        MinWidth="250">
                    <StackPanel>
                        <!-- Spinner Animation -->
                        <Border Width="48" Height="48" Margin="0,0,0,20" HorizontalAlignment="Center">
                            <Border.RenderTransform>
                                <RotateTransform x:Name="SpinnerRotate" CenterX="24" CenterY="24"/>
                            </Border.RenderTransform>
                            <Border.Triggers>
                                <EventTrigger RoutedEvent="Loaded">
                                    <BeginStoryboard>
                                        <Storyboard>
                                            <DoubleAnimation Storyboard.TargetProperty="RenderTransform.(RotateTransform.Angle)"
                                                           From="0" To="360" Duration="0:0:1.5" RepeatBehavior="Forever"/>
                                        </Storyboard>
                                    </BeginStoryboard>
                                </EventTrigger>
                            </Border.Triggers>
                            <Border.Background>
                                <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                                    <GradientStop Color="{StaticResource ExpireWiseAccentColor}" Offset="0"/>
                                    <GradientStop Color="{StaticResource ExpireWiseAccentLightColor}" Offset="0.5"/>
                                    <GradientStop Color="Transparent" Offset="0.5"/>
                                    <GradientStop Color="Transparent" Offset="1"/>
                                </LinearGradientBrush>
                            </Border.Background>
                            <Border.OpacityMask>
                                <RadialGradientBrush>
                                    <GradientStop Color="Transparent" Offset="0.5"/>
                                    <GradientStop Color="Black" Offset="0.75"/>
                                    <GradientStop Color="Black" Offset="1"/>
                                </RadialGradientBrush>
                            </Border.OpacityMask>
                        </Border>

                        <!-- Loading Message -->
                        <TextBlock Text="{Binding BusyMessage}"
                                   FontSize="16"
                                   FontWeight="SemiBold"
                                   Foreground="{DynamicResource TextPrimaryBrush}"
                                   HorizontalAlignment="Center"
                                   TextAlignment="Center"
                                   TextWrapping="Wrap"/>
                    </StackPanel>
                </Border>
            </StackPanel>
        </Border>
    </Grid>
</UserControl>
