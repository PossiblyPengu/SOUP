<UserControl x:Class="SOUP.Views.ExpireWise.ExpireWiseView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:vm="clr-namespace:SOUP.ViewModels"
             xmlns:local="clr-namespace:SOUP.Views.ExpireWise"
             mc:Ignorable="d"
             d:DesignHeight="800" d:DesignWidth="1200"
             d:DataContext="{d:DesignInstance Type=vm:ExpireWiseViewModel}"
             Focusable="True">

    <!-- Keyboard Shortcuts -->
    <UserControl.InputBindings>
        <KeyBinding Key="N" Modifiers="Ctrl" Command="{Binding AddItemCommand}"/>
        <KeyBinding Key="I" Modifiers="Ctrl" Command="{Binding ImportFromExcelCommand}"/>
        <KeyBinding Key="E" Modifiers="Ctrl" Command="{Binding ExportToCsvCommand}"/>
        <KeyBinding Key="Delete" Command="{Binding DeleteSelectedCommand}"/>
        <KeyBinding Key="F" Modifiers="Ctrl" Command="{Binding FocusSearchCommand}"/>
    </UserControl.InputBindings>

    <UserControl.Resources>
        <local:StoreDisplayConverter x:Key="StoreDisplayConverter"/>
        <CollectionViewSource x:Key="GroupedItemsView" Source="{Binding FilteredItems}">
            <CollectionViewSource.GroupDescriptions>
                <PropertyGroupDescription PropertyName="Location" />
            </CollectionViewSource.GroupDescriptions>
        </CollectionViewSource>
        <Storyboard x:Key="FadeInStoryboard">
            <DoubleAnimation Storyboard.TargetProperty="Opacity"
                           From="0" To="1" Duration="0:0:0.4">
                <DoubleAnimation.EasingFunction>
                    <QuadraticEase EasingMode="EaseOut"/>
                </DoubleAnimation.EasingFunction>
            </DoubleAnimation>
        </Storyboard>
        
        <!-- ExpireWise Accent Colors (Amber/Orange theme) -->
        <Color x:Key="ExpireWiseAccentColor">#f59e0b</Color>
        <Color x:Key="ExpireWiseAccentLightColor">#fbbf24</Color>
        <Color x:Key="ExpireWiseAccentDarkColor">#d97706</Color>
        <SolidColorBrush x:Key="ExpireWiseAccentBrush" Color="{StaticResource ExpireWiseAccentColor}"/>
        <SolidColorBrush x:Key="ExpireWiseAccentLightBrush" Color="{StaticResource ExpireWiseAccentLightColor}"/>
        
        <!-- Sidebar Navigation RadioButton Style -->
        <Style x:Key="SidebarNavButton" TargetType="RadioButton">
            <Setter Property="Foreground" Value="{DynamicResource TextSecondaryBrush}"/>
            <Setter Property="FontSize" Value="13"/>
            <Setter Property="FontWeight" Value="Medium"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Padding" Value="16,12"/>
            <Setter Property="Margin" Value="8,2"/>
            <Setter Property="FocusVisualStyle" Value="{x:Null}"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="RadioButton">
                        <Border x:Name="Bg" Background="Transparent" CornerRadius="10"
                                Padding="{TemplateBinding Padding}">
                            <ContentPresenter VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="Bg" Property="Background" Value="{DynamicResource SurfaceHoverBrush}"/>
                            </Trigger>
                            <Trigger Property="IsChecked" Value="True">
                                <Setter TargetName="Bg" Property="Background" Value="{DynamicResource SidebarActiveBrush}"/>
                                <Setter Property="Foreground" Value="{StaticResource ExpireWiseAccentLightBrush}"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
        
        <!-- Sidebar Action Button Style -->
        <Style x:Key="SidebarActionButton" TargetType="Button">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="Foreground" Value="{DynamicResource TextSecondaryBrush}"/>
            <Setter Property="FontSize" Value="13"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Padding" Value="16,12"/>
            <Setter Property="Margin" Value="8,2"/>
            <Setter Property="HorizontalContentAlignment" Value="Left"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="FocusVisualStyle" Value="{x:Null}"/>
            <Setter Property="Focusable" Value="False"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border x:Name="Bg" Background="{TemplateBinding Background}" CornerRadius="10"
                                Padding="{TemplateBinding Padding}">
                            <ContentPresenter VerticalAlignment="Center" HorizontalAlignment="{TemplateBinding HorizontalContentAlignment}"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="Bg" Property="Background" Value="{DynamicResource SurfaceHoverBrush}"/>
                            </Trigger>
                            <Trigger Property="IsPressed" Value="True">
                                <Setter TargetName="Bg" Property="Background" Value="{DynamicResource SidebarActiveBrush}"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
        
        <!-- Modern DataGrid Style -->
        <Style x:Key="ModernDataGrid" TargetType="DataGrid">
            <Setter Property="Background" Value="{DynamicResource SurfaceBrush}"/>
            <Setter Property="Foreground" Value="{DynamicResource TextPrimaryBrush}"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="RowHeaderWidth" Value="0"/>
            <Setter Property="AutoGenerateColumns" Value="False"/>
            <Setter Property="CanUserAddRows" Value="False"/>
            <Setter Property="CanUserDeleteRows" Value="False"/>
            <Setter Property="CanUserResizeRows" Value="False"/>
            <Setter Property="GridLinesVisibility" Value="None"/>
            <Setter Property="HeadersVisibility" Value="Column"/>
            <Setter Property="HorizontalScrollBarVisibility" Value="Auto"/>
            <Setter Property="VerticalScrollBarVisibility" Value="Auto"/>
        </Style>
        
        <!-- Modern DataGrid Column Header Style -->
        <Style x:Key="ModernDataGridColumnHeader" TargetType="DataGridColumnHeader">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="Foreground" Value="{DynamicResource TextSecondaryBrush}"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="FontSize" Value="11"/>
            <Setter Property="Padding" Value="12,16"/>
            <Setter Property="BorderThickness" Value="0,0,0,1"/>
            <Setter Property="BorderBrush" Value="{DynamicResource SurfaceHoverBrush}"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="DataGridColumnHeader">
                        <Border Background="{TemplateBinding Background}" 
                                BorderBrush="{TemplateBinding BorderBrush}"
                                BorderThickness="{TemplateBinding BorderThickness}"
                                Padding="{TemplateBinding Padding}">
                            <ContentPresenter HorizontalAlignment="{TemplateBinding HorizontalContentAlignment}"
                                              VerticalAlignment="Center"/>
                        </Border>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
        
        <!-- Modern DataGrid Cell Style -->
        <Style x:Key="ModernDataGridCell" TargetType="DataGridCell">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="Foreground" Value="{DynamicResource TextPrimaryBrush}"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Padding" Value="12,14"/>
            <Setter Property="FontSize" Value="13"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="DataGridCell">
                        <Border Background="{TemplateBinding Background}" 
                                Padding="{TemplateBinding Padding}">
                            <ContentPresenter VerticalAlignment="Center"/>
                        </Border>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
            <Style.Triggers>
                <Trigger Property="IsSelected" Value="True">
                    <Setter Property="Background" Value="{DynamicResource SidebarActiveBrush}"/>
                    <Setter Property="Foreground" Value="{StaticResource ExpireWiseAccentLightBrush}"/>
                </Trigger>
            </Style.Triggers>
        </Style>
        
        <!-- Modern DataGrid Row Style -->
        <Style x:Key="ModernDataGridRow" TargetType="DataGridRow">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="Margin" Value="0,1"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="DataGridRow">
                        <Border x:Name="RowBorder" 
                                Background="{TemplateBinding Background}" 
                                CornerRadius="8"
                                Margin="4,2">
                            <SelectiveScrollingGrid>
                                <SelectiveScrollingGrid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="*"/>
                                </SelectiveScrollingGrid.ColumnDefinitions>
                                <SelectiveScrollingGrid.RowDefinitions>
                                    <RowDefinition Height="*"/>
                                    <RowDefinition Height="Auto"/>
                                </SelectiveScrollingGrid.RowDefinitions>
                                <DataGridCellsPresenter Grid.Column="1" ItemsPanel="{TemplateBinding ItemsPanel}"
                                                        SnapsToDevicePixels="{TemplateBinding SnapsToDevicePixels}"/>
                                <DataGridDetailsPresenter Grid.Column="1" Grid.Row="1"
                                                          Visibility="{TemplateBinding DetailsVisibility}"
                                                          SelectiveScrollingGrid.SelectiveScrollingOrientation="Both"/>
                            </SelectiveScrollingGrid>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="RowBorder" Property="Background" Value="{DynamicResource SurfaceHoverBrush}"/>
                            </Trigger>
                            <Trigger Property="IsSelected" Value="True">
                                <Setter TargetName="RowBorder" Property="Background" Value="{DynamicResource SidebarActiveBrush}"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
    </UserControl.Resources>

    <UserControl.Triggers>
        <EventTrigger RoutedEvent="Loaded">
            <BeginStoryboard Storyboard="{StaticResource FadeInStoryboard}"/>
        </EventTrigger>
    </UserControl.Triggers>

    <Grid>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="220"/>
            <ColumnDefinition Width="*"/>
        </Grid.ColumnDefinitions>
        
        <!-- Sidebar -->
        <Border Grid.Column="0" Background="{DynamicResource BackgroundBrush}">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>
                
                <!-- App Header -->
                <Border Grid.Row="0" Padding="20,24,20,20" BorderBrush="{DynamicResource SurfaceHoverBrush}" BorderThickness="0,0,0,1">
                    <StackPanel>
                        <Border Width="56" Height="56" CornerRadius="16" HorizontalAlignment="Left" Margin="0,0,0,16">
                            <Border.Background>
                                <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                                    <GradientStop Color="{StaticResource ExpireWiseAccentColor}" Offset="0"/>
                                    <GradientStop Color="{StaticResource ExpireWiseAccentDarkColor}" Offset="1"/>
                                </LinearGradientBrush>
                            </Border.Background>
                            <Border.Effect>
                                <DropShadowEffect BlurRadius="20" ShadowDepth="0" Opacity="0.4" Color="{StaticResource ExpireWiseAccentColor}"/>
                            </Border.Effect>
                            <TextBlock Text="â°" FontSize="28" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                        <TextBlock Text="ExpireWise" FontSize="20" FontWeight="Bold" Foreground="{DynamicResource TextPrimaryBrush}"/>
                        <TextBlock Text="Expiration Tracking" FontSize="12" Foreground="{DynamicResource TextTertiaryBrush}" Margin="0,4,0,0"/>
                    </StackPanel>
                </Border>
                
                <!-- Navigation -->
                <StackPanel Grid.Row="1" Margin="12,16,12,0">
                    <TextBlock Text="NAVIGATION" FontSize="10" FontWeight="SemiBold" Foreground="{DynamicResource TextDisabledBrush}" 
                               Margin="14,0,0,10" />
                    
                    <RadioButton x:Name="DataTab" GroupName="NavTabs" IsChecked="True" Style="{StaticResource SidebarNavButton}">
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Text="ðŸ“‹" FontSize="16" Margin="0,0,12,0"/>
                            <TextBlock Text="Data View" VerticalAlignment="Center"/>
                        </StackPanel>
                    </RadioButton>
                    
                    <RadioButton x:Name="AnalyticsTab" GroupName="NavTabs" Style="{StaticResource SidebarNavButton}">
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Text="ðŸ“Š" FontSize="16" Margin="0,0,12,0"/>
                            <TextBlock Text="Analytics" VerticalAlignment="Center"/>
                        </StackPanel>
                    </RadioButton>
                    
                    <Border Height="1" Background="{DynamicResource SurfaceHoverBrush}" Margin="0,16,0,16"/>
                    
                    <TextBlock Text="ACTIONS" FontSize="10" FontWeight="SemiBold" Foreground="{DynamicResource TextDisabledBrush}" 
                               Margin="14,0,0,10"/>
                    
                    <Button Command="{Binding AddItemCommand}" Style="{StaticResource SidebarActionButton}">
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Text="âž•" FontSize="16" Margin="0,0,12,0" Foreground="{DynamicResource TextSecondaryBrush}"/>
                            <TextBlock Text="Add Item" Foreground="{DynamicResource TextSecondaryBrush}" FontSize="13"/>
                        </StackPanel>
                    </Button>
                    
                    <Button Command="{Binding ImportFromExcelCommand}" Style="{StaticResource SidebarActionButton}">
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Text="ðŸ“¥" FontSize="16" Margin="0,0,12,0" Foreground="{DynamicResource TextSecondaryBrush}"/>
                            <TextBlock Text="Import Data" Foreground="{DynamicResource TextSecondaryBrush}" FontSize="13"/>
                        </StackPanel>
                    </Button>
                    
                    <Button Command="{Binding ExportToExcelCommand}" Style="{StaticResource SidebarActionButton}">
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Text="ðŸ“¤" FontSize="16" Margin="0,0,12,0" Foreground="{DynamicResource TextSecondaryBrush}"/>
                            <TextBlock Text="Export Data" Foreground="{DynamicResource TextSecondaryBrush}" FontSize="13"/>
                        </StackPanel>
                    </Button>
                </StackPanel>
                
                <!-- Bottom Section -->
                <StackPanel Grid.Row="2" Margin="12,0,12,16">
                    <Border Height="1" Background="{DynamicResource SurfaceHoverBrush}" Margin="0,0,0,12"/>
                    
                    <Button Command="{Binding OpenSettingsCommand}" Style="{StaticResource SidebarActionButton}">
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Text="âš™ï¸" FontSize="16" Margin="0,0,12,0"/>
                            <TextBlock Text="Settings" Foreground="{DynamicResource TextSecondaryBrush}" FontSize="13"/>
                        </StackPanel>
                    </Button>
                    
                    <!-- Status Info -->
                    <Border Background="{DynamicResource SurfaceBrush}" CornerRadius="10" Padding="14,12" Margin="0,8,0,0"
                            Visibility="{Binding LastSavedDisplay, Converter={StaticResource StringToVisibilityConverter}}">
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Text="âœ“" FontSize="12" Foreground="{DynamicResource SuccessBrush}" Margin="0,0,8,0"/>
                            <TextBlock Text="{Binding LastSavedDisplay}" FontSize="11" Foreground="{DynamicResource TextTertiaryBrush}"/>
                        </StackPanel>
                    </Border>
                </StackPanel>
            </Grid>
        </Border>
        
        <!-- Main Content Area -->
        <Grid Grid.Column="1" Background="{DynamicResource BackgroundBrush}">
            <!-- Data View -->
            <Grid Visibility="{Binding IsChecked, ElementName=DataTab, Converter={StaticResource BooleanToVisibilityConverter}}">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>
                
                <!-- Header Bar -->
                <Border Grid.Row="0" Background="{DynamicResource SurfaceBrush}" Padding="20,16" BorderBrush="{DynamicResource SurfaceHoverBrush}" BorderThickness="0,0,0,1">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>
                        
                        <StackPanel Grid.Column="0">
                            <TextBlock Text="Expiration Data" FontSize="20" FontWeight="SemiBold" Foreground="{DynamicResource TextPrimaryBrush}"/>
                            <TextBlock Text="Track and manage items by expiration date" FontSize="13" Foreground="{DynamicResource TextTertiaryBrush}" Margin="0,4,0,0"/>
                        </StackPanel>
                        
                        <!-- Quick Actions -->
                        <StackPanel Grid.Column="1" Orientation="Horizontal">
                            <Button Command="{Binding EditItemCommand}" Style="{StaticResource SecondaryButton}" Margin="0,0,8,0">
                                <StackPanel Orientation="Horizontal">
                                    <TextBlock Text="âœï¸" FontSize="14" Margin="0,0,6,0"/>
                                    <TextBlock Text="Edit"/>
                                </StackPanel>
                            </Button>
                            <Button Command="{Binding DeleteSelectedCommand}" Style="{StaticResource DangerButton}">
                                <StackPanel Orientation="Horizontal">
                                    <TextBlock Text="ðŸ—‘ï¸" FontSize="14" Margin="0,0,6,0"/>
                                    <TextBlock Text="Delete"/>
                                </StackPanel>
                            </Button>
                        </StackPanel>
                    </Grid>
                </Border>
                
                <!-- Month Navigator -->
                <Border Grid.Row="1" Background="{DynamicResource SurfaceBrush}" BorderBrush="{DynamicResource SurfaceHoverBrush}" BorderThickness="0,0,0,1" Padding="20,14">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>

                        <!-- Left Stats -->
                        <StackPanel Grid.Column="0" Orientation="Horizontal" VerticalAlignment="Center">
                            <Border Background="{DynamicResource SurfaceHoverBrush}" CornerRadius="10" Padding="14,10" Margin="0,0,12,0">
                                <StackPanel Orientation="Horizontal">
                                    <TextBlock Text="ðŸ“¦" FontSize="14" VerticalAlignment="Center" Margin="0,0,8,0"/>
                                    <TextBlock Text="{Binding TotalItems}" FontSize="16" FontWeight="Bold" 
                                               Foreground="{DynamicResource TextPrimaryBrush}" VerticalAlignment="Center"/>
                                    <TextBlock Text=" total" FontSize="12" 
                                               Foreground="{DynamicResource TextSecondaryBrush}" VerticalAlignment="Center"/>
                                </StackPanel>
                            </Border>
                        </StackPanel>

                        <!-- Center - Month Navigator -->
                        <StackPanel Grid.Column="1" Orientation="Horizontal" HorizontalAlignment="Center">
                            <Button Command="{Binding PreviousMonthCommand}" 
                                    IsEnabled="{Binding CanGoToPreviousMonth}"
                                    Style="{StaticResource SecondaryButton}"
                                    Width="40" Height="40" Padding="0" Margin="0,0,8,0">
                                <TextBlock Text="â—€" FontSize="16" HorizontalAlignment="Center"/>
                            </Button>
                            
                            <Border CornerRadius="10" Padding="24,10" MinWidth="200">
                                <Border.Background>
                                    <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                                        <GradientStop Color="{StaticResource ExpireWiseAccentColor}" Offset="0"/>
                                        <GradientStop Color="{StaticResource ExpireWiseAccentDarkColor}" Offset="1"/>
                                    </LinearGradientBrush>
                                </Border.Background>
                                <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                                    <TextBlock Text="{Binding CurrentMonthDisplay}" 
                                               FontSize="16" FontWeight="Bold" Foreground="{DynamicResource TextOnPrimaryBrush}"
                                               VerticalAlignment="Center"/>
                                    <Border Background="{DynamicResource SurfaceBrush}" CornerRadius="8" 
                                            Padding="10,4" Margin="12,0,0,0" VerticalAlignment="Center">
                                        <TextBlock Text="{Binding MonthItemCount}" FontSize="12" 
                                                   FontWeight="Bold" Foreground="{DynamicResource TextPrimaryBrush}"/>
                                    </Border>
                                </StackPanel>
                            </Border>
                            
                            <Button Command="{Binding NextMonthCommand}" 
                                    IsEnabled="{Binding CanGoToNextMonth}"
                                    Style="{StaticResource SecondaryButton}"
                                    Width="40" Height="40" Padding="0" Margin="8,0,0,0">
                                <TextBlock Text="â–¶" FontSize="16" HorizontalAlignment="Center"/>
                            </Button>
                        </StackPanel>

                        <!-- Right Stats -->
                        <StackPanel Grid.Column="2" Orientation="Horizontal" VerticalAlignment="Center" HorizontalAlignment="Right">
                            <Border Background="{DynamicResource WarningBackgroundBrush}" CornerRadius="10" Padding="14,10" Margin="0,0,12,0">
                                <StackPanel Orientation="Horizontal">
                                    <TextBlock Text="{Binding MonthItemCount}" FontSize="16" FontWeight="Bold" 
                                               Foreground="{DynamicResource WarningLightBrush}" VerticalAlignment="Center"/>
                                    <TextBlock Text=" items" FontSize="12" 
                                               Foreground="{DynamicResource WarningLightBrush}" VerticalAlignment="Center" Margin="4,0,0,0"/>
                                    <TextBlock Text=" â€¢" Foreground="{DynamicResource WarningLightBrush}" Margin="8,0"/>
                                    <TextBlock Text="{Binding MonthTotalUnits}" FontSize="16" FontWeight="Bold" 
                                               Foreground="{DynamicResource WarningLightBrush}" VerticalAlignment="Center"/>
                                    <TextBlock Text=" units" FontSize="12" 
                                               Foreground="{DynamicResource WarningLightBrush}" VerticalAlignment="Center" Margin="4,0,0,0"/>
                                </StackPanel>
                            </Border>
                            <Border Background="{DynamicResource DangerBackgroundBrush}" CornerRadius="10" Padding="14,10" 
                                    Visibility="{Binding CriticalCount, Converter={StaticResource CountToVisibility}}">
                                <StackPanel Orientation="Horizontal">
                                    <TextBlock Text="ðŸš¨" FontSize="12" VerticalAlignment="Center" Margin="0,0,6,0"/>
                                    <TextBlock Text="{Binding CriticalCount}" FontSize="14" FontWeight="Bold" 
                                               Foreground="{DynamicResource DangerLightBrush}" VerticalAlignment="Center"/>
                                    <TextBlock Text=" critical" FontSize="11" 
                                               Foreground="{DynamicResource DangerLightBrush}" VerticalAlignment="Center" Margin="4,0,0,0"/>
                                </StackPanel>
                            </Border>
                        </StackPanel>
                    </Grid>
                </Border>

                <!-- Search Bar -->
                <Border Grid.Row="2" Background="{DynamicResource SurfaceBrush}" Padding="20,12" BorderBrush="{DynamicResource SurfaceHoverBrush}" BorderThickness="0,0,0,1">
                    <TextBox x:Name="SearchBox" Text="{Binding SearchText, UpdateSourceTrigger=PropertyChanged}">
                        <TextBox.Style>
                            <Style TargetType="TextBox" BasedOn="{StaticResource ModernTextBox}">
                                <Style.Triggers>
                                    <Trigger Property="Text" Value="">
                                        <Setter Property="Background">
                                            <Setter.Value>
                                                <VisualBrush Stretch="None" AlignmentX="Left">
                                                    <VisualBrush.Visual>
                                                        <TextBlock Text="ðŸ” Search items in this month..."
                                                                 Foreground="{DynamicResource TextTertiaryBrush}" Margin="12,0,0,0"/>
                                                    </VisualBrush.Visual>
                                                </VisualBrush>
                                            </Setter.Value>
                                        </Setter>
                                    </Trigger>
                                </Style.Triggers>
                            </Style>
                        </TextBox.Style>
                    </TextBox>
                </Border>
                
                <!-- Data Grid -->
                <Grid Grid.Row="3" Margin="20">
                    <DataGrid x:Name="ItemsGrid" ItemsSource="{Binding Source={StaticResource GroupedItemsView}}"
                              SelectedItem="{Binding SelectedItem}"
                              SelectionMode="Extended" SelectionUnit="FullRow"
                              SelectionChanged="OnItemsGridSelectionChanged"
                              VirtualizingStackPanel.IsVirtualizing="True"
                              VirtualizingStackPanel.VirtualizationMode="Recycling"
                              EnableRowVirtualization="True"
                              EnableColumnVirtualization="True"
                              Style="{StaticResource ModernDataGrid}"
                              ColumnHeaderStyle="{StaticResource ModernDataGridColumnHeader}"
                              CellStyle="{StaticResource ModernDataGridCell}"
                              RowStyle="{StaticResource ModernDataGridRow}">
                        <DataGrid.InputBindings>
                            <MouseBinding MouseAction="LeftDoubleClick" Command="{Binding EditItemCommand}"/>
                        </DataGrid.InputBindings>
                        <DataGrid.Columns>
                            <DataGridTextColumn Header="Item Number" Binding="{Binding ItemNumber}" Width="120"/>
                            <DataGridTextColumn Header="Description" Binding="{Binding Description}" Width="*"/>
                            <DataGridTextColumn Header="Store" Binding="{Binding Location, Converter={StaticResource StoreDisplayConverter}}" Width="240"/>
                            <DataGridTextColumn Header="Quantity" Binding="{Binding Quantity}" Width="80"/>
                            <DataGridTemplateColumn Header="Status" Width="100">
                                <DataGridTemplateColumn.CellTemplate>
                                    <DataTemplate>
                                        <Border CornerRadius="4" Padding="8,4" HorizontalAlignment="Center">
                                            <Border.Style>
                                                <Style TargetType="Border">
                                                    <Setter Property="Background" Value="{DynamicResource SuccessBrush}"/>
                                                    <Style.Triggers>
                                                        <DataTrigger Binding="{Binding Status}" Value="Warning">
                                                            <Setter Property="Background" Value="{DynamicResource WarningBrush}"/>
                                                        </DataTrigger>
                                                        <DataTrigger Binding="{Binding Status}" Value="Critical">
                                                            <Setter Property="Background" Value="{DynamicResource DangerBrush}"/>
                                                        </DataTrigger>
                                                        <DataTrigger Binding="{Binding Status}" Value="Expired">
                                                            <Setter Property="Background" Value="{DynamicResource TextTertiaryBrush}"/>
                                                        </DataTrigger>
                                                    </Style.Triggers>
                                                </Style>
                                            </Border.Style>
                                            <TextBlock Text="{Binding Status}" FontWeight="SemiBold" 
                                                       Foreground="{DynamicResource TextOnPrimaryBrush}" FontSize="10"/>
                                        </Border>
                                    </DataTemplate>
                                </DataGridTemplateColumn.CellTemplate>
                            </DataGridTemplateColumn>
                        </DataGrid.Columns>

                        <DataGrid.GroupStyle>
                            <GroupStyle>
                                <GroupStyle.ContainerStyle>
                                    <Style TargetType="{x:Type GroupItem}">
                                        <Setter Property="Margin" Value="0,12,0,0"/>
                                        <Setter Property="Template">
                                            <Setter.Value>
                                                <ControlTemplate TargetType="{x:Type GroupItem}">
                                                    <Border Background="{DynamicResource SurfaceBrush}" CornerRadius="12" 
                                                            BorderBrush="{DynamicResource SurfaceHoverBrush}" BorderThickness="1"
                                                            Margin="0,0,0,4">
                                                        <Expander IsExpanded="True" Background="Transparent" BorderThickness="0">
                                                            <Expander.Header>
                                                                <Grid Margin="8,8,8,4">
                                                                    <Grid.ColumnDefinitions>
                                                                        <ColumnDefinition Width="Auto"/>
                                                                        <ColumnDefinition Width="*"/>
                                                                        <ColumnDefinition Width="Auto"/>
                                                                    </Grid.ColumnDefinitions>
                                                                    
                                                                    <!-- Location Pin Icon -->
                                                                    <Border Grid.Column="0" Background="{StaticResource ExpireWiseAccentBrush}" 
                                                                            CornerRadius="6" Width="28" Height="28" Margin="0,0,12,0">
                                                                        <TextBlock Text="ðŸ“" FontSize="12" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                                                    </Border>
                                                                    
                                                                    <!-- Store Name -->
                                                                    <TextBlock Grid.Column="1" 
                                                                               Text="{Binding Name, Converter={StaticResource StoreDisplayConverter}}" 
                                                                               FontWeight="SemiBold" FontSize="14" 
                                                                               Foreground="{StaticResource ExpireWiseAccentLightBrush}" 
                                                                               VerticalAlignment="Center"/>
                                                                    
                                                                    <!-- Item Count Badge -->
                                                                    <Border Grid.Column="2" Background="{DynamicResource SurfaceHoverBrush}" 
                                                                            CornerRadius="8" Padding="12,6" Margin="12,0,0,0">
                                                                        <TextBlock VerticalAlignment="Center">
                                                                            <Run Text="{Binding ItemCount, Mode=OneWay}" FontWeight="SemiBold" 
                                                                                 Foreground="{DynamicResource TextPrimaryBrush}"/>
                                                                            <Run Text=" items" Foreground="{DynamicResource TextSecondaryBrush}"/>
                                                                        </TextBlock>
                                                                    </Border>
                                                                </Grid>
                                                            </Expander.Header>
                                                            <ItemsPresenter Margin="0,0,0,8"/>
                                                        </Expander>
                                                    </Border>
                                                </ControlTemplate>
                                            </Setter.Value>
                                        </Setter>
                                    </Style>
                                </GroupStyle.ContainerStyle>
                                <GroupStyle.Panel>
                                    <ItemsPanelTemplate>
                                        <DataGridRowsPresenter/>
                                    </ItemsPanelTemplate>
                                </GroupStyle.Panel>
                            </GroupStyle>
                        </DataGrid.GroupStyle>
                    </DataGrid>
                </Grid>

                <!-- Status Bar -->
                <Border Grid.Row="4" Background="{DynamicResource SurfaceBrush}" Padding="20,12" BorderBrush="{DynamicResource SurfaceHoverBrush}" BorderThickness="0,1,0,0">
                    <Grid>
                        <TextBlock Text="{Binding StatusMessage}" Foreground="{DynamicResource TextSecondaryBrush}" FontSize="12"/>
                        <StackPanel Orientation="Horizontal" HorizontalAlignment="Right"
                                    Visibility="{Binding IsLoading, Converter={StaticResource BooleanToVisibilityConverter}}">
                            <TextBlock Text="â³" FontSize="12" Margin="0,0,8,0"/>
                            <TextBlock Text="Loading..." Foreground="{DynamicResource TextSecondaryBrush}" FontSize="12"/>
                        </StackPanel>
                    </Grid>
                </Border>
            </Grid>

            <!-- Analytics View -->
            <local:ExpireWiseAnalyticsView DataContext="{Binding Analytics}"
                                           Visibility="{Binding IsChecked, ElementName=AnalyticsTab, Converter={StaticResource BooleanToVisibilityConverter}}"/>
        </Grid>
    </Grid>
</UserControl>





