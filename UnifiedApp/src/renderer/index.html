<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Business Tools Suite</title>
    <link rel="stylesheet" href="css/unified-theme.css">
    <link rel="stylesheet" href="css/launcher.css">
</head>
<body>
    <script>
        // Initialize debug flag and mute console in production.
        (async () => {
            try {
                const isDev = await window.electronAPI?.isDev?.();
                window.DEBUG = !!isDev;
                if (!window.DEBUG) {
                    // Mute noisy console methods in production to reduce log spam
                    console.log = () => {};
                    console.debug = () => {};
                    console.info = () => {};
                }
            } catch (err) {
                // If electronAPI is missing, default to non-dev behaviour
                window.DEBUG = false;
            }
        })();
    </script>
    <!-- Custom Title Bar -->
    <div class="custom-titlebar">
        <div class="titlebar-drag-region">
            <button id="backToLauncherBtn" class="back-to-launcher-btn" style="display: none;" title="Back to Launcher (ESC)">
                ‚Üê Back
            </button>
            <h2 id="titlebar-module-title" class="titlebar-module-title"></h2>
        </div>
        <div class="titlebar-actions">
            <button id="titlebarSettingsBtn" class="titlebar-action-btn" title="Settings">
                <span>‚öôÔ∏è</span>
            </button>
            <button id="themeToggle" class="titlebar-action-btn" title="Toggle theme">
                <span class="theme-icon">‚òÄÔ∏è</span>
            </button>
        </div>
        <div class="titlebar-controls">
            <button class="titlebar-button" id="minimizeBtn" title="Minimize">
                <svg width="12" height="12" viewBox="0 0 12 12">
                    <rect x="0" y="5" width="12" height="2" fill="currentColor"/>
                </svg>
            </button>
            <button class="titlebar-button" id="maximizeBtn" title="Maximize">
                <svg width="12" height="12" viewBox="0 0 12 12">
                    <rect x="1" y="1" width="10" height="10" stroke="currentColor" stroke-width="1.5" fill="none"/>
                </svg>
            </button>
            <button class="titlebar-button titlebar-close" id="closeBtn" title="Close">
                <svg width="12" height="12" viewBox="0 0 12 12">
                    <path d="M1 1 L11 11 M11 1 L1 11" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
                </svg>
            </button>
        </div>
    </div>

    <div class="launcher-container">
        <header class="launcher-header">
            <h1 class="launcher-title">Business Tools Suite</h1>
            <p class="launcher-subtitle">Select an application to begin</p>
        </header>

        <main class="app-grid">
            <div class="app-icon" data-module="expirewise" onclick="launchModule('expirewise')" title="Launch ExpireWise (Alt+1)">
                <div class="app-icon-inner">
                    <div class="app-icon-symbol">üì¶</div>
                    <div class="app-icon-label">ExpireWise</div>
                    <div class="app-icon-hint">Expiration tracking</div>
                </div>
            </div>

            <div class="app-icon" data-module="allocation-buddy" onclick="launchModule('allocation-buddy')" title="Launch Allocation Buddy (Alt+2)">
                <div class="app-icon-inner">
                    <div class="app-icon-symbol">üìä</div>
                    <div class="app-icon-label">Allocation Buddy</div>
                    <div class="app-icon-hint">Store allocations</div>
                </div>
            </div>

            <div class="app-icon" data-module="essentials-buddy" onclick="launchModule('essentials-buddy')" title="Launch Essentials Buddy (Alt+3)">
                <div class="app-icon-inner">
                    <div class="app-icon-symbol">üìã</div>
                    <div class="app-icon-label">Essentials Buddy</div>
                    <div class="app-icon-hint">Inventory reports</div>
                </div>
            </div>
        </main>

        <footer class="launcher-footer">
            <p>v1.0.0 | All tools run 100% offline | Press Alt+1/2/3 for quick launch</p>
        </footer>
    </div>

    <div class="module-container" id="module-container" style="display: none;">
        <div class="module-content" id="module-content"></div>
    </div>

    <!-- Unified Settings Modal -->
    <div class="settings-modal" id="settingsModal" style="display: none;">
        <div class="settings-modal-content">
            <div class="settings-header">
                <h2>‚öôÔ∏è Settings</h2>
                <button class="modal-close" id="closeSettingsModal">‚úï</button>
            </div>
            
            <div class="settings-body">
                <!-- Settings Tabs -->
                <div class="settings-tabs">
                    <button class="settings-tab active" data-tab="general">General</button>
                    <button class="settings-tab" data-tab="dictionaries">Dictionaries</button>
                    <button class="settings-tab" data-tab="expirewise">ExpireWise</button>
                    <button class="settings-tab" data-tab="allocation">Allocation Buddy</button>
                    <button class="settings-tab" data-tab="essentials">Essentials Buddy</button>
                    <button class="settings-tab" data-tab="analytics">Analytics</button>
                </div>

                <!-- Settings Panels -->
                <div class="settings-panels">
                    <!-- General Settings -->
                    <div class="settings-panel active" data-panel="general">
                        <h3>General Settings</h3>
                        
                        <div class="setting-group">
                            <label for="themeSelect">Theme</label>
                            <select id="themeSelect" class="setting-input">
                                <option value="system">System Default</option>
                                <option value="light">Light</option>
                                <option value="dark">Dark</option>
                            </select>
                        </div>

                        <div class="setting-group">
                            <label>
                                <input type="checkbox" id="autoSave" checked>
                                Auto-save data
                            </label>
                        </div>

                        <div class="setting-group">
                            <label>
                                <input type="checkbox" id="confirmDelete" checked>
                                Confirm before deleting items
                            </label>
                        </div>
                    </div>

                    <!-- Dictionaries Settings -->
                    <div class="settings-panel" data-panel="dictionaries">
                        <h3>Dictionaries Management</h3>
                        <p class="panel-description">Manage shared dictionaries used by Allocation Buddy and ExpireWise</p>
                        
                        <div class="setting-group">
                            <label>Items Dictionary</label>
                            <button class="btn btn-secondary" onclick="openAllocationBuddyDictionary('items')">
                                üìã Manage Items
                            </button>
                            <small>Manage item numbers, descriptions, and SKUs</small>
                        </div>

                        <div class="setting-group">
                            <label>Stores Dictionary</label>
                            <button class="btn btn-secondary" onclick="openAllocationBuddyDictionary('stores')">
                                üè™ Manage Stores
                            </button>
                            <small>Manage store IDs and names</small>
                        </div>

                        <div class="setting-group">
                            <label>Store Rankings</label>
                            <button class="btn btn-secondary" onclick="openAllocationBuddyRankings()">
                                ‚≠ê Manage Rankings
                            </button>
                            <small>Set store ranks (A/B/C/D) for distribution priority</small>
                        </div>
                    </div>

                    <!-- ExpireWise Settings -->
                    <div class="settings-panel" data-panel="expirewise">
                        <h3>ExpireWise Settings</h3>

                        <div class="setting-group">
                            <label>üìÅ Save Location</label>
                            <small>Choose where ExpireWise saves your data file</small>
                            <div style="margin-top: 0.75rem;">
                                <label style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.5rem;">
                                    <input type="radio" name="unifiedStorageLocation" value="default" checked>
                                    <span>üíæ Default Location (Recommended)</span>
                                </label>
                                <code id="unifiedDefaultStoragePath" style="display: block; margin-left: 1.5rem; margin-bottom: 0.75rem; padding: 0.5rem; background: var(--gray-100); border-radius: 4px; font-size: 0.85rem;">Loading...</code>

                                <label style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.5rem;">
                                    <input type="radio" name="unifiedStorageLocation" value="custom">
                                    <span>üìÇ Custom Location</span>
                                </label>
                                <div style="margin-left: 1.5rem;">
                                    <button type="button" class="btn btn-secondary" id="unifiedSelectCustomLocationBtn" disabled>
                                        Choose Folder
                                    </button>
                                    <code id="unifiedCustomStoragePath" style="display: none; margin-top: 0.5rem; padding: 0.5rem; background: var(--gray-100); border-radius: 4px; font-size: 0.85rem;">No folder selected</code>
                                </div>
                            </div>
                        </div>

                        <div class="setting-group">
                            <label for="expiryWarningDays">Warning Days Before Expiry</label>
                            <input type="number" id="expiryWarningDays" class="setting-input" value="30" min="1" max="365">
                            <small>Show warning when items are within this many days of expiring</small>
                        </div>

                        <div class="setting-group">
                            <label for="criticalWarningDays">Critical Warning Days</label>
                            <input type="number" id="criticalWarningDays" class="setting-input" value="7" min="1" max="365">
                            <small>Show critical alert when items are within this many days of expiring</small>
                        </div>

                        <div class="setting-group">
                            <label>
                                <input type="checkbox" id="showExpiredItems" checked>
                                Show expired items by default
                            </label>
                        </div>

                        <div class="setting-group">
                            <label for="defaultSortBy">Default Sort Column</label>
                            <select id="defaultSortBy" class="setting-input">
                                <option value="expiry">Expiry Date</option>
                                <option value="desc">Description</option>
                                <option value="location">Location</option>
                                <option value="units">Units</option>
                            </select>
                        </div>
                    </div>

                    <!-- Allocation Buddy Settings -->
                    <div class="settings-panel" data-panel="allocation">
                        <h3>Allocation Buddy Settings</h3>
                        
                        <div class="setting-group">
                            <label>Archived Allocations</label>
                            <button class="btn btn-secondary" onclick="openAllocationBuddyArchives()">
                                üì¶ View Archives
                            </button>
                            <small>View, compare, and restore archived allocation files</small>
                        </div>
                    </div>

                    <!-- Essentials Buddy Settings -->
                    <div class="settings-panel" data-panel="essentials">
                        <h3>Essentials Buddy Settings</h3>
                        <p class="panel-description">Manage inventory tracking, master lists, and thresholds</p>

                        <div class="setting-group">
                            <label>Master List Management</label>
                            <button class="btn btn-secondary" onclick="openEssentialsBuddySettings('masterListTab')">
                                üìã Manage Master List
                            </button>
                            <small>Import and manage your item database from Business Central</small>
                        </div>

                        <div class="setting-group">
                            <label>Threshold Management</label>
                            <button class="btn btn-secondary" onclick="openEssentialsBuddySettings('thresholdsTab')">
                                üéØ Manage Thresholds
                            </button>
                            <small>Configure per-item inventory thresholds and alerts</small>
                        </div>

                        <div class="setting-group">
                            <label>Display Preferences</label>
                            <button class="btn btn-secondary" onclick="openEssentialsBuddySettings('preferencesTab')">
                                ‚öôÔ∏è Preferences
                            </button>
                            <small>Customize items per page, default sort, and display options</small>
                        </div>

                        <div class="setting-group">
                            <label>Data Management</label>
                            <button class="btn btn-secondary" onclick="openEssentialsBuddySettings('dataTab')">
                                üíæ Manage Data
                            </button>
                            <small>Reload, backup, or clear stored data</small>
                        </div>
                    </div>

                    <!-- Analytics Settings -->
                    <div class="settings-panel" data-panel="analytics">
                        <h3>üìä Analytics Settings</h3>
                        
                        <div class="analytics-settings-section">
                            <h4>Chart Display</h4>
                            
                            <div class="setting-group">
                                <label for="defaultChartType">Default Chart Type</label>
                                <select id="defaultChartType" class="setting-input">
                                    <option value="bar">Bar Chart</option>
                                    <option value="line">Line Chart</option>
                                    <option value="pie">Pie Chart</option>
                                    <option value="doughnut">Doughnut Chart</option>
                                </select>
                                <small>Default visualization style for analytics charts</small>
                            </div>

                            <div class="setting-group">
                                <label>
                                    <input type="checkbox" id="animateCharts" checked>
                                    Animate charts on load
                                </label>
                            </div>

                            <div class="setting-group">
                                <label>
                                    <input type="checkbox" id="showChartLegends" checked>
                                    Show chart legends
                                </label>
                            </div>
                        </div>

                        <div class="analytics-settings-section">
                            <h4>Timeline & Periods</h4>
                            
                            <div class="setting-group">
                                <label for="analyticsPeriod">Default Analysis Period</label>
                                <select id="analyticsPeriod" class="setting-input">
                                    <option value="7">Last 7 days</option>
                                    <option value="14">Last 14 days</option>
                                    <option value="30" selected>Last 30 days</option>
                                    <option value="60">Last 60 days</option>
                                    <option value="90">Last 90 days</option>
                                    <option value="180">Last 6 months</option>
                                    <option value="365">Last year</option>
                                </select>
                                <small>Time range for analytics calculations</small>
                            </div>

                            <div class="setting-group">
                                <label for="forecastDays">Forecast Period</label>
                                <input type="number" id="forecastDays" class="setting-input" value="30" min="7" max="365">
                                <small>Number of days to forecast in predictions (7-365)</small>
                            </div>
                        </div>

                        <div class="analytics-settings-section">
                            <h4>Data Display</h4>
                            
                            <div class="setting-group">
                                <label for="metricsLayout">Metrics Card Layout</label>
                                <select id="metricsLayout" class="setting-input">
                                    <option value="grid">Grid (Auto-fit)</option>
                                    <option value="row">Single Row</option>
                                    <option value="column">Single Column</option>
                                </select>
                                <small>How to display analytics summary cards</small>
                            </div>

                            <div class="setting-group">
                                <label>
                                    <input type="checkbox" id="showPercentages" checked>
                                    Show percentages in metrics
                                </label>
                            </div>

                            <div class="setting-group">
                                <label>
                                    <input type="checkbox" id="showTrends" checked>
                                    Show trend indicators
                                </label>
                            </div>

                            <div class="setting-group">
                                <label>
                                    <input type="checkbox" id="includeExpiredInAnalytics">
                                    Include expired items in analytics
                                </label>
                            </div>
                        </div>

                        <div class="analytics-settings-section">
                            <h4>Color Scheme</h4>
                            
                            <div class="setting-group">
                                <label for="chartColorScheme">Chart Color Palette</label>
                                <select id="chartColorScheme" class="setting-input">
                                    <option value="default">Default (Purple/Blue)</option>
                                    <option value="vibrant">Vibrant (Multi-color)</option>
                                    <option value="pastel">Pastel</option>
                                    <option value="monochrome">Monochrome</option>
                                    <option value="status">Status-based (Red/Yellow/Green)</option>
                                </select>
                                <small>Color scheme for all analytics visualizations</small>
                            </div>
                        </div>

                        <div class="analytics-settings-section">
                            <h4>Export Options</h4>
                            
                            <div class="setting-group">
                                <label for="exportFormat">Default Export Format</label>
                                <select id="exportFormat" class="setting-input">
                                    <option value="png">PNG Image</option>
                                    <option value="jpg">JPG Image</option>
                                    <option value="pdf">PDF Document</option>
                                    <option value="csv">CSV Data</option>
                                </select>
                                <small>Default format when exporting analytics data</small>
                            </div>

                            <div class="setting-group">
                                <label>
                                    <input type="checkbox" id="includeTimestampExport" checked>
                                    Include timestamp in exports
                                </label>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="settings-footer">
                <button class="btn btn-secondary" id="resetSettings">Reset to Defaults</button>
                <div class="settings-footer-actions">
                    <button class="btn btn-secondary" id="cancelSettings">Cancel</button>
                    <button class="btn btn-primary" id="saveSettings">Save Settings</button>
                </div>
            </div>
        </div>
    </div>

    <script src="js/shared-utils.js"></script>
    <script src="js/settings.js"></script>
    <script src="js/launcher.js"></script>
</body>
</html>
